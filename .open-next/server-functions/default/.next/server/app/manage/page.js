(()=>{var a={};a.id=908,a.ids=[908],a.modules={21:(a,b,c)=>{"use strict";c.d(b,{A:()=>m});var d=c(60687),e=c(43210),f=c.n(e),g=c(88920),h=c(92576),i=c(5336),j=c(43649);let k=(0,c(62688).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var l=c(11860);let m=({show:a,message:b,type:c="success",onClose:e})=>{f().useEffect(()=>{if(a){let a=setTimeout(()=>e(),5e3);return()=>clearTimeout(a)}},[a,e]);let m={success:{icon:(0,d.jsx)(i.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,d.jsx)(j.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,d.jsx)(k,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},n=m[c]||m.info;return(0,d.jsx)(g.N,{children:a&&(0,d.jsx)(h.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,d.jsxs)("div",{className:`flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ${n.style}`,children:[(0,d.jsx)("div",{className:"flex-shrink-0",children:n.icon}),(0,d.jsx)("div",{className:"ml-3 flex-1",children:(0,d.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:b})}),(0,d.jsx)("button",{onClick:e,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,d.jsx)(l.A,{className:"w-5 h-5"})})]})})})}},261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},972:a=>{"use strict";a.exports=import("@react-pdf/renderer")},1303:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5336:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8819:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},10022:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},10083:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])},10597:(a,b,c)=>{"use strict";c.d(b,{A:()=>y});var d=c(60687),e=c(43210),f=c(51215),g=c(95391),h=c(88920),i=c(92576),j=c(79894),k=c(58893),l=c(21),m=c(18921),n=c(78464);let o=(0,c(62688).A)("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);var p=c(88233),q=c(10083),r=c(11860),s=c(41862),t=c(47342),u=c(1303),v=c(8819);let w=({file:a,onRemove:b,onUndelete:c,isMarkedForDeletion:e})=>{let f=a.isExisting;return(0,d.jsxs)("div",{className:`relative flex items-center justify-between p-3 rounded-lg transition-colors duration-300 ${e?"bg-red-100":"bg-white border"}`,children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,d.jsx)(n.A,{className:`h-6 w-6 flex-shrink-0 ${f?"text-blue-500":"text-green-500"}`}),(0,d.jsxs)("div",{className:"overflow-hidden",children:[(0,d.jsx)("p",{className:`text-sm font-medium text-gray-800 truncate ${e?"line-through":""}`,children:a.name}),(0,d.jsxs)("p",{className:"text-xs text-gray-500",children:[a.type," • ",(a=>a?a<1024?`${a} B`:a<1048576?`${(a/1024).toFixed(1)} KB`:`${(a/1048576).toFixed(1)} MB`:"0 B")(a.size)]})]})]}),(0,d.jsx)("button",{onClick:e?c:b,className:`p-1 rounded-full transition-colors ${e?"text-yellow-600 hover:bg-yellow-200":"text-red-500 hover:bg-red-100"}`,title:e?"取消刪除":"標記為刪除",children:e?(0,d.jsx)(o,{size:18}):(0,d.jsx)(p.A,{size:18})})]})},x=({selectedFiles:a,setSelectedFiles:b,filesToRemove:c,setFilesToRemove:f,disabled:g,showToast:h})=>{let i=(0,e.useRef)(null),j="15 MB",k={"application/pdf":["pdf"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/webp":["webp"],"application/msword":["doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.ms-excel":["xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.ms-powerpoint":["ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.oasis.opendocument.presentation":["odp"]},l=Object.values(k).flat().map(a=>`.${a}`).join(","),m=c=>{let d=[];for(let b of c){let c=b.name.split(".").pop()?.toLowerCase()||"";if(!(Object.keys(k).includes(b.type)||Object.values(k).flat().includes(c))){h(`不支援的檔案類型: ${b.name}`,"warning");continue}if(a.some(a=>a.name===b.name)){h(`檔案 "${b.name}" 已存在`,"warning");continue}if(b.size>0xf00000){h(`檔案大小超過 ${j} 限制: ${b.name}`,"warning");continue}if(a.length+d.length>=8){h(`最多只能選擇 8 個檔案`,"warning");break}d.push(b)}b(a=>[...a,...d])};return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-300 ${!g?"border-gray-300 hover:border-indigo-400 bg-transparent cursor-pointer":"bg-gray-100/50 cursor-not-allowed"}`,onDragOver:a=>a.preventDefault(),onDrop:a=>{a.preventDefault(),g||m(Array.from(a.dataTransfer.files))},onClick:()=>!g&&i.current?.click(),children:[(0,d.jsx)("input",{type:"file",ref:i,onChange:a=>{m(Array.from(a.target.files)),a.target.value=""},className:"hidden",accept:l,disabled:g,multiple:!0}),(0,d.jsx)(q.A,{className:"mx-auto h-10 w-10 text-gray-400"}),(0,d.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["拖曳檔案到此，或 ",(0,d.jsx)("span",{className:"font-medium text-indigo-600",children:"點擊上傳"})]}),(0,d.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["已選擇 ",a.length," / ",8," 個檔案"]}),(0,d.jsxs)("p",{className:"mt-1 text-xs text-gray-400",children:["支援文件 (Word, Excel, PPT, PDF, ODT, ODS, ODP) 及圖片格式，單一檔案大小上限為 ",j]})]}),a.length>0&&(0,d.jsx)("div",{className:"space-y-2",children:(0,d.jsx)("div",{className:"space-y-2 rounded-lg p-2 bg-transparent",children:a.map((e,g)=>(0,d.jsx)(w,{file:e,onRemove:()=>(c=>{let d=a[c];d.isExisting?f(a=>[...a,d]):b(a=>a.filter((a,b)=>b!==c))})(g),onUndelete:()=>{f(a=>a.filter(a=>a.id!==e.id))},isMarkedForDeletion:c.some(a=>a.id===e.id)},e.id||`new-${g}`))})})]})};function y({isOpen:a,onClose:b,announcement:c,refreshAnnouncements:n}){let[o,q]=(0,e.useState)(!1),[w,y]=(0,e.useState)([]),[z,A]=(0,e.useState)([]),[B,C]=(0,e.useState)({show:!1,message:"",type:"success"}),[D,E]=(0,e.useState)({title:"",summary:"",is_active:!1,category:"",application_start_date:"",application_end_date:"",target_audience:"",application_limitations:"",submission_method:"",external_urls:[{url:""}]}),F="w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30",G=()=>C(a=>({...a,show:!1})),H=(a,b="success")=>{C({show:!0,message:a,type:b}),setTimeout(()=>{G()},3e3)},I=a=>E(b=>({...b,[a.target.name]:a.target.value})),J=(0,e.useCallback)(a=>E(b=>({...b,summary:a})),[]),K=(0,e.useCallback)(a=>E(b=>({...b,target_audience:a})),[]),L=async()=>{if(!D.title.trim()||!D.summary.replace(/<[^>]*>?/gm,"").trim())return void H("請填寫所有必填欄位","warning");q(!0);try{let a=D.external_urls.filter(a=>""!==a.url.trim()),{data:d,error:e}=await g.N.from("announcements").update({title:D.title,summary:D.summary,is_active:D.is_active,category:D.category,application_start_date:D.application_start_date||null,application_end_date:D.application_end_date||null,target_audience:D.target_audience,application_limitations:D.application_limitations,submission_method:D.submission_method,external_urls:JSON.stringify(a),updated_at:new Date().toISOString()}).eq("id",c.id).select().single();if(e)throw e;if(z.length>0){let a=z.map(a=>a.path),b=z.map(a=>a.id);await (0,m.tm)("/api/delete-files",{method:"POST",body:JSON.stringify({filePaths:a})});let{error:c}=await g.N.from("attachments").delete().in("id",b);if(c)throw c}let f=w.filter(a=>!a.isExisting);if(f.length>0){let a=new FormData;f.forEach(b=>{a.append("files",b)});let b=await (0,m.tm)("/api/upload-files",{method:"POST",body:a});if(!b.ok){let a=await b.json().catch(()=>null),c=a?.error||"檔案上傳請求失敗";throw Error(c)}let c=await b.json();if(c.data.errors&&c.data.errors.length>0){let a=c.data.errors.map(a=>`${a.fileName}: ${a.error}`).join(", ");throw Error(`部分檔案上傳失敗: ${a}`)}let e=c.data.uploaded;if(e&&e.length>0){let a=e.map(a=>({announcement_id:d.id,file_name:a.originalName,stored_file_path:a.path,file_size:a.size,mime_type:a.mimeType})),{error:b}=await g.N.from("attachments").insert(a);if(b)throw b}else if(f.length>0&&(!c.data.errors||0===c.data.errors.length))throw Error("上傳成功，但伺服器未回傳任何檔案資料")}n&&n(),b(),H("公告已成功更新","success")}catch(a){H(`更新失敗: ${a.message}`,"error")}finally{q(!1)}};return(0,d.jsxs)(d.Fragment,{children:[(0,f.createPortal)((0,d.jsx)(l.A,{show:B.show,message:B.message,type:B.type,onClose:G}),document.body),(0,d.jsx)(h.N,{children:a&&(0,d.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 pt-16",children:(0,d.jsxs)(i.P.div,{initial:{scale:.95,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:50,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-4xl flex flex-col overflow-hidden border border-white/20",style:{height:"calc(100vh - 10rem)"},onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,d.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"編輯公告"}),(0,d.jsx)("button",{onClick:()=>{window.confirm("確認關閉公告編輯模組嗎？如尚未儲存將丟失此編輯紀錄！")&&b()},disabled:o,className:"text-gray-400 hover:text-gray-600 p-2 rounded-full",children:(0,d.jsx)(r.A,{size:20})})]}),(0,d.jsx)("div",{className:"flex-grow p-6 overflow-y-auto",children:(0,d.jsxs)("div",{className:"space-y-6",children:[o&&(0,d.jsxs)("div",{className:"absolute inset-0 bg-white/70 z-20 flex flex-col items-center justify-center rounded-lg",children:[(0,d.jsx)(s.A,{className:"animate-spin h-8 w-8 text-indigo-600"}),(0,d.jsx)("p",{className:"mt-4 text-indigo-700 font-semibold",children:"儲存中..."})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:["公告標題 ",(0,d.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,d.jsx)("input",{type:"text",id:"title",name:"title",className:F,value:D.title,onChange:I})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"is_active",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告狀態"}),(0,d.jsxs)("select",{id:"is_active",name:"is_active",className:F,value:D.is_active,onChange:a=>E(b=>({...b,is_active:"true"===a.target.value})),children:[(0,d.jsx)("option",{value:!1,children:"下架"}),(0,d.jsx)("option",{value:!0,children:"上架"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"category",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"獎學金分類"}),(0,d.jsxs)("select",{id:"category",name:"category",className:F,value:D.category,onChange:I,children:[(0,d.jsx)("option",{value:"",children:"請選擇"}),(0,d.jsx)("option",{value:"A",children:"A：各縣市政府獎學金"}),(0,d.jsx)("option",{value:"B",children:"B：縣市政府以外之各級公家機關及公營單位獎學金"}),(0,d.jsx)("option",{value:"C",children:"C：宗教及民間各項指定身分獎學金"}),(0,d.jsx)("option",{value:"D",children:"D：非公家機關或其他無法歸類的獎學金"}),(0,d.jsx)("option",{value:"E",children:"E：本校獲配推薦名額獎助學金"}),(0,d.jsx)("option",{value:"F",children:"F：校外獎助學金得獎公告"}),(0,d.jsx)("option",{value:"G",children:"G：校內獎助學金"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"application_start_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請開始日期"}),(0,d.jsx)("input",{type:"date",id:"application_start_date",name:"application_start_date",className:F,value:D.application_start_date,onChange:I})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"application_end_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請截止日期"}),(0,d.jsx)("input",{type:"date",id:"application_end_date",name:"application_end_date",className:F,value:D.application_end_date,onChange:I})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"submission_method",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"送件方式"}),(0,d.jsx)("input",{type:"text",id:"submission_method",name:"submission_method",className:F,value:D.submission_method,onChange:I})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"application_limitations",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請限制"}),(0,d.jsxs)("select",{id:"application_limitations",name:"application_limitations",className:F,value:D.application_limitations,onChange:I,children:[(0,d.jsx)("option",{value:"",children:"未指定"}),(0,d.jsx)("option",{value:"Y",children:"可兼領"}),(0,d.jsx)("option",{value:"N",children:"不可兼領"})]})]})]}),(0,d.jsxs)("div",{className:"flex flex-col min-h-[250px]",children:[(0,d.jsx)("label",{htmlFor:"target_audience",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"適用對象"}),(0,d.jsx)("div",{className:"relative flex-grow",children:(0,d.jsx)(j.A,{value:D.target_audience,onChange:K,disabled:o})})]}),(0,d.jsxs)("div",{className:"flex flex-col min-h-[400px]",children:[(0,d.jsxs)("label",{htmlFor:"summary",className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:["公告摘要 ",(0,d.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,d.jsx)("div",{className:"relative flex-grow",children:(0,d.jsx)(j.A,{value:D.summary,onChange:J,disabled:o})})]}),(0,d.jsxs)("div",{className:"p-4 bg-slate-500/5 rounded-lg border",children:[(0,d.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"附件與連結"}),(0,d.jsx)(x,{selectedFiles:w,setSelectedFiles:y,filesToRemove:z,setFilesToRemove:A,disabled:o,showToast:H}),(0,d.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,d.jsxs)("label",{className:"block text-sm font-medium text-gray-600 flex items-center gap-2",children:[(0,d.jsx)(t.A,{size:16}),"外部參考連結"]}),D.external_urls.map((a,b)=>(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"url",className:F,value:a.url,onChange:a=>((a,b)=>{let c=[...D.external_urls];c[a].url=b,E(a=>({...a,external_urls:c}))})(b,a.target.value),placeholder:"https://example.com"}),D.external_urls.length>1&&(0,d.jsx)("button",{type:"button",onClick:()=>E(a=>({...a,external_urls:a.external_urls.filter((a,c)=>c!==b)})),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:(0,d.jsx)(p.A,{size:16})})]},b)),(0,d.jsx)(k.A,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(a=>({...a,external_urls:[...a.external_urls,{url:""}]})),leftIcon:(0,d.jsx)(u.A,{size:16}),children:"新增連結"})]})]})]})}),(0,d.jsx)("div",{className:"p-4 bg-black/5 flex justify-end space-x-3 flex-shrink-0",children:(0,d.jsxs)("button",{type:"button",onClick:L,disabled:o,className:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-indigo-400 bg-transparent text-indigo-600 transition-all duration-300 ease-in-out transform hover:bg-indigo-100 hover:text-indigo-700 hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none",children:[o?(0,d.jsx)(s.A,{size:16,className:"animate-spin"}):(0,d.jsx)(v.A,{size:16}),(0,d.jsx)("span",{children:"儲存變更"})]})})]})})})]})}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:a=>{"use strict";a.exports=require("punycode")},12412:a=>{"use strict";a.exports=require("assert")},18921:(a,b,c)=>{"use strict";c.d(b,{tm:()=>g});var d=c(95391);async function e(){try{let{data:{session:a}}=await d.N.auth.getSession();return a?.access_token||null}catch(a){return console.error("Error getting current token:",a),null}}async function f(a={}){let b=await e(),c={...a.headers};return c["Content-Type"]||c["content-type"]||a.body instanceof FormData||(c["Content-Type"]="application/json"),b&&(c.Authorization=`Bearer ${b}`),{...a,headers:c}}async function g(a,b={}){return fetch(a,await f(b))}},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20128:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>u});var e=c(60687),f=c(43210),g=c(35179),h=c(16189),i=c(13389),j=c(61799),k=c(31214),l=c(29722),m=c(10022),n=c(41312),o=c(84027),p=c(41862),q=c(92576),r=c(37472),s=a([j]);j=(s.then?(await s)():s)[0];let v=[{id:"announcements",label:"公告管理",icon:m.A,component:(0,e.jsx)(j.A,{})},{id:"users",label:"使用者管理",icon:n.A,component:(0,e.jsx)(k.A,{})},{id:"usage",label:"相關連結",icon:o.A,component:(0,e.jsx)(l.A,{})}],w=({activeTab:a,onTabClick:b,isOverDark:c=!1})=>{let d=(0,f.useRef)([]),g=d.current[v.findIndex(b=>b.id===a)];return(0,e.jsxs)("nav",{className:`relative grid grid-cols-3 items-center p-1 gap-1 rounded-full shadow-inner transition-colors duration-300 backdrop-blur-xl overflow-hidden
            ${c?"bg-white/15":"bg-black/[0.04]"}
        `,children:[(0,e.jsx)(q.P.span,{className:"absolute top-1 bottom-1 rounded-full bg-purple-300/20",layoutId:"bubble",initial:!1,animate:{x:g?.offsetLeft,width:g?.offsetWidth},transition:{type:"spring",bounce:.2,duration:.6}}),v.map((f,g)=>(0,e.jsxs)("button",{ref:a=>d.current[g]=a,onClick:()=>b(f.id),className:`
                        relative z-10 flex items-center justify-center gap-2 whitespace-nowrap
                        h-10 py-2.5 px-3 sm:px-4
                        font-medium text-sm transition-colors duration-300 rounded-full
                        focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-500
                        ${a===f.id?c?"text-purple-300 font-semibold":"text-purple-700 font-semibold":c?"text-white hover:text-gray-200":"text-gray-800 hover:text-black"}
                    `,children:[(0,e.jsx)(f.icon,{className:"h-5 w-5"}),(0,e.jsx)("span",{children:f.label})]},f.id))]})};function t(){let{isAuthenticated:a,isAdmin:b,loading:c}=(0,i.A)(),d=(0,h.useRouter)(),j=(0,h.useSearchParams)(),[k,l]=(0,f.useState)(j.get("tab")||"announcements"),{ref:m,inView:n}=(0,r.Wx)({threshold:.5}),o=(0,f.useContext)(g.B),s=o?.isHeaderVisible??!0,[t,u]=(0,f.useState)(!1),x=(0,f.useRef)(null);(0,f.useCallback)(()=>{if(!x.current||n)return;let a=x.current.getBoundingClientRect(),b=[{x:a.left+1,y:a.top+1},{x:a.left+a.width/2,y:a.top+a.height/2},{x:a.right-1,y:a.bottom-1}],c=0;for(let a of b)for(let b of document.elementsFromPoint(a.x,a.y))if(!x.current.contains(b)){let a=window.getComputedStyle(b).backgroundColor;(function(a){if(!a||"transparent"===a||a.startsWith("rgba(")&&a.endsWith(", 0)"))return!1;let b=a.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return!!b&&(.299*b[1]+.587*b[2]+.114*b[3])/255<.5})(a)&&c++;break}u(c>=2)},[n]);let y=a=>{l(a),d.push(`/manage?tab=${a}`,{scroll:!1})};if(c||!a||!b)return(0,e.jsx)("div",{className:"w-full flex items-center justify-center py-24",children:(0,e.jsx)(p.A,{className:"h-12 w-12 text-indigo-600 animate-spin"})});let z=v.find(a=>a.id===k)?.component||null;return(0,e.jsxs)("div",{className:"w-full bg-white min-h-screen",children:[(0,e.jsx)(q.P.div,{ref:x,className:"fixed top-0 left-0 w-full z-40 px-4 pointer-events-none",initial:{y:"-150%",opacity:0},animate:{y:n?"-150%":s?"88px":"20px",opacity:+!n},transition:{type:"spring",stiffness:300,damping:30},children:(0,e.jsx)("div",{className:"max-w-sm sm:max-w-md mx-auto pointer-events-auto",children:(0,e.jsx)(w,{activeTab:k,onTabClick:y,isOverDark:t})})}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("header",{className:"py-12 text-center",children:[(0,e.jsx)("h1",{className:"text-4xl font-bold tracking-tight text-gray-900",children:"管理後台"}),(0,e.jsx)("p",{className:"mt-3 text-lg text-gray-500",children:"在這裡你可以針對 彰師生輔組 —— 校外獎助學金資訊平台的所有公告、使用者進行相關操作。"})]}),(0,e.jsx)("div",{ref:m,className:"flex justify-center mb-10 w-full max-w-md mx-auto sm:max-w-none",children:(0,e.jsx)(w,{activeTab:k,onTabClick:y,isOverDark:!1})}),(0,e.jsx)("main",{className:"pb-12",children:z})]})]})}function u(){return(0,e.jsx)(f.Suspense,{fallback:(0,e.jsx)("div",{className:"w-full flex items-center justify-center py-24",children:(0,e.jsx)(p.A,{className:"h-12 w-12 text-indigo-600 animate-spin"})}),children:(0,e.jsx)(t,{})})}d()}catch(a){d(a)}})},23362:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/hune1228/NCUE-Scholarship/NCUE-Scholarship/src/app/manage/page.jsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/hune1228/NCUE-Scholarship/NCUE-Scholarship/src/app/manage/page.jsx","default")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29722:(a,b,c)=>{"use strict";c.d(b,{A:()=>m});var d=c(60687),e=c(43210),f=c.n(e),g=c(62688);let h=(0,g.A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),i=(0,g.A)("clipboard-copy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);var j=c(10022),k=c(82080);let l=({type:a="link",href:b,copyText:c,icon:e,title:g,children:j,color:k="indigo"})=>{let[l,m]=f().useState(!1),n={indigo:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(165,180,252,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(251,146,180,0.4),_transparent_60%)]",iconBg:"bg-indigo-100",iconText:"text-indigo-600",linkText:"text-indigo-600"},rose:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(251,113,133,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(252,211,77,0.4),_transparent_60%)]",iconBg:"bg-rose-100",iconText:"text-rose-600",linkText:"text-rose-600"},teal:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(134,239,172,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(110,231,183,0.4),_transparent_60%)]",iconBg:"bg-teal-100",iconText:"text-teal-600",buttonBg:"bg-teal-600",buttonHoverBg:"hover:bg-teal-700"}},o=n[k]||n.indigo,p=a=>{a.preventDefault();let b=document.createElement("textarea");b.value=c,b.style.position="fixed",b.style.left="-9999px",document.body.appendChild(b),b.select();try{document.execCommand("copy"),m(!0),setTimeout(()=>m(!1),2e3)}catch(a){console.error("無法複製內容: ",a)}document.body.removeChild(b)},q=()=>(0,d.jsxs)("div",{className:"relative h-full overflow-hidden rounded-xl border border-gray-200/80 bg-white p-6 shadow-lg transition-all duration-300 ease-in-out hover:shadow-2xl hover:-translate-y-1.5",children:[(0,d.jsx)("div",{className:`absolute -top-24 -left-24 h-72 w-72 rounded-full ${o.gradientStart} opacity-0 transition-all duration-700 ease-in-out group-hover:top-[-4rem] group-hover:left-[-4rem] group-hover:opacity-100 blur-2xl`}),(0,d.jsx)("div",{className:`absolute -bottom-24 -right-24 h-72 w-72 rounded-full ${o.gradientEnd} opacity-0 transition-all duration-700 ease-in-out group-hover:bottom-[-4rem] group-hover:right-[-4rem] group-hover:opacity-100 blur-2xl`}),(0,d.jsxs)("div",{className:"relative z-10 flex h-full flex-col",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("div",{className:`flex-shrink-0 rounded-lg p-3 ${o.iconBg}`,children:(0,d.jsx)(e,{className:`h-6 w-6 ${o.iconText}`})}),(0,d.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:g})]}),(0,d.jsx)("p",{className:"mt-4 flex-grow text-sm text-gray-500",children:j}),"link"===a&&(0,d.jsxs)("div",{className:`mt-6 flex items-center justify-end text-sm font-semibold ${o.linkText}`,children:[(0,d.jsx)("span",{children:"前往連結"}),(0,d.jsx)(h,{className:"ml-2 h-4 w-4 transition-transform duration-300 ease-in-out group-hover:translate-x-1"})]}),"copy"===a&&(0,d.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,d.jsxs)("button",{onClick:p,className:`flex items-center justify-center rounded-md px-4 py-2 text-sm font-semibold transition-colors duration-200 ${l?"bg-green-500 text-white":`${o.buttonBg} text-white ${o.buttonHoverBg}`}`,children:[(0,d.jsx)(i,{className:"h-4 w-4 mr-2"}),l?"已複製！":"複製模板"]})})]})]});return"link"===a?(0,d.jsx)("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"group block",children:(0,d.jsx)(q,{})}):(0,d.jsx)("div",{className:"group block",children:(0,d.jsx)(q,{})})};function m(){let a=`<p>親愛的 xxx[請自行修改] 同學，您好：</p>
<p>為了 <strong><span style="color: #3598db;">平台身分識別</span></strong> 及 <strong><span style="color: #3598db;">訊息推播用途</span></strong><span style="color: #000000;">，請透過 <span style="color: #843fa1;"><a style="color: #843fa1;" href="profile" target="_blank" rel="noopener">連結</a></span>&nbsp;進入平台，將帳號改為 <strong>真實姓名</strong> 及 <strong>真實學號 </strong>方可繼續使用此平台，否則該帳號將於 <span style="color: #e03e2d;"><strong>2025/08/24 00:00:00[請自行修改，設為一週後]</strong></span> 進入封禁狀態，並不再允許註冊。</span></p>
<p><span style="color: #000000;">請放心，您的個資接存放於後端加密資料庫，外界無法存取，詳見 <a href="terms-and-privacy" target="_blank" rel="noopener"><span style="color: #843fa1;">服務條款</span></a>&nbsp;或 <span style="color: #843fa1;"><a style="color: #843fa1;" href="https://docs.google.com/document/d/1ZI_vUtdQ2ushBS0C9viS1yZWzSkFEgvZ79NEJCmvptU/edit?usp=sharing">使用說明</a></span> 。</span></p>
<hr>
<p>若有任何疑問，歡迎隨時<span style="color: #843fa1;"><a style="color: #843fa1;" href="mailto:3526ming@gmail.com" target="_blank" rel="noopener">與我聯繫</a></span></p>
<p>生輔組獎學金資訊系統開發 &amp; 維護者</p>
<p>陳泰銘 敬上</p>`,b=[{type:"link",href:"https://docs.google.com/spreadsheets/d/1XMRRNO1e_fSk-LU84K68EGiOAidaRDVp8yBlmL0G_D8/edit?resourcekey=&gid=204496218#gid=204496218",icon:j.A,title:"校外獎助學金送件紀錄 資料表",color:"indigo",children:"承辦人員、工讀生可透過此連結進入<strong>已連結回應表單之 Google Sheet</strong>。"},{type:"link",href:"https://docs.google.com/document/d/1ZI_vUtdQ2ushBS0C9viS1yZWzSkFEgvZ79NEJCmvptU/edit?usp=sharing",icon:k.A,title:"平台使用說明",color:"rose",children:"關於本平台的相關注意事項，內容包含<strong>開發人員</strong>、<strong>管理員</strong>、<strong>一般使用者</strong> 三種身分的使用說明。"},{type:"copy",icon:i,title:"請求提供正確個資信件模板",copyText:a,color:"teal",children:"請到使用者管理>寄送郵件>進入Tiny MCE 編輯框>點選工具>點選原始程式碼，貼上並編輯，即可寄出。"}];return(0,d.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center p-4 sm:p-6 lg:p-8",children:(0,d.jsx)("div",{className:"w-full max-w-6xl",children:(0,d.jsx)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3",children:b.map((a,b)=>(0,d.jsx)(l,{...a,children:(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:a.children}})},b))})})})}},31214:(a,b,c)=>{"use strict";c.d(b,{A:()=>z});var d=c(60687),e=c(43210),f=c(13389),g=c(21),h=c(18921),i=c(99270),j=c(41312),k=c(62688);let l=(0,k.A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),m=(0,k.A)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var n=c(41862),o=c(63826),p=c(47033),q=c(14952),r=c(16145),s=c(88920),t=c(92576),u=c(79894),v=c(11860),w=c(27900);function x({isOpen:a,onClose:b,user:c,onConfirm:f,isSending:g}){let[h,i]=(0,e.useState)({subject:"",body:""}),j=(0,e.useCallback)(a=>{i(b=>({...b,body:a}))},[]),k=new Date().getFullYear(),l=`
    <!DOCTYPE html>
    <html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>彰師校外獎助學金資訊平台</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { margin: 0; padding: 0; background-color: transparent; font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif; -webkit-font-smoothing: antialiased; }
        table { border-collapse: collapse; width: 100%; }
        .container { background-color: #ffffff; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; text-align: center; }
        .header h1 { margin: 0; font-size: 26px; font-weight: 700; }
        .content { padding: 32px 40px; color: #374151; }
        .content h2 { color: #1f2937; margin-top: 0; margin-bottom: 24px; font-size: 22px; font-weight: 700; text-align: left; }
        .html-body { font-size: 16px; line-height: 1.7; color: #374151; word-break: break-word; }
        .html-body * { max-width: 100%; }
        .footer { padding: 24px 40px; font-size: 12px; text-align: center; color: #9ca3af; background-color: #f9fafb; border-top: 1px solid #e5e7eb; }
        .footer a { color: #6b7280; text-decoration: none; }
    </style></head><body>
    <table class="wrapper" border="0" cellpadding="0" cellspacing="0"><tr><td>
    <table class="container" border="0" cellpadding="0" cellspacing="0">
        <tr><td class="header"><h1>生輔組校外獎助學金資訊平台</h1></td></tr>
        <tr><td class="content">
            <h2>${h.subject||"(預覽標題)"}</h2>
            <div class="html-body">${h.body||"(預覽內文)"}</div>
        </td></tr>
        <tr><td class="footer">
            <p style="margin: 0 0 12px;"><a href="https://scholarship.ncuesa.org.tw" target="_blank">生輔組獎助學金資訊平台</a> • <a href="https://stuaffweb.ncue.edu.tw/" target="_blank">生輔組首頁</a></p>
            <p style="margin: 0 0 5px;">\xa9 ${k} 彰師生輔組校外獎助學金資訊平台. All Rights Reserved.</p>
            <p style="margin: 0;">此為系統自動發送之信件，請勿直接回覆。</p>
        </td></tr>
    </table></td></tr></table></body></html>`;return(0,d.jsx)(s.N,{children:a&&(0,d.jsx)(t.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4 pt-16",children:(0,d.jsxs)(t.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-6xl flex flex-col h-[85vh] max-h-[800px] overflow-hidden border border-white/20",onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,d.jsxs)("h2",{className:"text-lg font-bold text-gray-800",children:["寄送通知給 ",c?.name," ",(0,d.jsxs)("span",{className:"text-gray-500 font-normal text-base",children:["(",c?.email,")"]})]}),(0,d.jsx)("button",{onClick:b,className:"text-gray-500 hover:text-gray-700 p-2 rounded-full transition-colors",children:(0,d.jsx)(v.A,{size:20})})]}),(0,d.jsxs)("div",{className:"p-6 flex flex-col gap-6 flex-1 overflow-y-auto min-h-0",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"subject",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"標題"}),(0,d.jsx)("input",{id:"subject",type:"text",name:"subject",value:h.subject,onChange:a=>{let{name:b,value:c}=a.target;i(a=>({...a,[b]:c}))},className:"w-full px-4 py-2 bg-white/70 border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 flex-1 min-h-0",children:[(0,d.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,d.jsx)("label",{htmlFor:"body",className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:"郵件內文"}),(0,d.jsx)("div",{className:"relative flex-grow h-full",children:(0,d.jsx)(u.A,{value:h.body,onChange:j,disabled:g,init:{height:"100%",menubar:!0,plugins:"lists link image table code help wordcount",toolbar:"undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image | code"}})})]}),(0,d.jsx)("div",{className:"rounded-lg overflow-y-auto h-full",children:(0,d.jsx)("iframe",{srcDoc:l,className:"w-full h-full border-0 rounded-md",title:"Email Preview"})})]})]}),(0,d.jsx)("div",{className:"p-4 bg-black/5 flex justify-end space-x-3 rounded-b-2xl flex-shrink-0",children:(0,d.jsxs)("button",{type:"button",onClick:()=>{f({subject:h.subject,htmlContent:h.body})},disabled:g,className:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-sky-400 bg-transparent text-sky-600 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-sky-100 hover:text-sky-700 hover:border-sky-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",children:[g?(0,d.jsx)(n.A,{size:16,className:"animate-spin"}):(0,d.jsx)(w.A,{size:16}),(0,d.jsx)("span",{children:g?"寄送中...":"確認並發送 Email"})]})})]})})})}let y=()=>(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,d.jsx)("path",{fill:"#4caf50",d:"M45,16.2l-5,2.75l-5,4.75L35,40h7c1.657,0,3-1.343,3-3V16.2z"}),(0,d.jsx)("path",{fill:"#1e88e5",d:"M3,16.2l3.614,1.71L13,23.7V40H6c-1.657,0-3-1.343-3-3V16.2z"}),(0,d.jsx)("polygon",{fill:"#e53935",points:"35,11.2 24,19.45 13,11.2 12,17 13,23.7 24,31.95 35,23.7 36,17"}),(0,d.jsx)("path",{fill:"#c62828",d:"M3,12.298V16.2l10,7.5V11.2L9.876,8.859C9.132,8.301,8.228,8,7.298,8h0C4.924,8,3,9.924,3,12.298z"}),(0,d.jsx)("path",{fill:"#fbc02d",d:"M45,12.298V16.2l-10,7.5V11.2l3.124-2.341C38.868,8.301,39.772,8,40.702,8h0 C43.076,8,45,9.924,45,12.298z"})]});function z(){let{user:a}=(0,f.A)(),[b,c]=(0,e.useState)([]),[k,s]=(0,e.useState)(!0),[t,u]=(0,e.useState)({show:!1,message:"",type:"success"}),[v,w]=(0,e.useState)(""),[z,A]=(0,e.useState)(1),[B,C]=(0,e.useState)(10),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(null),[H,I]=(0,e.useState)(!1),J=(a,b="success")=>u({show:!0,message:a,type:b}),K=(0,e.useCallback)(async()=>{s(!0);try{let a=await (0,h.tm)("/api/users"),b=await a.json();a.ok?c(Array.isArray(b.users)?b.users:[]):(J(b.error||"獲取用戶資料失敗","error"),c([]))}catch(a){J("獲取用戶資料時發生錯誤","error"),c([])}finally{s(!1)}},[]),L=async b=>{if(a&&b.id===a.id)return void J("無法變更自己的權限","error");let c="admin"===b.role?"user":"admin";if(confirm(`確定要將使用者 ${b.name} 的權限變更為「${c}」嗎？`))try{let a=await (0,h.tm)(`/api/users/${b.id}`,{method:"PUT",body:JSON.stringify({role:c})}),d=await a.json();a.ok?(J("使用者權限更新成功","success"),K()):J(d.error||"更新失敗","error")}catch(a){J("更新時發生錯誤","error")}},M=a=>{G(a),E(!0)},N=async({subject:a,htmlContent:b})=>{if(!a||!b)return void J("標題和內文為必填欄位","error");if(!F)return void J("未指定收件人","error");I(!0);try{let c={email:F.emailFull,subject:a,body:b},d=await (0,h.tm)("/api/send-custom-email",{method:"POST",body:JSON.stringify(c)}),e=await d.json();d.ok?(J(e.message||"通知已成功寄送！","success"),E(!1)):J(e.error||"寄送失敗，請稍後再試","error")}catch(a){console.error("Error sending custom email:",a),J("寄送時發生網路或未知錯誤","error")}finally{I(!1)}},O=(0,e.useMemo)(()=>{if(!Array.isArray(b))return[];let a=[...b];if(v){let b=v.toLowerCase();a=a.filter(a=>(a.name?.toLowerCase()||"").includes(b)||(a.studentId?.toLowerCase()||"").includes(b)||(a.email?.toLowerCase()||"").includes(b))}return a},[b,v]),P=(0,e.useMemo)(()=>O.slice((z-1)*B,z*B),[O,z,B]),Q=Math.ceil(O.length/B),R=(0,e.useMemo)(()=>({total:b.length,admins:b.filter(a=>"admin"===a.role).length,users:b.filter(a=>"user"===a.role).length}),[b]),S="flex items-center justify-center gap-1.5 px-3 py-1.5 text-xs font-semibold rounded-lg border transition-all duration-300 ease-in-out transform disabled:transform-none disabled:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",T={demote:`${S} border-indigo-200 bg-transparent text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 whitespace-nowrap`,promote:`${S} border-rose-200 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20 whitespace-nowrap`,notify:`${S} p-2 border-sky-200 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20`};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 lg:items-center",children:[(0,d.jsxs)("div",{className:"lg:col-span-3 relative",children:[(0,d.jsx)(i.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,d.jsx)("input",{type:"text",placeholder:"搜尋姓名、學號、信箱...",value:v,onChange:a=>{w(a.target.value),A(1)},className:"w-full pl-11 pr-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,d.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-3 gap-4 text-center bg-white p-3 rounded-xl border border-gray-200/80",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,d.jsx)(j.A,{size:14}),"總用戶數"]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:R.total})]}),(0,d.jsxs)("div",{className:"border-l border-gray-200",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,d.jsx)(l,{size:14}),"管理員"]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:R.admins})]}),(0,d.jsxs)("div",{className:"border-l border-gray-200",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,d.jsx)(m,{size:14}),"使用者"]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-600 mt-1",children:R.users})]})]})]}),(0,d.jsxs)("div",{className:"rounded-xl w-full bg-white shadow-lg overflow-hidden border border-gray-200/80",children:[(0,d.jsx)("div",{className:"hidden md:block",children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{className:"bg-gray-50/70 text-left",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"學號"}),(0,d.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"姓名"}),(0,d.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"電子信箱"}),(0,d.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"權限"}),(0,d.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 text-center",children:"操作"})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-gray-100",children:k?(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:"5",className:"text-center p-12",children:(0,d.jsx)(n.A,{className:"h-6 w-6 animate-spin mx-auto"})})}):0===P.length?(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:"5",className:"text-center p-12 text-gray-500",children:"找不到符合條件的使用者。"})}):P.map(b=>(0,d.jsxs)("tr",{className:"transform transition-all duration-300 hover:bg-violet-100/50 hover:shadow-xl z-0 hover:z-10 hover:scale-[1.02]",children:[(0,d.jsx)("td",{className:"p-4 px-6 font-mono",children:b.studentId||"-"}),(0,d.jsx)("td",{className:"p-4 px-6 font-medium text-gray-800",children:b.name||"-"}),(0,d.jsx)("td",{className:"p-4 px-6 text-gray-600",title:b.emailFull,children:b.email}),(0,d.jsx)("td",{className:"p-4 px-6",children:(0,d.jsx)("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full ${"admin"===b.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:"admin"===b.role?"管理員":"使用者"})}),(0,d.jsx)("td",{className:"p-4 px-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,d.jsx)("button",{onClick:()=>L(b),className:"admin"===b.role?T.demote:T.promote,disabled:a?.id===b.id,children:"admin"===b.role?"設為使用者":"設為管理員"}),(0,d.jsx)("button",{onClick:()=>M(b),className:T.notify,title:"寄送通知",children:(0,d.jsx)(y,{})})]})})]},b.id))})]})}),(0,d.jsx)("div",{className:"md:hidden divide-y divide-gray-100",children:k?(0,d.jsx)("div",{className:"text-center p-8",children:(0,d.jsx)(n.A,{className:"h-6 w-6 animate-spin mx-auto"})}):0===P.length?(0,d.jsx)("div",{className:"text-center p-8 text-gray-500",children:"找不到符合條件的使用者。"}):P.map(b=>(0,d.jsxs)("div",{className:"p-4 space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsx)("h3",{className:"font-bold text-base text-gray-900 flex-1 pr-4",children:b.name||"-"}),(0,d.jsx)("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full flex-shrink-0 ${"admin"===b.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:"admin"===b.role?"管理員":"使用者"})]}),(0,d.jsxs)("div",{className:"text-sm space-y-2 text-gray-600 border-t pt-3",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{className:"font-semibold text-gray-800",children:"學號: "}),b.studentId||"-"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{className:"font-semibold text-gray-800",children:"信箱: "}),b.email]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-end border-t pt-3 gap-2",children:[(0,d.jsx)("button",{onClick:()=>L(b),className:"admin"===b.role?T.demote:T.promote,disabled:a?.id===b.id,children:"admin"===b.role?"設為使用者":"設為管理員"}),(0,d.jsx)("button",{onClick:()=>M(b),className:T.notify,title:"寄送通知",children:(0,d.jsx)(y,{})})]})]},b.id))})]}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",O.length," 筆資料，第 ",z," / ",Q||1," 頁"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)("select",{value:B,onChange:a=>{C(Number(a.target.value)),A(1)},className:"appearance-none w-full bg-white border border-gray-300 rounded-lg py-2 pl-4 pr-10 text-sm shadow-sm transition-all duration-300 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/30",children:[(0,d.jsx)("option",{value:10,children:"10 筆 / 頁"}),(0,d.jsx)("option",{value:25,children:"25 筆 / 頁"}),(0,d.jsx)("option",{value:50,children:"50 筆 / 頁"})]}),(0,d.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400",children:(0,d.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,d.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm",children:[(0,d.jsx)("button",{onClick:()=>A(1),disabled:1===z,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,d.jsx)(o.A,{className:"h-5 w-5"})}),(0,d.jsx)("button",{onClick:()=>A(a=>a-1),disabled:1===z,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,d.jsx)(p.A,{className:"h-5 w-5"})}),(0,d.jsx)("button",{onClick:()=>A(a=>a+1),disabled:z===Q||0===Q,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,d.jsx)(q.A,{className:"h-5 w-5"})}),(0,d.jsx)("button",{onClick:()=>A(Q),disabled:z===Q||0===Q,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,d.jsx)(r.A,{className:"h-5 w-5"})})]})]})]}),(0,d.jsx)(x,{isOpen:D,onClose:()=>E(!1),user:F,onConfirm:N,isSending:H}),(0,d.jsx)(g.A,{show:t.show,message:t.message,type:t.type,onClose:()=>u(a=>({...a,show:!1}))})]})}},33873:a=>{"use strict";a.exports=require("path")},34452:a=>{"use strict";a.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},34631:a=>{"use strict";a.exports=require("tls")},37472:(a,b,c)=>{"use strict";c.d(b,{Wx:()=>j});var d=c(43210),e=Object.defineProperty,f=new Map,g=new WeakMap,h=0,i=void 0;function j({threshold:a,delay:b,trackVisibility:c,rootMargin:e,root:k,triggerOnce:l,skip:m,initialInView:n,fallbackInView:o,onChange:p}={}){var q;let[r,s]=d.useState(null),t=d.useRef(p),[u,v]=d.useState({inView:!!n,entry:void 0});t.current=p,d.useEffect(()=>{let d;if(!m&&r)return d=function(a,b,c={},d=i){if(void 0===window.IntersectionObserver&&void 0!==d){let e=a.getBoundingClientRect();return b(d,{isIntersecting:d,target:a,intersectionRatio:"number"==typeof c.threshold?c.threshold:0,time:0,boundingClientRect:e,intersectionRect:e,rootBounds:e}),()=>{}}let{id:e,observer:j,elements:k}=function(a){let b=Object.keys(a).sort().filter(b=>void 0!==a[b]).map(b=>{var c;return`${b}_${"root"===b?!(c=a.root)?"0":(g.has(c)||(h+=1,g.set(c,h.toString())),g.get(c)):a[b]}`}).toString(),c=f.get(b);if(!c){let d,e=new Map,g=new IntersectionObserver(b=>{b.forEach(b=>{var c;let f=b.isIntersecting&&d.some(a=>b.intersectionRatio>=a);a.trackVisibility&&void 0===b.isVisible&&(b.isVisible=f),null==(c=e.get(b.target))||c.forEach(a=>{a(f,b)})})},a);d=g.thresholds||(Array.isArray(a.threshold)?a.threshold:[a.threshold||0]),c={id:b,observer:g,elements:e},f.set(b,c)}return c}(c),l=k.get(a)||[];return k.has(a)||k.set(a,l),l.push(b),j.observe(a),function(){l.splice(l.indexOf(b),1),0===l.length&&(k.delete(a),j.unobserve(a)),0===k.size&&(j.disconnect(),f.delete(e))}}(r,(a,b)=>{v({inView:a,entry:b}),t.current&&t.current(a,b),b.isIntersecting&&l&&d&&(d(),d=void 0)},{root:k,rootMargin:e,threshold:a,trackVisibility:c,delay:b},o),()=>{d&&d()}},[Array.isArray(a)?a.toString():a,r,k,e,l,m,c,o,b]);let w=null==(q=u.entry)?void 0:q.target,x=d.useRef(void 0);r||!w||l||m||x.current===w||(x.current=w,v({inView:!!n,entry:void 0}));let y=[s,u.inView,u.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}d.Component},40609:(a,b,c)=>{Promise.resolve().then(c.bind(c,23362))},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},43649:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},46415:(a,b,c)=>{"use strict";c.d(b,{A:()=>K});var d,e,f,g,h,i,j,k,l,m,n,o,p=c(60687),q=c(43210),r=c(95391),s=c(88920),t=c(92576);!function(a){a.STRING="string",a.NUMBER="number",a.INTEGER="integer",a.BOOLEAN="boolean",a.ARRAY="array",a.OBJECT="object"}(d||(d={})),function(a){a.LANGUAGE_UNSPECIFIED="language_unspecified",a.PYTHON="python"}(e||(e={})),function(a){a.OUTCOME_UNSPECIFIED="outcome_unspecified",a.OUTCOME_OK="outcome_ok",a.OUTCOME_FAILED="outcome_failed",a.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(f||(f={})),function(a){a.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(g||(g={})),function(a){a.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE"}(h||(h={})),function(a){a.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH"}(i||(i={})),function(a){a.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",a.SAFETY="SAFETY",a.OTHER="OTHER"}(j||(j={})),function(a){a.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",a.STOP="STOP",a.MAX_TOKENS="MAX_TOKENS",a.SAFETY="SAFETY",a.RECITATION="RECITATION",a.LANGUAGE="LANGUAGE",a.BLOCKLIST="BLOCKLIST",a.PROHIBITED_CONTENT="PROHIBITED_CONTENT",a.SPII="SPII",a.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",a.OTHER="OTHER"}(k||(k={})),function(a){a.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",a.RETRIEVAL_QUERY="RETRIEVAL_QUERY",a.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",a.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",a.CLASSIFICATION="CLASSIFICATION",a.CLUSTERING="CLUSTERING"}(l||(l={})),function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.AUTO="AUTO",a.ANY="ANY",a.NONE="NONE"}(m||(m={})),function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC"}(n||(n={})),function(a){a.GENERATE_CONTENT="generateContent",a.STREAM_GENERATE_CONTENT="streamGenerateContent",a.COUNT_TOKENS="countTokens",a.EMBED_CONTENT="embedContent",a.BATCH_EMBED_CONTENTS="batchEmbedContents"}(o||(o={})),k.RECITATION,k.SAFETY,k.LANGUAGE,"function"==typeof SuppressedError&&SuppressedError;var u=c(79894),v=c(58893),w=c(21),x=c(18921),y=c(10083),z=c(78464),A=c(88233),B=c(47342),C=c(41862),D=c(1303),E=c(11860),F=c(8819);let G={primary:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-indigo-400 bg-transparent text-indigo-600 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-indigo-100 hover:text-indigo-700 hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",secondary:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-stone-400 bg-transparent text-stone-700 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-stone-200 hover:text-stone-800 hover:border-stone-500 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-stone-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed"},H=({inputMode:a,setInputMode:b,disabled:c})=>(0,p.jsxs)("div",{className:"mb-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"選擇輸入模式"}),(0,p.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,p.jsxs)("div",{className:`relative border-2 rounded-lg p-4 cursor-pointer transition-all ${"ai"===a?"border-indigo-500 bg-indigo-500/10":"border-gray-300 hover:border-gray-400"}`,onClick:()=>!c&&b("ai"),children:[(0,p.jsx)("h4",{className:"font-bold text-gray-900",children:"AI 智慧分析"}),(0,p.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"上傳檔案或網址，由 AI 自動生成摘要"})]}),(0,p.jsxs)("div",{className:`relative border-2 rounded-lg p-4 cursor-pointer transition-all ${"manual"===a?"border-indigo-500 bg-indigo-500/10":"border-gray-300 hover:border-gray-400"}`,onClick:()=>!c&&b("manual"),children:[(0,p.jsx)("h4",{className:"font-bold text-gray-900",children:"手動輸入"}),(0,p.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"自行填寫所有公告欄位"})]})]})]}),I=({selectedFiles:a,setSelectedFiles:b,disabled:c,showToast:d})=>{let e=(0,q.useRef)(null),f="15 MB",g={"application/pdf":["pdf"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/webp":["webp"],"application/msword":["doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.ms-excel":["xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.ms-powerpoint":["ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.oasis.opendocument.presentation":["odp"]},h=Object.values(g).flat().map(a=>`.${a}`).join(","),i=c=>{let e=[];for(let b of c){let c=b.name.split(".").pop()?.toLowerCase()||"";if(!(Object.keys(g).includes(b.type)||Object.values(g).flat().includes(c))){d(`不支援的檔案類型: ${b.name}`,"warning");continue}if(a.some(a=>a.name===b.name)){d(`檔案 "${b.name}" 已存在`,"warning");continue}if(b.size>0xf00000){d(`檔案大小超過 ${f} 限制: ${b.name}`,"warning");continue}if(a.length+e.length>=8){d(`最多只能選擇 8 個檔案`,"warning");break}b.isNewFile=!0,e.push(b)}e.length>0&&b(a=>[...a,...e])};return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-300 ${!c?"border-gray-300 hover:border-indigo-400 bg-transparent cursor-pointer":"bg-gray-100/50 cursor-not-allowed"}`,onDragOver:a=>a.preventDefault(),onDrop:a=>{a.preventDefault(),c||i(Array.from(a.dataTransfer.files))},onClick:()=>!c&&e.current?.click(),children:[(0,p.jsx)("input",{type:"file",ref:e,onChange:a=>{i(Array.from(a.target.files)),a.target.value=""},className:"hidden",accept:h,disabled:c,multiple:!0}),(0,p.jsx)(y.A,{className:"mx-auto h-10 w-10 text-gray-400"}),(0,p.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["拖曳檔案到此，或 ",(0,p.jsx)("span",{className:"font-medium text-indigo-600",children:"點擊上傳"})]}),(0,p.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["已選擇 ",a.length," / ",8," 個檔案"]}),(0,p.jsxs)("p",{className:"mt-1 text-xs text-gray-400",children:["支援文件 (Word, Excel, PPT, PDF, ODT, ODS, ODP) 及圖片格式，單一檔案大小上限為 ",f]})]}),a.length>0&&(0,p.jsx)("div",{className:"space-y-2",children:(0,p.jsx)("div",{className:"space-y-2 rounded-lg p-2 bg-transparent",children:a.map((a,c)=>(0,p.jsxs)("div",{className:"relative flex items-center justify-between p-3 rounded-lg bg-white border",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,p.jsx)(z.A,{className:"h-6 w-6 flex-shrink-0 text-blue-500"}),(0,p.jsxs)("div",{className:"overflow-hidden",children:[(0,p.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:a.name}),(0,p.jsxs)("p",{className:"text-xs text-gray-500",children:[a.type," • ",(a=>a?a<1024?`${a} B`:a<1048576?`${(a/1024).toFixed(1)} KB`:`${(a/1048576).toFixed(1)} MB`:"0 B")(a.size)]})]})]}),(0,p.jsx)("button",{onClick:()=>b(a=>a.filter((a,b)=>b!==c)),className:"p-1 rounded-full transition-colors text-red-500 hover:bg-red-100",title:"移除",children:(0,p.jsx)(A.A,{size:18})})]},a.name+c))})})]})},J=({urls:a,setUrls:b,disabled:c,showToast:d})=>{let[e,f]=(0,q.useState)(""),g=()=>{let c=e.trim();if(!c)return void d("請輸入網址","warning");try{new URL(c)}catch{d("請輸入有效的網址","warning");return}if(a.some(a=>a===c))return void d("此網址已經存在","warning");b(a=>[...a,c]),f("")};return(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("input",{type:"url",value:e,onChange:a=>f(a.target.value),onKeyPress:a=>"Enter"===a.key&&(a.preventDefault(),g()),placeholder:"輸入網址進行 AI 分析",className:"w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30 flex-grow",disabled:c}),(0,p.jsx)("button",{type:"button",onClick:g,disabled:c||!e.trim(),className:G.primary,children:"添加"})]}),a.length>0&&(0,p.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto p-2",children:a.map((a,d)=>(0,p.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border rounded-lg",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,p.jsx)(B.A,{className:"w-5 h-5 text-indigo-500 flex-shrink-0"}),(0,p.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-indigo-600 hover:underline truncate",children:a})]}),!c&&(0,p.jsx)("button",{onClick:()=>{b(a=>a.filter((a,b)=>b!==d))},className:"p-1 rounded-full text-red-500 hover:bg-red-100 ml-2",title:"移除網址",children:(0,p.jsx)(A.A,{size:16})})]},d))})]})};function K({isOpen:a,onClose:b,refreshAnnouncements:c}){let[d,e]=(0,q.useState)("ai"),[f,g]=(0,q.useState)(0),[h,i]=(0,q.useState)(!1),[j,k]=(0,q.useState)("處理中..."),[l,m]=(0,q.useState)([]),[n,o]=(0,q.useState)([]),[y,z]=(0,q.useState)({show:!1,message:"",type:"success"}),K=(0,q.useRef)(null),L={title:"",summary:"",category:"",application_start_date:"",application_end_date:"",target_audience:"",application_limitations:"",submission_method:"",external_urls:[{url:""}],is_active:!0},[M,N]=(0,q.useState)(L),O="w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30",P=(a,b="success")=>z({show:!0,message:a,type:b}),Q=(0,q.useCallback)(a=>N(b=>({...b,summary:a})),[]),R=(0,q.useCallback)(a=>N(b=>({...b,target_audience:a})),[]),S=a=>N(b=>({...b,[a.target.name]:a.target.value})),T=""!==M.title.trim()&&""!==M.summary.replace(/<[^>]*>?/gm,"").trim(),U=async a=>({inlineData:{data:await new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>b(d.result.split(",")[1]),d.onerror=a=>c(a),d.readAsDataURL(a)}),mimeType:a.type}}),V=async()=>{if(0===l.length&&0===n.length)return void P("請至少上傳一個檔案或提供一個網址","warning");if(!K.current)return void P("AI 模型尚未初始化或初始化失敗","error");i(!0),g(1);try{let a;k("正在準備分析資料...");let b=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"],c=l.filter(a=>b.includes(a.type));c.length>0&&console.log(`找到 ${c.length} 個可供 AI 分析的檔案:`,c.map(a=>a.name)),c.length<l.length&&console.log(`有 ${l.length-c.length} 個檔案將作為一般附件，不參與 AI 分析。`);let d=[],e=[],f=[];if(n.length>0){k(`正在分析 ${n.length} 個網址...`);let a=n.map(async a=>{try{let b=await fetch("/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:a})});if(!b.ok)return console.warn(`爬取網址失敗 (API 狀態碼: ${b.status}): ${a}`),{url:a,success:!1};let c=await b.json();if(c.error||!c.scrapedText)return console.warn(`無法從網址提取內容: ${a}. ${c.message||""}`),{url:a,success:!1};return{url:a,text:c.scrapedText,success:!0}}catch(b){return console.error(`爬取網址時發生前端錯誤: ${a}`,b),{url:a,success:!1}}});(await Promise.all(a)).forEach(({url:a,text:b,success:c})=>{c?f.push(`--- 網址內容 (${a}) ---
${b}`):e.push(a)})}let h=`
# 角色 (Persona)
你是一位頂尖的「彰化師範大學獎學金公告分析專家」。你的風格是專業、精確且以學生為中心。你的任務是將一篇關於獎學金的公告，轉換成一段重點突出、視覺清晰的 HTML 公告，並提取結構化資料。你只須關注與彰師大「大學部」及「碩士班」學生相關的資訊，並嚴格遵循所有規則。

# 核心任務 (Core Task)
你的任務是根據下方提供的「公告全文」，執行以下兩項任務，並將結果合併在一個**單一的 JSON 物件**中回傳。

## 任務一：提取結構化資料 (JSON Extraction)
提取公告中的關鍵資訊，並以一個嚴格的 JSON 物件格式回傳。

### 欄位規則 (Field Rules)
- **不確定性原則**：若資訊未提及或不明確，**必須**回傳 \`null\`，**禁止**自行猜測。
- **日期格式**：所有日期欄位格式必須是 \`YYYY-MM-DD\`。民國年 + 1911 即為西元年。
- **欄位列表**：
    1.  \`title\` (string | null): 公告的**簡短**標題，必須包含**提供單位**和**獎學金名稱**。例如：「國際崇她社『崇她獎』獎學金」。
    2.  \`category\` (string | null): 根據下方的「代碼定義」從 'A'~'E' 中選擇一個。
    3.  \`application_start_date\` (string | null): **申請開始日期**。
    4.  \`application_end_date\` (string | null): **申請結止日期**，格式必須是 'YYYY-MM-DD' 。若只提及月份，以該月最後一天為準。若為區間，以**結束日期**為準，備註: 民國年 + 1911 即為西元年。
    5.  \`target_audience\` (string | null): **目標對象**。**此欄位必須是 HTML 格式**，並遵循下方的「視覺化與樣式指導」為關鍵字上色。
    6.  \`application_limitations\` (string | null): **兼領限制**。若明確提及**不行**兼領，回傳 'N'，否則一律回傳 'Y'。
    7.  \`submission_method\` (string | null): **送件方式**。簡要說明最終的送件管道。
    8.  \`external_urls\` (array of objects | []): **所有相關網址**。將所有找到的 URL 整理成一個物件陣列，格式為 \`[{ "url": "https://..." }]\`。若無則回傳空陣列 \`[]\`。
    9.  \`summary\` (string | null): **公告摘要**。**此欄位必須是 HTML 格式**，並遵循下方的「視覺化與樣式指導」為關鍵字上色。
    
## 任務二：生成 HTML 重點摘要 (HTML Summary Generation)
根據你分析的內容，生成一份專業、條理分明的 HTML 格式重點摘要。

### 內容與結構指導
- **摘要必須包含**：申請期限、申請資格、獎助金額、應繳文件、其他注意事項。
- **表格優先**：當資訊具有「項目-內容」的對應關係資訊時，**優先使用 \`<table>\`** 以提升閱讀性。

### 視覺化與樣式指導 (適用於 summary 和 target_audience)
- **多色彩重點標記**：
    - **金額、日期、名額等數字類關鍵字**: \`<span style="color: #D6334C; font-weight: bold;">\`
    - **身份、成績等申請條件**: \`<span style="color: #F79420; font-weight: bold;">\`
    - **所有小標題**: \`<h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">\`
- \`summary\` 的內容必須放在 JSON 物件的 \`summary\` (string) 鍵中。

# 獎助學金代碼定義 (Category Definitions)
- **A**: 各縣市政府獎助學金
- **B**: 縣市政府以外之各級公家機關及公營單位獎助學金
- **C**: 宗親會及民間各項指定身分獎助學金 (指定姓名、籍貫、學系等)
- **D**: 非公家機關或其他無法歸類的獎助學金
- **E**: 獎學金得獎名單公告

# 最終輸出規則
- **你的回覆必須是、也只能是一個 JSON 物件**，不含任何 Markdown 標記。
- 請嚴格模仿下方範例的 JSON 結構和 HTML 風格。

# 輸出格式與範例 (Output Format & Example)
\`\`\`json
{
  "title": "國際蘭馨交流協會『讓夢想起飛』獎學金",
  "category": "C",
  "application_start_date": null,
  "application_end_date": "2025-07-23",
  "target_audience": "<ul><li>國內各大學日間部、進修學士班之<span style=\\"color: #F79420; font-weight: bold;\\">在學女學生</span>。</li><li>歷年學業平均成績達 <span style=\\"color: #F79420; font-weight: bold;\\">70分</span>。</li></ul>",
  "application_limitations": "N",
  "submission_method": "送件至生輔組或將申請資料寄送至承辦人員信箱: act5718@gmail.com",
  "external_urls": [{ "url": "https://example.com/scholarship-info" }],
  "summary": "<h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請期限與方式</h4><p>親送或寄送郵件至生輔組承辦人員，由學校代為辦理，截止日期為 <span style="color: #D6334C; font-weight: bold;">2025年7月23日</span>。</p><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請資格</h4><ul><li>家境清寒且就讀<span style="color: #F79420; font-weight: bold;">國立大學</span>之<span style="color: #F79420; font-weight: bold;">績優女學生</span>（不限年級）。</li><li>在校學業平均成績達 <span style="color: #F79420; font-weight: bold;">70分</span> 以上，且未受小過以上處分。</li></ul><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">獎助金額</h4><p>依申請年級不同，提供相對應的學費補助，詳情如下：</p><table style="width: 100%; border-collapse: collapse; margin-top: 0.5em;"><thead><tr style="background-color: #f2f2f2;"><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">適用對象</th><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">補助內容</th></tr></thead><tbody><tr><td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #F79420; font-weight: bold;">大一新生及大三學生</span></td><td style="padding: 8px; border: 1px solid #ddd;">通過審查後，補助<span style="color: #D6334C; font-weight: bold;">兩年</span>學雜費</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #F79420; font-weight: bold;">大二女學生</span></td><td style="padding: 8px; border: 1px solid #ddd;">通過審查後，補助<span style="color: #D6334C; font-weight: bold;">一年</span>學雜費</td></tr></tbody></table><p style="margin-top: 0.5em;">註：已受補助學生可持續獲得補助至其大四學年，但須符合每階段資格審查標準。</p><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請應繳文件</h4><table style="width: 100%; border-collapse: collapse; margin-top: 0.5em;"><thead><tr style="background-color: #f2f2f2;"><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">文件項目</th><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">備註</th></tr></thead><tbody><tr><td style="padding: 8px; border: 1px solid #ddd;">1. 全家人口戶籍謄本</td><td style="padding: 8px; border: 1px solid #ddd;">-</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">2. 全家人口所得及財產資料</td><td style="padding: 8px; border: 1px solid #ddd;">請向國稅局申請</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">3. 最近學期成績單</td><td style="padding: 8px; border: 1px solid #ddd;">-</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">4. 大學完整學業成績單與操行紀錄</td><td style="padding: 8px; border: 1px solid #ddd;">適用於<span style="color: #F79420; font-weight: bold;">大三以上</span>學生</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">5. 相關證明文件</td><td style="padding: 8px; border: 1px solid #ddd;">如身心障礙手冊、重大傷病卡等 (無則免附)</td></tr></tbody></table><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">其他注意事項</h4><p>申請人家庭若有以下任一情況，則<span style="color: #D6334C; font-weight: bold;">不符合</span>清寒補助資格：</p><ul><li>全戶存款本金合計超過 <span style="color: #D6334C; font-weight: bold;">10萬元</span>。</li><li>全戶土地及房屋公告現值合計超過 <span style="color: #D6334C; font-weight: bold;">100萬元</span>（自用住宅不在此限）。</li><li>其他情況如休學、畢業或家庭經濟狀況已顯著改善者。</li></ul>"
}
\`\`\`

# 公告全文 (Source Text)
---
請分析以下資訊：
${f.length>0?`
# 已爬取的網址內容:
${f.join("\n\n")}`:""}
${e.length>0?`
# 以下網址無法爬取，請直接分析:
${e.join("\n")}`:""}
${l.length>0?`
# 檔案資料來源`:""}
`;if(d.push({text:h}),c.length>0){let a=c.map(a=>U(a)),b=await Promise.all(a);d.push(...b),P(`已附加 ${c.length} 個檔案進行 AI 分析`,"info")}k("AI 分析中，請稍候...");let i=(await K.current.generateContent({contents:[{parts:d}]})).response;try{a=JSON.parse(i.text())}catch(a){throw console.error("AI 回應的原始文字:",i.text()),Error(`AI 回應的 JSON 格式解析失敗: ${a.message}`)}if(!a.title||!a.summary)throw console.error("AI 回應不完整:",a),Error("AI 回應中缺少必要的 `title` 或 `summary` 欄位。");N(b=>({...b,...a,is_active:!0,external_urls:Array.isArray(a.external_urls)&&a.external_urls.length>0?a.external_urls:[{url:""}]})),g(2)}catch(a){console.error("AI 分析流程失敗:",a),P(`分析失敗: ${a.message}`,"error"),g(0)}finally{i(!1)}},W=async()=>{if(!T)return void P("請填寫所有必填欄位","warning");i(!0),k("儲存中...");try{let a=[],d=l.filter(a=>a.isNewFile);if(d.length>0){k(`正在上傳 ${d.length} 個檔案...`);let b=new FormData;for(let a of d)b.append("files",a);let c=await (0,x.tm)("/api/upload-files",{method:"POST",body:b});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(`檔案上傳失敗: ${a.error||c.statusText}`)}let e=await c.json();if(e.data.errors&&e.data.errors.length>0){let a=e.data.errors.map(a=>a.fileName).join(", ");P(`部分檔案處理失敗: ${a}`,"warning")}a=e.data.uploaded||[]}k("正在寫入資料庫...");let e=M.external_urls.filter(a=>a.url&&""!==a.url.trim()),f={title:M.title,summary:M.summary,category:M.category,application_start_date:M.application_start_date||null,application_end_date:M.application_end_date||null,target_audience:M.target_audience,application_limitations:M.application_limitations,submission_method:M.submission_method,external_urls:JSON.stringify(e),is_active:M.is_active},{data:g,error:h}=await r.N.from("announcements").insert(f).select().single();if(h)throw h;if(a.length>0){let b=a.map(a=>({announcement_id:g.id,file_name:a.originalName,stored_file_path:a.path,file_size:a.size,mime_type:a.mimeType})),{error:c}=await r.N.from("attachments").insert(b);if(c)throw c}P("公告發布成功!","success"),c&&c(),b()}catch(a){console.error("儲存失敗:",a),P(`儲存失敗: ${a.message}`,"error")}finally{i(!1)}};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(w.A,{show:y.show,message:y.message,type:y.type,onClose:()=>z(a=>({...a,show:!1}))}),(0,p.jsx)(s.N,{children:a&&(0,p.jsx)(t.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 pt-16",children:(0,p.jsxs)(t.P.div,{initial:{scale:.95,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:50,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-5xl flex flex-col overflow-hidden border border-white/20",style:{height:"calc(100vh - 10rem)"},onClick:a=>a.stopPropagation(),children:[(0,p.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,p.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"新增公告"}),(0,p.jsx)("button",{onClick:()=>{window.confirm("確認關閉公告編輯模組嗎？如尚未儲存將丟失此編輯紀錄！")&&b()},disabled:h,className:"text-gray-400 hover:text-gray-600 p-2 rounded-full",children:(0,p.jsx)(E.A,{size:20})})]}),(0,p.jsx)("div",{className:"flex-grow p-6 overflow-y-auto",children:0===f?(0,p.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,p.jsx)(H,{inputMode:d,setInputMode:e,disabled:h}),(0,p.jsx)("hr",{className:"my-6 border-gray-200"}),"ai"===d?(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"上傳檔案或提供網址"}),(0,p.jsx)(I,{selectedFiles:l,setSelectedFiles:m,disabled:h,showToast:P}),(0,p.jsx)(J,{urls:n,setUrls:o,disabled:h,showToast:P})]}):(0,p.jsxs)("div",{className:"text-center text-gray-500 p-8 bg-gray-50/50 rounded-lg",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"手動輸入模式"}),(0,p.jsx)("p",{children:"請點擊「下一步」開始手動填寫公告內容。"})]})]}):1===f?(0,p.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[(0,p.jsx)(C.A,{className:"animate-spin h-12 w-12 text-indigo-600 mb-4"}),(0,p.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:j}),(0,p.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"請稍候，AI 正在為您生成公告內容..."})]}):2===f?(0,p.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:["公告標題 ",(0,p.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,p.jsx)("input",{type:"text",id:"title",name:"title",className:O,value:M.title,onChange:S})]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"is_active",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告狀態"}),(0,p.jsxs)("select",{id:"is_active",name:"is_active",className:O,value:M.is_active,onChange:a=>N(b=>({...b,is_active:"true"===a.target.value})),children:[(0,p.jsx)("option",{value:!0,children:"上架"}),(0,p.jsx)("option",{value:!1,children:"下架"})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"category",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"獎學金分類"}),(0,p.jsxs)("select",{id:"category",name:"category",className:O,value:M.category,onChange:S,children:[(0,p.jsx)("option",{value:"",children:"請選擇"}),(0,p.jsx)("option",{value:"A",children:"A：各縣市政府獎學金"}),(0,p.jsx)("option",{value:"B",children:"B：縣市政府以外之各級公家機關及公營單位獎學金"}),(0,p.jsx)("option",{value:"C",children:"C：宗教及民間各項指定身分獎學金"}),(0,p.jsx)("option",{value:"D",children:"D：非公家機關或其他無法歸類的獎助學金"}),(0,p.jsx)("option",{value:"E",children:"E：本校獲配推薦名額獎助學金"}),(0,p.jsx)("option",{value:"F",children:"F：校外獎助學金得獎公告"}),(0,p.jsx)("option",{value:"G",children:"G：校內獎助學金"})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"application_start_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請開始日期"}),(0,p.jsx)("input",{type:"date",id:"application_start_date",name:"application_start_date",className:O,value:M.application_start_date,onChange:S})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"application_end_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告結束日期"}),(0,p.jsx)("input",{type:"date",id:"application_end_date",name:"application_end_date",className:O,value:M.application_end_date,onChange:S})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"submission_method",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"送件方式"}),(0,p.jsx)("input",{type:"text",id:"submission_method",name:"submission_method",className:O,value:M.submission_method,onChange:S})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"application_limitations",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"兼領限制"}),(0,p.jsxs)("select",{id:"application_limitations",name:"application_limitations",className:O,value:M.application_limitations,onChange:S,children:[(0,p.jsx)("option",{value:"",children:"未指定"}),(0,p.jsx)("option",{value:"Y",children:"可兼領"}),(0,p.jsx)("option",{value:"N",children:"不可兼領"})]})]})]}),(0,p.jsxs)("div",{className:"flex flex-col min-h-[250px]",children:[(0,p.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:"適用對象"}),(0,p.jsx)("div",{className:"relative flex-grow",children:(0,p.jsx)(u.A,{value:M.target_audience,onChange:R,disabled:h})})]}),(0,p.jsxs)("div",{className:"flex flex-col min-h-[400px]",children:[(0,p.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:["公告摘要 ",(0,p.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,p.jsx)("div",{className:"relative flex-grow",children:(0,p.jsx)(u.A,{value:M.summary,onChange:Q,disabled:h})})]}),(0,p.jsxs)("div",{className:"p-4 bg-slate-500/5 rounded-lg border",children:[(0,p.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"附件與連結"}),(0,p.jsx)(I,{selectedFiles:l,setSelectedFiles:m,disabled:h,showToast:P}),(0,p.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,p.jsxs)("label",{className:"block text-sm font-medium text-gray-600 flex items-center gap-2",children:[(0,p.jsx)(B.A,{size:16}),"外部參考連結"]}),M.external_urls.map((a,b)=>(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("input",{type:"url",className:O,value:a.url,onChange:a=>((a,b)=>{let c=[...M.external_urls];c[a].url=b,N(a=>({...a,external_urls:c}))})(b,a.target.value),placeholder:"https://example.com"}),M.external_urls.length>1&&(0,p.jsx)("button",{type:"button",onClick:()=>N(a=>({...a,external_urls:a.external_urls.filter((a,c)=>c!==b)})),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:(0,p.jsx)(A.A,{size:16})})]},b)),(0,p.jsx)(v.A,{type:"button",variant:"ghost",size:"sm",onClick:()=>N(a=>({...a,external_urls:[...a.external_urls,{url:""}]})),leftIcon:(0,p.jsx)(D.A,{size:16}),children:"新增連結"})]})]})]}):void 0}),(0,p.jsxs)("div",{className:"p-4 bg-black/5 flex justify-between items-center flex-shrink-0 border-t border-black/10",children:[(0,p.jsx)("div",{children:2===f&&(0,p.jsx)("button",{type:"button",onClick:()=>g(0),disabled:h,className:G.secondary,children:"返回上一步"})}),(0,p.jsxs)("div",{className:"flex justify-end space-x-3",children:[0===f&&(0,p.jsx)("button",{type:"button",onClick:()=>{"ai"===d?V():(N(L),g(2))},disabled:h||"ai"===d&&0===l.length&&0===n.length,className:G.primary,children:"ai"===d?"開始 AI 分析":"下一步"}),2===f&&(0,p.jsxs)("button",{type:"button",onClick:W,disabled:h||!T,className:G.primary,children:[h?(0,p.jsx)(C.A,{size:16,className:"animate-spin"}):(0,p.jsx)(F.A,{size:16}),(0,p.jsx)("span",{children:"儲存並發布"})]})]})]})]})})})]})}},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},61378:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>C.a,__next_app__:()=>I,handler:()=>K,pages:()=>H,routeModule:()=>J,tree:()=>G});var d=c(65239),e=c(48088),f=c(47220),g=c(81289),h=c(26191),i=c(14823),j=c(71998),k=c(92603),l=c(54649),m=c(32781),n=c(82602),o=c(61268),p=c(4853),q=c(261),r=c(5052),s=c(9977),t=c(26713),u=c(43365),v=c(71454),w=c(67778),x=c(46143),y=c(39105),z=c(38171),A=c(86439),B=c(16133),C=c.n(B),D=c(30893),E=c(52836),F={};for(let a in D)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(F[a]=()=>D[a]);c.d(b,F);let G={children:["",{children:["manage",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,23362)),"/Users/hune1228/NCUE-Scholarship/NCUE-Scholarship/src/app/manage/page.jsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,39769)),"/Users/hune1228/NCUE-Scholarship/NCUE-Scholarship/src/app/layout.jsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,16133,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,80849,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,29868,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,79615,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,H=["/Users/hune1228/NCUE-Scholarship/NCUE-Scholarship/src/app/manage/page.jsx"],I={require:c,loadChunk:()=>Promise.resolve()},J=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/manage/page",pathname:"/manage",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:G},distDir:".next",projectDir:""});async function K(a,b,c){var d;let B="/manage/page";"/index"===B&&(B="/");let F="false",L=(0,h.getRequestMeta)(a,"postponed"),M=(0,h.getRequestMeta)(a,"minimalMode"),N=await J.prepare(a,b,{srcPage:B,multiZoneDraftMode:F});if(!N)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:O,query:P,params:Q,parsedUrl:R,pageIsDynamic:S,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,serverActionsManifest:W,clientReferenceManifest:X,subresourceIntegrityManifest:Y,prerenderManifest:Z,isDraftMode:$,resolvedPathname:_,revalidateOnlyGenerated:aa,routerServerContext:ab,nextConfig:ac}=N,ad=R.pathname||"/",ae=(0,q.normalizeAppPath)(B),{isOnDemandRevalidate:af}=N,ag=Z.dynamicRoutes[ae],ah=Z.routes[_],ai=!!(ag||ah||Z.routes[ae]),aj=a.headers["user-agent"]||"",ak=(0,t.getBotType)(aj),al=(0,o.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??!!a.headers[s.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[s.RSC_HEADER],ao=(0,r.getIsPossibleServerAction)(a),ap=(0,l.checkIsAppPPREnabled)(ac.experimental.ppr)&&(null==(d=Z.routes[ae]??Z.dynamicRoutes[ae])?void 0:d.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?L:void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=!aj||(0,o.shouldServeStreamingMetadata)(aj,ac.htmlLimitedBots);al&&ap&&(ai=!1,av=!1);let aw=!0===J.isDev||!ai||"string"==typeof L||at,ax=al&&ap,ay=null;$||!ai||aw||ao||as||at||(ay=_);let az=ay;!az&&J.isDev&&(az=_);let aA={...D,tree:G,pages:H,GlobalError:C(),handler:K,routeModule:J,__next_app__:I};W&&X&&(0,n.setReferenceManifestsSingleton)({page:B,clientReferenceManifest:X,serverActionsManifest:W,serverModuleMap:(0,p.createServerModuleMap)({serverActionsManifest:W})});let aB=a.method||"GET",aC=(0,g.getTracer)(),aD=aC.getActiveScopeSpan();try{let d=async(c,d)=>{let e=new k.NodeNextRequest(a),f=new k.NodeNextResponse(b);return J.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aC.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aB} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aB} ${a.url}`)})},f=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:P,params:Q,page:ae,sharedContext:{buildId:O},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aA,Component:(0,j.T)(aA),params:Q,routeModule:J,page:B,postponed:f,shouldWaitOnAllReady:ax,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||aw,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,subresourceIntegrityManifest:Y,serverActionsManifest:W,clientReferenceManifest:X,setIsrStatus:null==ab?void 0:ab.setIsrStatus,dir:J.projectDir,isDraftMode:$,isRevalidate:ai&&!f&&!at,botType:ak,isOnDemandRevalidate:af,isPossibleServerAction:ao,assetPrefix:ac.assetPrefix,nextConfigOutput:ac.output,crossOrigin:ac.crossOrigin,trailingSlash:ac.trailingSlash,previewProps:Z.preview,deploymentId:ac.deploymentId,enableTainting:ac.experimental.taint,htmlLimitedBots:ac.htmlLimitedBots,devtoolSegmentExplorer:ac.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ac.reactMaxHeadersLength,multiZoneDraftMode:F,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ac.experimental.cacheLife,basePath:ac.basePath,serverActions:ac.experimental.serverActions,...aq?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ac.expireTime,staleTimes:ac.experimental.staleTimes,dynamicIO:!!ac.experimental.dynamicIO,clientSegmentCache:!!ac.experimental.clientSegmentCache,dynamicOnHover:!!ac.experimental.dynamicOnHover,inlineCss:!!ac.experimental.inlineCss,authInterrupts:!!ac.experimental.authInterrupts,clientTraceMetadata:ac.experimental.clientTraceMetadata||[]},waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>J.onRequestError(a,b,d,ab),err:(0,h.getRequestMeta)(a,"invokeError"),dev:J.isDev}},k=await d(e,i),{metadata:l}=k,{cacheControl:m,headers:n={},fetchTags:o}=l;if(o&&(n[x.NEXT_CACHE_TAGS_HEADER]=o),a.fetchMetrics=l.fetchMetrics,ai&&(null==m?void 0:m.revalidate)===0&&!J.isDev&&!ap){let a=l.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${_}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:u.CachedRouteKind.APP_PAGE,html:k,headers:n,rscData:l.flightData,postponed:l.postponed,status:l.statusCode,segmentData:l.segmentData},cacheControl:m}},l=async({hasResolved:d,previousCacheEntry:g,isRevalidating:i,span:j})=>{let k,l=!1===J.isDev,n=d||b.writableEnded;if(af&&aa&&!g&&!M)return(null==ab?void 0:ab.render404)?await ab.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ag&&(k=(0,v.parseFallbackField)(ag.fallback)),k===v.FallbackMode.PRERENDER&&(0,t.isBot)(aj)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),(null==g?void 0:g.isStale)===-1&&(af=!0),af&&(k!==v.FallbackMode.NOT_FOUND||g)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),!M&&k!==v.FallbackMode.BLOCKING_STATIC_RENDER&&az&&!n&&!$&&S&&(l||!ah)){let b;if((l||ag)&&k===v.FallbackMode.NOT_FOUND)throw new A.NoFallbackError;if(ap&&!an){if(b=await J.handleResponse({cacheKey:l?ae:null,req:a,nextConfig:ac,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:Z,isRoutePPREnabled:ap,responseGenerator:async()=>f({span:j,postponed:void 0,fallbackRouteParams:l||ar?(0,m.u)(ae):null}),waitUntil:c.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=af||i||!as?void 0:as;if(aq&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:u.CachedRouteKind.PAGES,html:w.default.fromStatic(""),pageData:{},headers:void 0,status:void 0}};let p=S&&ap&&((0,h.getRequestMeta)(a,"renderFallbackShell")||ar)?(0,m.u)(ad):null;return f({span:j,postponed:o,fallbackRouteParams:p})},n=async d=>{var g,i,j,k,m;let n,o=await J.handleResponse({cacheKey:ay,responseGenerator:a=>l({span:d,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:af,isRoutePPREnabled:ap,req:a,nextConfig:ac,prerenderManifest:Z,waitUntil:c.waitUntil});if($&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),J.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!o){if(ay)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(g=o.value)?void 0:g.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(j=o.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof o.value.postponed;ai&&!at&&(!p||am)&&(M||b.setHeader("x-nextjs-cache",af?"REVALIDATED":o.isMiss?"MISS":o.isStale?"STALE":"HIT"),b.setHeader(s.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=o;if(as)n={revalidate:0,expire:void 0};else if(M&&an&&!am&&ap)n={revalidate:0,expire:void 0};else if(!J.isDev)if($)n={revalidate:0,expire:void 0};else if(ai){if(o.cacheControl)if("number"==typeof o.cacheControl.revalidate){if(o.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${o.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});n={revalidate:o.cacheControl.revalidate,expire:(null==(k=o.cacheControl)?void 0:k.expire)??ac.expireTime}}else n={revalidate:x.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(n={revalidate:0,expire:void 0});if(o.cacheControl=n,"string"==typeof au&&(null==q?void 0:q.kind)===u.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(m=q.headers)?void 0:m[x.NEXT_CACHE_TAGS_HEADER];M&&ai&&c&&"string"==typeof c&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(d),cacheControl:o.cacheControl}):(b.statusCode=204,(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(""),cacheControl:o.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...o,value:{...o.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&as)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(M&&ai||delete a[x.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let t=null==(i=q.headers)?void 0:i[x.NEXT_CACHE_TAGS_HEADER];if(M&&ai&&t&&"string"==typeof t&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,t),!q.status||an&&ap||(b.statusCode=q.status),!M&&q.status&&E.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),p&&b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"1"),an&&!$){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:q.html,cacheControl:at?{revalidate:0,expire:void 0}:o.cacheControl})}return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(q.rscData),cacheControl:o.cacheControl})}let v=q.html;if(!p||M)return(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:o.cacheControl});if(aq)return v.chain(new ReadableStream({start(a){a.enqueue(y.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}});let A=new TransformStream;return v.chain(A.readable),f({span:d,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(A.writable)}).catch(a=>{A.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}})};if(!aD)return await aC.withPropagatedContext(a.headers,()=>aC.trace(i.BaseServerSpan.handleRequest,{spanName:`${aB} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aB,"http.target":a.url}},n));await n(aD)}catch(b){throw aD||b instanceof A.NoFallbackError||await J.onRequestError(a,b,{routerKind:"App Router",routePath:B,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ai,isOnDemandRevalidate:af})},ab),b}}},61799:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>B});var e=c(60687),f=c(43210),g=c(95391),h=c(46415),i=c(10597),j=c(95019),k=c(99989),l=c(21),m=c(17971),n=c(2975),o=c(89422),p=c(99270),q=c(96474),r=c(78272),s=c(63826),t=c(47033),u=c(14952),v=c(16145),w=c(18921),x=c(88920),y=c(92576),z=c(84650),A=a([z]);z=(A.then?(await A)():A)[0];let C=()=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,e.jsx)("path",{fill:"#00c300",d:"M12.5,42h23c3.59,0,6.5-2.91,6.5-6.5v-23C42,8.91,39.09,6,35.5,6h-23C8.91,6,6,8.91,6,12.5v23C6,39.09,8.91,42,12.5,42z"}),(0,e.jsx)("path",{fill:"#fff",d:"M37.113,22.417c0-5.865-5.88-10.637-13.107-10.637s-13.108,4.772-13.108,10.637c0,5.258,4.663,9.662,10.962,10.495c0.427,0.092,1.008,0.282,1.155,0.646c0.132,0.331,0.086,0.85,0.042,1.185c0,0-0.153,0.925-0.187,1.122c-0.057,0.331-0.263,1.296,1.135,0.707c1.399-0.589,7.548-4.445,10.298-7.611h-0.001C36.203,26.879,37.113,24.764,37.113,22.417z M18.875,25.907h-2.604c-0.379,0-0.687-0.308-0.687-0.688V20.01c0-0.379,0.308-0.687,0.687-0.687c0.379,0,0.687,0.308,0.687,0.687v4.521h1.917c0.379,0,0.687,0.308,0.687,0.687C19.562,25.598,19.254,25.907,18.875,25.907z M21.568,25.219c0,0.379-0.308,0.688-0.687,0.688s-0.687-0.308-0.687-0.688V20.01c0-0.379,0.308-0.687,0.687-0.687s0.687,0.308,0.687,0.687V25.219z M27.838,25.219c0,0.297-0.188,0.559-0.47,0.652c-0.071,0.024-0.145,0.036-0.218,0.036c-0.215,0-0.42-0.103-0.549-0.275l-2.669-3.635v3.222c0,0.379-0.308,0.688-0.688,0.688c-0.379,0-0.688-0.308-0.688-0.688V20.01c0-0.296,0.189-0.558,0.47-0.652c0.071-0.024,0.144-0.035,0.218-0.035c0.214,0,0.42,0.103,0.549,0.275l2.67,3.635V20.01c0-0.379,0.309-0.687,0.688-0.687c0.379,0,0.687,0.308,0.687,0.687V25.219z M32.052,21.927c0.379,0,0.688,0.308,0.688,0.688c0,0.379-0.308,0.687-0.688,0.687h-1.917v1.23h1.917c0.379,0,0.688,0.308,0.688,0.687c0,0.379-0.309,0.688-0.688,0.688h-2.604c-0.378,0-0.687-0.308-0.687-0.688v-2.603c0-0.001,0-0.001,0-0.001c0,0,0-0.001,0-0.001v-2.601c0-0.001,0-0.001,0-0.002c0-0.379,0.308-0.687,0.687-0.687h2.604c0.379,0,0.688,0.308,0.688,0.687s-0.308,0.687-0.688,0.687h-1.917v1.23H32.052z"})]}),D=()=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,e.jsx)("path",{fill:"#4caf50",d:"M45,16.2l-5,2.75l-5,4.75L35,40h7c1.657,0,3-1.343,3-3V16.2z"}),(0,e.jsx)("path",{fill:"#1e88e5",d:"M3,16.2l3.614,1.71L13,23.7V40H6c-1.657,0-3-1.343-3-3V16.2z"}),(0,e.jsx)("polygon",{fill:"#e53935",points:"35,11.2 24,19.45 13,11.2 12,17 13,23.7 24,31.95 35,23.7 36,17"}),(0,e.jsx)("path",{fill:"#c62828",d:"M3,12.298V16.2l10,7.5V11.2L9.876,8.859C9.132,8.301,8.228,8,7.298,8h0C4.924,8,3,9.924,3,12.298z"}),(0,e.jsx)("path",{fill:"#fbc02d",d:"M45,12.298V16.2l-10,7.5V11.2l3.124-2.341C38.868,8.301,39.772,8,40.702,8h0 C43.076,8,45,9.924,45,12.298z"})]}),E=async(a,b)=>{try{b("正在透過 mail 發送公告...","info");let c=await (0,w.tm)("/api/send-announcement",{method:"POST",body:JSON.stringify({announcementId:a})}),d=await c.json();if(!c.ok)throw Error(d.error||"mail 寄送失敗");b(d.message||"公告已成功透過 mail 寄送！","success")}catch(a){b(a.message||"mail 寄送失敗，請稍後再試","error")}},F=async(a,b)=>{try{b("正在透過 LINE 發送公告...","info");let c=await (0,w.tm)("/api/broadcast-line-announcement",{method:"POST",body:JSON.stringify({announcementId:a})}),d=await c.json();if(!c.ok)throw Error(d.error||"LINE 發送失敗");b(d.message||"公告已成功透過 LINE 發送！","success")}catch(a){b(a.message||"LINE 發送失敗，請稍後再試","error")}};function B(){let[a,b]=(0,f.useState)(null),[c,d]=(0,f.useState)([]),[w,A]=(0,f.useState)(!0),[B,G]=(0,f.useState)(!1),[H,I]=(0,f.useState)(null),[J,K]=(0,f.useState)(null),[L,M]=(0,f.useState)({show:!1,message:"",type:"success"}),[N,O]=(0,f.useState)({open:!1,type:"",html:"",text:"",id:null}),[P,Q]=(0,f.useState)(""),[R,S]=(0,f.useState)({column:"application_end_date",direction:"desc"}),[T,U]=(0,f.useState)(1),[V,W]=(0,f.useState)(10),X=(a,b="success")=>M({show:!0,message:a,type:b}),Y=(0,f.useCallback)(async()=>{A(!0);try{let{data:a,error:b}=await g.N.from("announcements").select("*").order("created_at",{ascending:!1});if(b)throw b;d(a||[])}catch(a){X("無法載入公告列表，請稍後再試","error")}finally{A(!1)}},[]),Z=(0,f.useMemo)(()=>{let a=[...c];if(P){let b=P.toLowerCase();a=a.filter(a=>a.title.toLowerCase().includes(b)||a.category&&a.category.toLowerCase().includes(b))}return R.column&&a.sort((a,b)=>{let c=a[R.column],d=b[R.column];return c<d?"asc"===R.direction?-1:1:c>d?"asc"===R.direction?1:-1:0}),a},[c,P,R]),$=(0,f.useMemo)(()=>{let a=(T-1)*V;return Z.slice(a,a+V)},[Z,T,V]),_=Math.ceil(Z.length/V),aa=a=>{S(b=>({column:a,direction:b.column===a&&"desc"===b.direction?"asc":"desc"})),U(1)},ab=a=>R.column!==a?(0,e.jsx)(m.A,{className:"h-4 w-4 ml-1 text-gray-400"}):"asc"===R.direction?(0,e.jsx)(n.A,{className:"h-4 w-4 ml-1 text-indigo-600"}):(0,e.jsx)(o.A,{className:"h-4 w-4 ml-1 text-indigo-600"}),ac=(a,b)=>{O({open:!0,type:a,announcement:b,id:b.id})},ad=async()=>{"email"===N.type?await E(N.id,X):"line"===N.type&&await F(N.id,X),O(a=>({...a,open:!1}))},ae=async a=>{let b=`https://scholarship.ncuesa.org.tw/?announcement_id=${a}`;try{await navigator.clipboard.writeText(b),X("公告連結已成功複製！","success")}catch(a){X("複製連結失敗","error")}},af="flex items-center justify-center gap-1.5 rounded-lg border transition-all duration-300 ease-in-out transform disabled:transform-none disabled:shadow-none",ag={add:`${af} px-4 py-2 text-sm font-semibold border-indigo-200 text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/40`,edit:`${af} px-3 py-1.5 text-xs font-semibold border-indigo-200 bg-transparent text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20`,delete:`${af} px-3 py-1.5 text-xs font-semibold border-rose-200 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20`,send:`${af} px-3 py-1.5 text-xs font-semibold border-sky-200 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20`,line:`${af} px-3 py-1.5 text-xs font-semibold border-green-200 bg-transparent text-green-600 hover:bg-green-100 hover:text-green-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-green-500/20`,link:`${af} px-3 py-1.5 text-xs font-semibold border-amber-200 bg-transparent text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-amber-500/20`,download:`${af} px-3 py-1.5 text-xs font-semibold border-stone-300 bg-transparent text-stone-700 hover:bg-stone-200 hover:text-stone-800 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-stone-500/20`};return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,e.jsxs)("div",{className:"relative w-full flex-grow",children:[(0,e.jsx)(p.A,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,e.jsx)("input",{type:"text",placeholder:"搜尋標題、分類...",value:P,onChange:a=>{Q(a.target.value),U(1)},className:"w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,e.jsxs)("button",{onClick:()=>G(!0),className:`${ag.add} w-full sm:w-auto whitespace-nowrap`,children:[(0,e.jsx)(q.A,{size:16})," 新增公告"]})]}),(0,e.jsxs)("div",{className:"rounded-xl w-full bg-white shadow-lg overflow-hidden border border-gray-200/80",children:[(0,e.jsx)("div",{className:"hidden md:block",children:(0,e.jsxs)("table",{className:"w-full text-sm table-layout-fixed",children:[(0,e.jsx)("thead",{className:"bg-gray-50/70 text-left",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"標題"}),(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 w-24",children:"分類"}),(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 cursor-pointer w-36",onClick:()=>aa("application_end_date"),children:(0,e.jsxs)("div",{className:"flex items-center",children:["申請截止日 ",ab("application_end_date")]})}),(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 w-28",children:"狀態"}),(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 cursor-pointer w-36",onClick:()=>aa("updated_at"),children:(0,e.jsxs)("div",{className:"flex items-center",children:["最後更新 ",ab("updated_at")]})}),(0,e.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 text-center w-48",children:"操作"})]})}),(0,e.jsx)("tbody",{className:"divide-y divide-gray-100",children:w?(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"text-center p-12 text-gray-500",children:"載入中..."})}):0===$.length?(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"text-center p-12 text-gray-500",children:"找不到符合條件的公告。"})}):$.map(a=>(0,e.jsxs)("tr",{className:"transform transition-all duration-300 hover:bg-violet-100/50 hover:shadow-xl z-0 hover:z-10 hover:scale-[1.02]",children:[(0,e.jsx)("td",{className:"p-4 px-6 font-medium text-gray-800 break-words",children:a.title}),(0,e.jsx)("td",{className:"p-4 px-6 text-gray-600",children:a.category}),(0,e.jsx)("td",{className:"p-4 px-6 text-gray-600 font-medium",children:a.application_end_date?new Date(a.application_end_date).toLocaleDateString("en-CA"):"無期限"}),(0,e.jsx)("td",{className:"p-4 px-6",children:(0,e.jsx)("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full ${a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.is_active?"上架":"下架"})}),(0,e.jsx)("td",{className:"p-4 px-6 text-gray-600",children:new Date(a.updated_at).toLocaleDateString()}),(0,e.jsx)("td",{className:"p-4 px-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,e.jsx)("button",{onClick:()=>I(a),className:`${ag.edit} whitespace-nowrap`,children:"編輯"}),(0,e.jsx)("button",{onClick:()=>K(a.id),className:`${ag.delete} whitespace-nowrap`,children:"刪除"}),(0,e.jsx)("button",{onClick:()=>ae(a.id),className:`${ag.link} whitespace-nowrap`,children:"連結"}),(0,e.jsx)(z.A,{announcement:a,className:ag.download}),(0,e.jsx)("button",{onClick:()=>ac("line",a),className:ag.line,children:(0,e.jsx)(C,{})}),(0,e.jsx)("button",{onClick:()=>ac("email",a),className:ag.send,children:(0,e.jsx)(D,{})})]})})]},a.id))})]})}),(0,e.jsx)("div",{className:"md:hidden px-2 py-4 flex flex-col gap-3",children:w?(0,e.jsx)("div",{className:"text-center p-8 text-gray-500",children:"載入中..."}):0===$.length?(0,e.jsx)("div",{className:"text-center p-8 text-gray-500",children:"找不到符合條件的公告。"}):$.map(c=>{let d=a===c.id;return(0,e.jsxs)("div",{className:`bg-white rounded-lg transition-all duration-300
                                        ${d?"shadow-lg ring-2 ring-indigo-500 ring-offset-2":"shadow-md border border-gray-200/80"}
                                    `,children:[(0,e.jsxs)("button",{onClick:()=>b(d?null:c.id),className:"w-full flex items-center justify-between text-left p-4",children:[(0,e.jsx)("div",{className:"flex-1 pr-4",children:(0,e.jsx)("h3",{className:"font-bold text-base text-gray-900",children:c.title})}),(0,e.jsxs)("div",{className:"flex items-center gap-x-3 flex-shrink-0",children:[(0,e.jsx)("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full ${c.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.is_active?"上架":"下架"}),(0,e.jsx)(r.A,{className:`h-5 w-5 text-gray-400 transition-transform duration-300 ${d?"rotate-180":""}`})]})]}),(0,e.jsx)(x.N,{children:d&&(0,e.jsx)(y.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,e.jsxs)("div",{className:"border-t border-gray-200 p-4 pt-3",children:[(0,e.jsxs)("div",{className:"grid grid-cols-[auto_1fr] gap-x-4 gap-y-2 text-sm mb-4",children:[(0,e.jsx)("div",{className:"font-semibold text-gray-500",children:"分類"}),(0,e.jsx)("div",{className:"text-gray-700",children:c.category||"-"}),(0,e.jsx)("div",{className:"font-semibold text-gray-500",children:"申請截止"}),(0,e.jsx)("div",{className:"text-gray-700",children:c.application_end_date?new Date(c.application_end_date).toLocaleDateString("en-CA"):"無期限"}),(0,e.jsx)("div",{className:"font-semibold text-gray-500",children:"最後更新"}),(0,e.jsx)("div",{className:"text-gray-700",children:new Date(c.updated_at).toLocaleDateString()})]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-2 border-t border-gray-200",children:[(0,e.jsx)("button",{onClick:()=>I(c),className:`${ag.edit} whitespace-nowrap`,children:"編輯"}),(0,e.jsx)("button",{onClick:()=>K(c.id),className:`${ag.delete} whitespace-nowrap`,children:"刪除"}),(0,e.jsx)("button",{onClick:()=>ae(c.id),className:`${ag.link} whitespace-nowrap`,children:"連結"}),(0,e.jsx)(z.A,{announcement:c,className:ag.download}),(0,e.jsx)("button",{onClick:()=>ac("line",c),className:ag.line,children:(0,e.jsx)(C,{})}),(0,e.jsx)("button",{onClick:()=>ac("email",c),className:ag.send,children:(0,e.jsx)(D,{})})]})]})},"content")})]},c.id)})})]}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,e.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",Z.length," 筆資料，第 ",T," / ",_||1," 頁"]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("select",{value:V,onChange:a=>{W(Number(a.target.value)),U(1)},className:"appearance-none w-full bg-white border border-gray-300 rounded-lg py-2 pl-4 pr-10 text-sm shadow-sm transition-all duration-300 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/30",children:[10,25,50].map(a=>(0,e.jsxs)("option",{value:a,children:[a," 筆 / 頁"]},a))}),(0,e.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400",children:(0,e.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,e.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>U(1),disabled:1===T,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,e.jsx)(s.A,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>U(a=>a-1),disabled:1===T,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,e.jsx)(t.A,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>U(a=>a+1),disabled:T===_||0===_,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,e.jsx)(u.A,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>U(_),disabled:T===_||0===_,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,e.jsx)(v.A,{className:"h-5 w-5"})})]})]})]}),(0,e.jsx)(h.A,{isOpen:B,onClose:()=>G(!1),refreshAnnouncements:Y}),(0,e.jsx)(i.A,{isOpen:!!H,onClose:()=>I(null),announcement:H,refreshAnnouncements:Y}),(0,e.jsx)(j.A,{isOpen:!!J,onClose:()=>K(null),announcementId:J,refreshAnnouncements:Y}),(0,e.jsx)(k.A,{isOpen:N.open,type:N.type,announcement:N.announcement,onConfirm:ad,onClose:()=>O(a=>({...a,open:!1}))}),(0,e.jsx)(l.A,{show:L.show,message:L.message,type:L.type,onClose:()=>M(a=>({...a,show:!1}))})]})}d()}catch(a){d(a)}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{"use strict";a.exports=require("zlib")},77057:(a,b,c)=>{Promise.resolve().then(c.bind(c,20128))},78464:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]])},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79894:(a,b,c)=>{"use strict";c.d(b,{A:()=>G});var d=c(60687),e=c(76180),f=c.n(e),g=c(43210),h=c(87955),i=function(){return(i=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},j={onActivate:h.func,onAddUndo:h.func,onBeforeAddUndo:h.func,onBeforeExecCommand:h.func,onBeforeGetContent:h.func,onBeforeRenderUI:h.func,onBeforeSetContent:h.func,onBeforePaste:h.func,onBlur:h.func,onChange:h.func,onClearUndos:h.func,onClick:h.func,onContextMenu:h.func,onCommentChange:h.func,onCompositionEnd:h.func,onCompositionStart:h.func,onCompositionUpdate:h.func,onCopy:h.func,onCut:h.func,onDblclick:h.func,onDeactivate:h.func,onDirty:h.func,onDrag:h.func,onDragDrop:h.func,onDragEnd:h.func,onDragGesture:h.func,onDragOver:h.func,onDrop:h.func,onExecCommand:h.func,onFocus:h.func,onFocusIn:h.func,onFocusOut:h.func,onGetContent:h.func,onHide:h.func,onInit:h.func,onInput:h.func,onKeyDown:h.func,onKeyPress:h.func,onKeyUp:h.func,onLoadContent:h.func,onMouseDown:h.func,onMouseEnter:h.func,onMouseLeave:h.func,onMouseMove:h.func,onMouseOut:h.func,onMouseOver:h.func,onMouseUp:h.func,onNodeChange:h.func,onObjectResizeStart:h.func,onObjectResized:h.func,onObjectSelected:h.func,onPaste:h.func,onPostProcess:h.func,onPostRender:h.func,onPreProcess:h.func,onProgressState:h.func,onRedo:h.func,onRemove:h.func,onReset:h.func,onSaveContent:h.func,onSelectionChange:h.func,onSetAttrib:h.func,onSetContent:h.func,onShow:h.func,onSubmit:h.func,onUndo:h.func,onVisualAid:h.func,onSkinLoadError:h.func,onThemeLoadError:h.func,onModelLoadError:h.func,onPluginLoadError:h.func,onIconsLoadError:h.func,onLanguageLoadError:h.func,onScriptsLoad:h.func,onScriptsLoadError:h.func},k=i({apiKey:h.string,licenseKey:h.string,id:h.string,inline:h.bool,init:h.object,initialValue:h.string,onEditorChange:h.func,value:h.string,tagName:h.string,tabIndex:h.number,cloudChannel:h.string,plugins:h.oneOfType([h.string,h.array]),toolbar:h.oneOfType([h.string,h.array]),disabled:h.bool,readonly:h.bool,textareaName:h.string,tinymceScriptSrc:h.oneOfType([h.string,h.arrayOf(h.string),h.arrayOf(h.shape({src:h.string,async:h.bool,defer:h.bool}))]),rollback:h.oneOfType([h.number,h.oneOf([!1])]),scriptLoading:h.shape({async:h.bool,defer:h.bool,delay:h.number})},j),l=function(a){return a&&a.tinymce?a.tinymce:null},m=function(a){return"function"==typeof a},n=function(a){return a in j},o=function(a){return a.substr(2)},p=function(a,b,c,d,e,f,g){var h=Object.keys(e).filter(n),i=Object.keys(f).filter(n),j=h.filter(function(a){return void 0===f[a]}),k=i.filter(function(a){return void 0===e[a]});j.forEach(function(a){var b=o(a),d=g[b];c(b,d),delete g[b]}),k.forEach(function(c){var e=d(a,c),f=o(c);g[f]=e,b(f,e)})},q=0,r=function(a){var b=Date.now();return a+"_"+Math.floor(1e9*Math.random())+ ++q+String(b)},s=function(a){return null!==a&&("textarea"===a.tagName.toLowerCase()||"input"===a.tagName.toLowerCase())},t=function(a){return void 0===a||""===a?[]:Array.isArray(a)?a:a.split(" ")},u=function(a){if(!("isConnected"in Node.prototype)){for(var b=a,c=a.parentNode;null!=c;)c=(b=c).parentNode;return b===a.ownerDocument}return a.isConnected},v=function(a,b){void 0!==a&&(null!=a.mode&&"object"==typeof a.mode&&"function"==typeof a.mode.set?a.mode.set(b):a.setMode(b))},w=function(a){var b=l(a);if(!b)throw Error("tinymce should have been loaded into global scope");return b},x=function(a){return a.options&&a.options.isRegistered("disabled")},y=function(){return(y=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},z=function(a,b,c){var d,e,f=a.createElement("script");f.referrerPolicy="origin",f.type="application/javascript",f.id=b.id,f.src=b.src,f.async=null!=(d=b.async)&&d,f.defer=null!=(e=b.defer)&&e;var g=function(){f.removeEventListener("load",g),f.removeEventListener("error",h),c(b.src)},h=function(a){f.removeEventListener("load",g),f.removeEventListener("error",h),c(b.src,a)};f.addEventListener("load",g),f.addEventListener("error",h),a.head&&a.head.appendChild(f)},A=function(a){var b={},c=function(a,c){var d=b[a];d.done=!0,d.error=c;for(var e=0,f=d.handlers;e<f.length;e++)(0,f[e])(a,c);d.handlers=[]};return{loadScripts:function(d,e,f){var g=function(a){return void 0!==f?f(a):console.error(a)};if(0===d.length)return void g(Error("At least one script must be provided"));for(var h=0,i=!1,j=function(a,b){i||(b?(i=!0,g(b)):++h===d.length&&e())},k=0;k<d.length;k++){var l=d[k],m=b[l.src];if(m)m.done?j(l.src,m.error):m.handlers.push(j);else{var n=r("tiny-");b[l.src]={id:n,src:l.src,done:!1,error:null,handlers:[j]},z(a,y({id:n},l),c)}}},deleteScripts:function(){for(var c,d=0,e=Object.values(b);d<e.length;d++){var f=e[d],g=a.getElementById(f.id);null!=g&&"SCRIPT"===g.tagName&&(null==(c=g.parentNode)||c.removeChild(g))}b={}},getDocument:function(){return a}}},B=function(){var a=[],b=function(b){var c=a.find(function(a){return a.getDocument()===b});return void 0===c&&(c=A(b),a.push(c)),c};return{loadList:function(a,c,d,e,f){var g=function(){return b(a).loadScripts(c,e,f)};d>0?setTimeout(g,d):g()},reinitialize:function(){for(var b=a.pop();null!=b;b=a.pop())b.deleteScripts()}}}(),C=function(){var a=function(b,c){return(a=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(b,c)};return function(b,c){if("function"!=typeof c&&null!==c)throw TypeError("Class extends value "+String(c)+" is not a constructor or null");function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),D=function(){return(D=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},E="change keyup compositionend setcontent CommentChange",F=function(a){function b(b){var c,d,e,f=a.call(this,b)||this;return f.rollbackTimer=void 0,f.valueCursor=void 0,f.rollbackChange=function(){var a=f.editor,b=f.props.value;a&&b&&b!==f.currentContent&&a.undoManager.ignore(function(){if(a.setContent(b),f.valueCursor&&(!f.inline||a.hasFocus()))try{a.selection.moveToBookmark(f.valueCursor)}catch(a){}}),f.rollbackTimer=void 0},f.handleBeforeInput=function(a){if(void 0!==f.props.value&&f.props.value===f.currentContent&&f.editor&&(!f.inline||f.editor.hasFocus()))try{f.valueCursor=f.editor.selection.getBookmark(3)}catch(a){}},f.handleBeforeInputSpecial=function(a){("Enter"===a.key||"Backspace"===a.key||"Delete"===a.key)&&f.handleBeforeInput(a)},f.handleEditorChange=function(a){var b=f.editor;if(b&&b.initialized){var c=b.getContent();void 0===f.props.value||f.props.value===c||!1===f.props.rollback||f.rollbackTimer||(f.rollbackTimer=window.setTimeout(f.rollbackChange,"number"==typeof f.props.rollback?f.props.rollback:200)),c!==f.currentContent&&(f.currentContent=c,m(f.props.onEditorChange)&&f.props.onEditorChange(c,b))}},f.handleEditorChangeSpecial=function(a){("Backspace"===a.key||"Delete"===a.key)&&f.handleEditorChange(a)},f.initialise=function(a){void 0===a&&(a=0);var b,c,d,e=f.elementRef.current;if(e){if(!u(e)){if(0===a)setTimeout(function(){return f.initialise(1)},1);else if(a<100)setTimeout(function(){return f.initialise(a+1)},100);else throw Error("tinymce can only be initialised when in a document");return}var g,h,i=w(f.view),j=D(D(D(D({},f.props.init),{selector:void 0,target:e,disabled:f.props.disabled,readonly:f.props.readonly,inline:f.inline,plugins:(g=null==(b=f.props.init)?void 0:b.plugins,h=f.props.plugins,t(g).concat(t(h))),toolbar:null!=(c=f.props.toolbar)?c:null==(d=f.props.init)?void 0:d.toolbar}),f.props.licenseKey?{license_key:f.props.licenseKey}:{}),{setup:function(a){f.editor=a,f.bindHandlers({}),f.inline&&!s(e)&&a.once("PostRender",function(b){a.setContent(f.getInitialValue(),{no_events:!0})}),f.props.init&&m(f.props.init.setup)&&f.props.init.setup(a),f.props.disabled&&(x(f.editor)?f.editor.options.set("disabled",f.props.disabled):f.editor.mode.set("readonly"))},init_instance_callback:function(a){var b,c=f.getInitialValue();f.currentContent=null!=(b=f.currentContent)?b:a.getContent(),f.currentContent!==c&&(f.currentContent=c,a.setContent(c),a.undoManager.clear(),a.undoManager.add(),a.setDirty(!1)),f.props.init&&m(f.props.init.init_instance_callback)&&f.props.init.init_instance_callback(a)}});f.inline||(e.style.visibility=""),s(e)&&(e.value=f.getInitialValue()),i.init(j)}},f.id=f.props.id||r("tiny-react"),f.elementRef=g.createRef(),f.inline=null!=(e=null!=(c=f.props.inline)?c:null==(d=f.props.init)?void 0:d.inline)&&e,f.boundHandlers={},f}return C(b,a),Object.defineProperty(b.prototype,"view",{get:function(){var a,b;return null!=(b=null==(a=this.elementRef.current)?void 0:a.ownerDocument.defaultView)?b:window},enumerable:!1,configurable:!0}),b.prototype.componentDidUpdate=function(a){var b,c,d=this;if(this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(a),this.editor.initialized)){if(this.currentContent=null!=(b=this.currentContent)?b:this.editor.getContent(),"string"==typeof this.props.initialValue&&this.props.initialValue!==a.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if("string"==typeof this.props.value&&this.props.value!==this.currentContent){var e=this.editor;e.undoManager.transact(function(){if(!d.inline||e.hasFocus())try{a=e.selection.getBookmark(3)}catch(a){}var a,b=d.valueCursor;if(e.setContent(d.props.value),!d.inline||e.hasFocus())for(var c=0,f=[a,b];c<f.length;c++){var g=f[c];if(g)try{e.selection.moveToBookmark(g),d.valueCursor=g;break}catch(a){}}})}if(this.props.readonly!==a.readonly){var f=null!=(c=this.props.readonly)&&c;v(this.editor,f?"readonly":"design")}this.props.disabled!==a.disabled&&(x(this.editor)?this.editor.options.set("disabled",this.props.disabled):v(this.editor,this.props.disabled?"readonly":"design"))}},b.prototype.componentDidMount=function(){var a,b,c,d,e,f=this;null!==l(this.view)?this.initialise():Array.isArray(this.props.tinymceScriptSrc)&&0===this.props.tinymceScriptSrc.length?null==(b=(a=this.props).onScriptsLoadError)||b.call(a,Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array.")):(null==(c=this.elementRef.current)?void 0:c.ownerDocument)&&B.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),null!=(e=null==(d=this.props.scriptLoading)?void 0:d.delay)?e:0,function(){var a,b;null==(b=(a=f.props).onScriptsLoad)||b.call(a),f.initialise()},function(a){var b,c;null==(c=(b=f.props).onScriptsLoadError)||c.call(b,a)})},b.prototype.componentWillUnmount=function(){var a=this,b=this.editor;b&&(b.off(E,this.handleEditorChange),b.off(this.beforeInputEvent(),this.handleBeforeInput),b.off("keypress",this.handleEditorChangeSpecial),b.off("keydown",this.handleBeforeInputSpecial),b.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach(function(c){b.off(c,a.boundHandlers[c])}),this.boundHandlers={},b.remove(),this.editor=void 0)},b.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},b.prototype.beforeInputEvent=function(){return window.InputEvent&&"function"==typeof InputEvent.prototype.getTargetRanges?"beforeinput SelectionChange":"SelectionChange"},b.prototype.renderInline=function(){var a=this.props.tagName;return g.createElement(void 0===a?"div":a,{ref:this.elementRef,id:this.id,tabIndex:this.props.tabIndex})},b.prototype.renderIframe=function(){return g.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id,tabIndex:this.props.tabIndex})},b.prototype.getScriptSources=function(){var a,b,c=null==(a=this.props.scriptLoading)?void 0:a.async,d=null==(b=this.props.scriptLoading)?void 0:b.defer;if(void 0!==this.props.tinymceScriptSrc)return"string"==typeof this.props.tinymceScriptSrc?[{src:this.props.tinymceScriptSrc,async:c,defer:d}]:this.props.tinymceScriptSrc.map(function(a){return"string"==typeof a?{src:a,async:c,defer:d}:a});var e=this.props.cloudChannel,f=this.props.apiKey?this.props.apiKey:"no-api-key";return[{src:"https://cdn.tiny.cloud/1/".concat(f,"/tinymce/").concat(e,"/tinymce.min.js"),async:c,defer:d}]},b.prototype.getInitialValue=function(){return"string"==typeof this.props.initialValue?this.props.initialValue:"string"==typeof this.props.value?this.props.value:""},b.prototype.bindHandlers=function(a){var b=this;if(void 0!==this.editor){c=this.editor,d=this.props,e=this.boundHandlers,p(function(a){return b.props[a]},c.on.bind(c),c.off.bind(c),function(a,b){return function(d){var e;return null==(e=a(b))?void 0:e(d,c)}},a,d,e);var c,d,e,f=function(a){return void 0!==a.onEditorChange||void 0!==a.value},g=f(a),h=f(this.props);!g&&h?(this.editor.on(E,this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):g&&!h&&(this.editor.off(E,this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},b.propTypes=k,b.defaultProps={cloudChannel:"8"},b}(g.Component);let G=({value:a,onChange:b,placeholder:c,disabled:e})=>{let[h,i]=(0,g.useState)(!1),j=(0,g.useRef)(null);return((0,g.useEffect)(()=>{i(!0)},[]),h)?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f(),{id:"e105e4384e573720",children:".rich-text-content table{width:100%!important;border-collapse:collapse}.rich-text-content td,.rich-text-content th{border:1px solid#ccc;padding:8px}"}),(0,d.jsx)(F,{apiKey:"mafnrvqz0j1ur677yypbob3rz7752nrifayzjsu9d5euqfbf",onInit:(a,b)=>j.current=b,value:a||"",onEditorChange:(a,c)=>{b(a)},disabled:e,init:{min_height:350,autoresize_bottom_margin:25,resize:"vertical",language:"zh_TW",language_url:"/langs/zh_TW.js",placeholder:c||"",plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","help","wordcount","autoresize","codesample","emoticons"],toolbar:"undo redo | styles | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | table codesample emoticons | removeformat | fullscreen preview code | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }",table_toolbar:"tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol",image_advtab:!0,image_caption:!0,image_title:!0,paste_data_images:!0,menubar:!0}})]}):(0,d.jsx)("div",{style:{minHeight:"350px",border:"1px solid #ccc",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",color:"#666"},children:"載入編輯器中..."})}},81630:a=>{"use strict";a.exports=require("http")},82080:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},84027:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},84031:(a,b,c)=>{"use strict";var d=c(34452);function e(){}function f(){}f.resetWarningCache=e,a.exports=function(){function a(a,b,c,e,f,g){if(g!==d){var h=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}function b(){return a}a.isRequired=a;var c={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:b,element:a,elementType:a,instanceOf:b,node:a,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:f,resetWarningCache:e};return c.PropTypes=c,c}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87955:(a,b,c)=>{a.exports=c(84031)()},88233:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},95019:(a,b,c)=>{"use strict";c.d(b,{A:()=>n});var d=c(60687),e=c(43210),f=c(95391),g=c(88920),h=c(92576),i=c(21),j=c(11860),k=c(43649),l=c(41862),m=c(18921);function n({isOpen:a,onClose:b,announcementId:c,refreshAnnouncements:n}){let[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)({show:!1,message:"",type:"success"}),s=(a,b="success")=>r({show:!0,message:a,type:b}),t=async()=>{if(!c)return void s("無效的公告 ID","error");p(!0);try{let{data:a,error:d}=await f.N.from("attachments").select("stored_file_path").eq("announcement_id",c);if(d&&console.error("無法查詢關聯附件:",d),a&&a.length>0){let b=a.map(a=>a.stored_file_path),c=await (0,m.tm)("/api/delete-files",{method:"POST",body:JSON.stringify({filePaths:b})});if(!c.ok){let a=await c.json();s(`部分附件檔案刪除失敗: ${a.error||""}`,"warning"),console.error("刪除本地檔案失敗:",a)}}let{error:e}=await f.N.from("announcements").delete().eq("id",c);if(e)throw e;s("公告及其所有附件已成功刪除","success"),n&&n(),b()}catch(a){console.error("刪除公告時發生錯誤:",a),s(`刪除失敗: ${a.message}`,"error")}finally{p(!1)}};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.A,{show:q.show,message:q.message,type:q.type,onClose:()=>r(a=>({...a,show:!1}))}),(0,d.jsx)(g.N,{children:a&&(0,d.jsx)(h.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4",onClick:b,children:(0,d.jsxs)(h.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-md flex flex-col overflow-hidden border border-white/20",onClick:a=>a.stopPropagation(),children:[(0,d.jsx)("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:(0,d.jsx)("button",{type:"button",className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200/50 transition-colors",onClick:b,disabled:o,children:(0,d.jsx)(j.A,{className:"h-6 w-6"})})}),(0,d.jsxs)("div",{className:"p-8 text-center",children:[(0,d.jsx)("div",{className:"mx-auto flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,d.jsx)(k.A,{className:"w-6 h-6 text-red-600"})}),(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"刪除公告"}),(0,d.jsxs)("p",{className:"text-base text-gray-500 mt-2",children:["您確定要永久刪除這則公告及其所有附件嗎？",(0,d.jsx)("br",{}),"此操作將無法復原。"]})]})]}),(0,d.jsx)("div",{className:"p-4 bg-black/5 flex justify-center",children:(0,d.jsx)("button",{type:"button",onClick:t,disabled:o,className:"flex items-center justify-center gap-1.5 rounded-lg border transition-all duration-300 ease-in-out transform px-3 py-2 text-sm font-semibold border-rose-400 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",children:o?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.A,{size:16,className:"animate-spin"}),(0,d.jsx)("span",{children:"刪除中..."})]}):"確認刪除"})})]})})})]})}},96474:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(62688).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},99989:(a,b,c)=>{"use strict";c.d(b,{A:()=>n});var d=c(60687),e=c(43210),f=c(88920),g=c(92576),h=c(11860),i=c(41862),j=c(27900);let k=({announcement:a})=>{let b=a.application_deadline?new Date(a.application_deadline).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"未指定",c=`https://scholarship.ncuesa.org.tw/?announcement_id=${a.id}`,e=new Date().getFullYear(),f=(a=>{if(!a)return[];try{let b=JSON.parse(a);if(Array.isArray(b))return b.filter(a=>a.url&&"string"==typeof a.url)}catch(b){if("string"==typeof a&&a.startsWith("http"))return[{url:a}]}return[]})(a.external_urls),g=`
    <!DOCTYPE html>
    <html lang="zh-Hant">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>彰師生輔組校外獎助學金資訊平台</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
            body { margin: 0; padding: 0; background-color: #f4f4f7; font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
            table { border-collapse: collapse; }
            .wrapper { background-color: transparent; width: 100%; }
            .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; }
            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; text-align: center; }
            .header h1 { margin: 0; font-size: 26px; font-weight: 700; }
            .content { padding: 32px 40px; color: #374151; }
            .content h2 { color: #1f2937; margin-top: 0; margin-bottom: 24px; font-size: 22px; font-weight: 700; text-align: left; }
            .details-table { width: 100%; margin-bottom: 24px; border-collapse: collapse; }
            .details-table td { padding: 8px 0; vertical-align: top; font-size: 15px; }
            .details-table td.label { color: #6b7280; font-weight: 500; width: 80px; padding-right: 16px; }
            .details-table td.value { color: #1f2937; }
            .deadline { color: #9333ea; font-weight: 700; }
            .divider { border: 0; border-top: 1px solid #e5e7eb; margin: 24px 0; }
            .rich-text-content { font-size: 16px; line-height: 1.7; color: #374151; }
            .rich-text-content p { margin: 0 0 16px; }
            .rich-text-content h1, .rich-text-content h2, .rich-text-h3 { font-weight: 700; color: #1f2937; margin-top: 24px; margin-bottom: 12px; }
            .rich-text-content h1 { font-size: 22px; }
            .rich-text-content h2 { font-size: 20px; }
            .rich-text-h3 { font-size: 18px; }
            .rich-text-content ul, .rich-text-content ol { padding-left: 24px; margin-bottom: 16px; }
            .rich-text-content li { margin-bottom: 8px; }
            .rich-text-content table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; border: 1px solid #dee2e6; }
            .rich-text-content th, .rich-text-content td { border: 1px solid #dee2e6; padding: 12px 15px; text-align: left; vertical-align: top; }
            .rich-text-content th { background-color: #f8f9fa; font-weight: 600; color: #495057; }
            .rich-text-content tr:nth-of-type(even) { background-color: #f8f9fa; }
            .cta-button { display: inline-block; background-color: #7c3aed; color: #ffffff !important; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: 500; }
            .footer { padding: 24px 40px; font-size: 12px; text-align: center; color: #9ca3af; background-color: #f9fafb; }
            .footer a { color: #6b7280; text-decoration: none; }
        </style>
    </head>
    <body>
        <table class="wrapper" border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
                <td align="center" style="padding: 24px;">
                    <table class="container" border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr><td class="header"><h1>生輔組校外獎助學金資訊平台</h1></td></tr>
                        <tr>
                            <td class="content">
                                <h2>${a.title}</h2>
                                <table class="details-table">
                                    ${a.category?`<tr><td class="label">類 別</td><td class="value">${a.category}</td></tr>`:""}
                                    ${a.application_deadline?`<tr><td class="label">申請截止</td><td class="value"><span class="deadline">${b}</span></td></tr>`:""}
                                    ${a.target_audience?`<tr><td class="label">適用對象</td><td class="value">${a.target_audience}</td></tr>`:""}
                                    ${a.submission_method?`<tr><td class="label">送件方式</td><td class="value">${a.submission_method}</td></tr>`:""}
                                </table>
                                <hr class="divider" />
                                <div class="rich-text-content">
                                    <h3>公告摘要</h3>
                                    ${a.summary||"<p>請至平台查看詳細內容。</p>"}
                                </div>
                                ${(()=>{if(0===f.length)return"";let a=f.map(a=>`<li style="margin-bottom: 8px;">
                <a href="${a.url}" target="_blank" style="color: #7c3aed; text-decoration: none; word-break: break-all;">${a.url}</a>
            </li>`).join("");return`
            <hr class="divider" />
            <div>
                <h3 class="rich-text-h3">相關連結</h3>
                <ul style="list-style-type: none; padding-left: 0; margin-top: 8px;">
                    ${a}
                </ul>
            </div>
        `})()}
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 32px;">
                                    <tr><td align="center"><a href="${c}" target="_blank" class="cta-button">前往平台查看完整資訊</a></td></tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td class="footer">
                                <p style="margin: 0 0 12px;"><a href="https://scholarship.ncuesa.org.tw" target="_blank">生輔組獎助學金資訊平台</a> • <a href="https://stuaffweb.ncue.edu.tw/" target="_blank">生輔組首頁</a></p>
                                <p style="margin: 0 0 5px;">\xa9 ${e} 彰師生輔組校外獎助學金資訊平台. All Rights Reserved.</p>
                                <p style="margin: 0;">此為系統自動發送之信件，請勿直接回覆。</p>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </body>
    </html>`;return(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:g}})},l=({announcement:a})=>{if(!a)return(0,d.jsx)("div",{className:"flex justify-center items-center h-full p-4",children:(0,d.jsx)("div",{className:"text-gray-500",children:"無法載入公告內容"})});let b=a.application_start_date?new Date(a.application_start_date).toLocaleDateString("en-CA"):null,c=a.application_end_date?new Date(a.application_end_date).toLocaleDateString("en-CA"):"無期限",e=b?`${b} ~ ${c}`:c,f=`🎓【分類 ${a.category||"未分類"}】 ${a.title||"無標題"}`,g=`

⚠️ 申請期間：
${e}`,h=`

📦 送件方式：
${a.submission_method||"未指定"}`,i=`

🎯 適用對象：
${(a=>a?a.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<li.*?>/gi,"\n✅ ").replace(/<[^>]*>?/gm,"").replace(/[ \t]+/g," ").replace(/\n\s*\n/g,"\n").trim():"")(a.target_audience)||"所有學生"}`,j=`https://scholarship.ncuesa.org.tw/?announcement_id=${a.id}`,k=[f,g,h,i,`

🔗 查看詳情：
${j}`].join("");return(0,d.jsx)("div",{className:"flex justify-center items-center h-full w-full p-4 font-sans",children:(0,d.jsx)("div",{className:"bg-white/70 backdrop-blur-lg rounded-xl w-full max-w-sm overflow-hidden shadow-2xl border border-white/30",children:(0,d.jsx)("div",{className:"p-4",children:(0,d.jsx)("p",{className:"whitespace-pre-wrap text-sm text-gray-800 break-words",children:k})})})})},m={send:"flex items-center justify-center gap-1.5 rounded-lg border px-3 py-2 text-sm font-semibold transition-all duration-300 ease-in-out transform border-sky-400 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:border-sky-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",line:"flex items-center justify-center gap-1.5 rounded-lg border px-3 py-2 text-sm font-semibold transition-all duration-300 ease-in-out transform border-green-400 bg-transparent text-green-600 hover:bg-green-100 hover:text-green-700 hover:border-green-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-green-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed"};function n({isOpen:a,type:b,announcement:c,onConfirm:n,onClose:o}){let[p,q]=(0,e.useState)(!1),r=async()=>{q(!0),await n(),q(!1)};return c?(0,d.jsx)(f.N,{children:a&&(0,d.jsx)(g.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-start p-4 pt-16 sm:pt-20 overflow-y-auto",onClick:o,children:(0,d.jsxs)(g.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-4xl flex flex-col max-h-[calc(100vh-120px)] overflow-hidden border border-white/20",onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,d.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"email"===b?"Email 通知預覽":"LINE 通知預覽"}),(0,d.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 p-2 rounded-full transition-colors",children:(0,d.jsx)(h.A,{size:20})})]}),(0,d.jsxs)("div",{className:"p-6 bg-transparent flex-grow overflow-y-auto",children:["email"===b&&(0,d.jsx)(k,{announcement:c}),"line"===b&&(0,d.jsx)(l,{announcement:c})]}),(0,d.jsx)("div",{className:"p-4 bg-white/60 border-t border-black/10 flex justify-end items-center rounded-b-2xl flex-shrink-0",children:(0,d.jsxs)("button",{type:"button",onClick:r,disabled:p,className:"email"===b?m.send:m.line,children:[p?(0,d.jsx)(i.A,{className:"animate-spin h-4 w-4"}):(0,d.jsx)(j.A,{size:16}),(0,d.jsx)("span",{children:p?"發送中...":`確認並發送 ${"email"===b?"Email":"LINE"}`})]})})]})})}):null}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[985,102,183,959,628,878],()=>b(b.s=61378));module.exports=c})();