(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4320],{25215:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=s(51030).A},45749:(e,t,s)=>{"use strict";s.d(t,{N:()=>n});var r=s(55647);let a="https://scholarship-api.ncuesa.org.tw",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU0NDA5NjAwLCJleHAiOjE5MTIxNzYwMDB9.jqoKh3OJbr8hsKd1CTuz6UcEPGuzO_gZEL9HT67q_GY";if(!a||!l)throw console.error("Supabase configuration:",{url:a,hasAnonKey:!!l}),Error("Missing Supabase environment variables. Please check your .env.local file.");console.log("[SUPABASE-CLIENT] Configured with URL:",a);let n=(0,r.UU)(a,l)},51030:(e,t,s)=>{"use strict";s.d(t,{O:()=>o,A:()=>c});var r=s(95155),a=s(12115),l=s(45749);let n={async signUp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let{data:r,error:a}=await l.N.auth.signUp({email:e,password:t,options:{data:{name:s.name,student_id:s.student_id,department:s.department,year:s.year},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)throw a;return{success:!0,data:r}}catch(e){return console.error("Sign-up failed:",e),{success:!1,error:e.message}}},async signIn(e,t){try{let{data:s,error:r}=await l.N.auth.signInWithPassword({email:e,password:t});if(r)throw r;return{success:!0,data:s}}catch(e){return{success:!1,error:e.message}}},async signOut(){try{let{error:e}=await l.N.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async getCurrentUser(){try{let{data:{user:e},error:t}=await l.N.auth.getUser();if(t)throw t;if(e){let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e.id).single();return s&&"PGRST116"!==s.code&&console.error("Error fetching profile:",s),{success:!0,user:{...e,profile:t||null,role:(null==t?void 0:t.role)||"user"}}}return{success:!0,user:null}}catch(e){return{success:!1,error:e.message}}},async getUserProfile(e){try{let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e).single();if(s)throw s;return{success:!0,data:t}}catch(e){return{success:!1,error:e.message}}},async resetPassword(e){try{let{error:t}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updatePassword(e){try{let{error:t}=await l.N.auth.updateUser({password:e});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updateProfile(e){let{name:t,student_id:s,department:r,year:a}=e;try{let{data:e,error:n}=await l.N.auth.updateUser({data:{name:t,student_id:s,department:r,year:a}});if(n)throw n;let i=e.user.id,{error:c}=await l.N.from("profiles").update({username:t,student_id:s,department:r,year:a}).eq("id",i);if(c)throw c;return{success:!0,user:e.user}}catch(e){return console.error("更新個人資料失敗:",e),{success:!1,error:e.message}}},async verifyOtp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";try{let{data:r,error:a}=await l.N.auth.verifyOtp({email:e,token:t,type:s});if(a)throw a;return{success:!0,data:r}}catch(e){return{success:!1,error:e.message}}},async resendOtp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";try{let{error:s}=await l.N.auth.resend({type:t,email:e});if(s)throw s;return{success:!0}}catch(e){return{success:!1,error:e.message}}},onAuthStateChange:e=>l.N.auth.onAuthStateChange((t,s)=>{e(t,s)})},i=(0,a.createContext)({}),c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,[s,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=async()=>{let e=await n.getCurrentUser();e.success&&e.user&&c(e.user),d(!1)};e();let{data:{subscription:t}}=n.onAuthStateChange(async(t,s)=>{if("SIGNED_IN"===t&&(null==s?void 0:s.user)){var r;let t=s.user,{data:a}=await l.N.from("profiles").select("id").eq("id",t.id).single();!a&&(null==(r=t.raw_user_meta_data)?void 0:r.name)&&(await l.N.from("profiles").insert({id:t.id,username:t.raw_user_meta_data.name,student_id:t.raw_user_meta_data.student_id,role:"user"}),await l.N.auth.updateUser({data:{display_name:t.raw_user_meta_data.name}})),await e(),m(null)}else"SIGNED_OUT"===t&&(c(null),m(null));d(!1)});return()=>{null==t||t.unsubscribe()}},[]);let h={user:s,loading:o,error:u,signUp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};m(null);let r=await n.signUp(e,t,s);return r.success||m(r.error),r},signIn:async(e,t)=>{m(null);let s=await n.signIn(e,t);return s.success||m(s.error),s},signOut:async()=>{m(null);let e=await n.signOut();return e.success?c(null):m(e.error),e},resetPassword:async e=>{m(null);let t=await n.resetPassword(e);return t.success||m(t.error),t},updatePassword:async e=>{m(null);let t=await n.updatePassword(e);return t.success||m(t.error),t},updateProfile:async e=>{m(null);let{name:t,student_id:s}=e,r=await n.updateProfile({name:t,student_id:s});if(r.success){let e=await n.getCurrentUser();e.success&&c(e.user)}else m(r.error);return r},verifyOtp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";m(null);let r=await n.verifyOtp(e,t,s);return r.success||m(r.error),r},resendOtp:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";m(null);let s=await n.resendOtp(e,t);return s.success||m(s.error),s},isAuthenticated:!!s,isAdmin:(null==s?void 0:s.role)==="admin"};return(0,r.jsx)(i.Provider,{value:h,children:t})}},62750:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var r=s(95155),a=s(25215),l=s(12115),n=s(92531),i=s(77604),c=s(10822);let o=e=>{let{content:t}=e,[s,a]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{a(!0)},[]),!t||!s)return null;let n=c.A.sanitize(t,{ADD_ATTR:["style","class","target"],ALLOWED_CSS_PROPERTIES:["color"]});return(0,r.jsx)("div",{className:"rich-text-content prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:n}})};var d=s(45749),u=s(1243),m=s(33786),h=s(23562);let x=e=>{let{id:t}=e,[s,a]=(0,l.useState)(null),[n,i]=(0,l.useState)(!0),[c,o]=(0,l.useState)(null);if((0,l.useEffect)(()=>{if(!t){i(!1),o("未提供公告 ID。");return}(async()=>{i(!0),o(null);let{data:e,error:s}=await d.N.from("announcements").select("id, title, summary, application_end_date").eq("id",t).single();s?(console.error("Error fetching announcement:",s),o("無法載入公告資訊。")):a(e),i(!1)})()},[t]),n)return(0,r.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg shadow-sm animate-pulse h-24"});if(c||!s)return(0,r.jsxs)("div",{className:"p-3 border border-red-200 bg-red-50 rounded-lg text-sm text-red-600 flex items-center gap-2",children:[(0,r.jsx)(u.A,{size:16}),(0,r.jsx)("span",{children:c||"找不到指定的公告。"})]});let x=s.application_end_date?new Date(s.application_end_date).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):null,f="https://scholarship.ncuesa.org.tw/?announcement_id=".concat(s.id);return(0,r.jsxs)("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"group block p-4 border border-gray-200 rounded-lg shadow-sm bg-white transition-all duration-300 ease-in-out hover:scale-[1.01] hover:shadow-lg hover:border-violet-300 hover:bg-violet-50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)("h4",{className:"font-bold text-gray-800 transition-colors group-hover:text-violet-600",children:s.title}),(0,r.jsx)(m.A,{size:16,className:"text-gray-400 transition-colors group-hover:text-violet-500 flex-shrink-0 ml-2 mt-1"})]}),(0,r.jsx)("div",{className:"mt-3 text-sm text-gray-700 rich-text-content",dangerouslySetInnerHTML:{__html:s.summary||""}}),(0,r.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200 flex items-center text-xs text-gray-500",children:x&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{size:14}),(0,r.jsxs)("span",{children:["截止日期：",x]})]})})]})};var f=s(53311),g=s(71007);let p=e=>{var t,s;let{message:a,user:n,isLoading:i=!1}=e,[c,d]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{d(!0)},[]),i)return(0,r.jsxs)("div",{className:"flex items-start gap-3 max-w-2xl w-full",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center w-10 flex-shrink-0",children:[(0,r.jsx)("div",{className:"relative w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center gemini-avatar-glow",children:(0,r.jsx)("div",{className:"w-full h-full bg-white rounded-full flex items-center justify-center",children:(0,r.jsx)(f.A,{size:20,className:"text-gray-600"})})}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1.5",children:"Gemini"})]}),(0,r.jsxs)("div",{className:"p-3 bg-gray-100 rounded-2xl flex items-center gap-2 mt-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.1s]"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"})]})]});if(!a)return null;let u="user"===a.role,m=u?(null==n||null==(t=n.user_metadata)?void 0:t.name)||"User":"Gemini",h=m.charAt(0).toUpperCase(),p="";try{p=new Date(a.timestamp).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch(e){}let y=[],w=a.content.replace(/\[ANNOUNCEMENT_CARD:([\w,-]+)\]/g,(e,t)=>(y.push(...t.split(",")),"")).trim(),j=[...new Set(y)];return(0,r.jsxs)("div",{className:"flex items-start gap-3 ".concat(u?"flex-row-reverse ml-auto":""," max-w-2xl w-full"),children:[(0,r.jsxs)("div",{className:"flex flex-col items-center w-10 flex-shrink-0",children:[(0,r.jsx)("div",{className:"relative w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center text-white font-bold\n                    ".concat(u?"bg-purple-400":""),children:u?(null==n||null==(s=n.user_metadata)?void 0:s.name)?h:(0,r.jsx)(g.A,{size:20}):(0,r.jsx)("div",{className:"w-full h-full bg-white rounded-full flex items-center justify-center border-2 border-gray-200",children:(0,r.jsx)(f.A,{size:20,className:"text-gray-600"})})}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1.5 whitespace-nowrap",children:m})]}),(0,r.jsxs)("div",{className:"flex flex-col w-[calc(100%-52px)] ".concat(u?"items-end":"items-start"),children:[(0,r.jsx)("div",{className:"px-4 py-3 rounded-2xl w-fit max-w-full\n                    ".concat(u?"bg-purple-500 text-white":"bg-gray-100 text-gray-800 border border-gray-200"),children:c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"prose prose-sm max-w-none prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-table:my-4",children:(0,r.jsx)(o,{content:w})}),j.length>0&&(0,r.jsx)("div",{className:"mt-3 pt-3 border-t border-t-black/10 space-y-3",children:j.map(e=>(0,r.jsx)(x,{id:e.trim()},e))})]})}),p&&(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-1.5 px-2",children:p})]})]})};var y=s(28883),w=s(62525),j=s(12486);let b=e=>{let{onSubmit:t,onClear:s,isLoading:a,onSupportRequest:n,hasStarted:i}=e,[c,o]=(0,l.useState)("");return(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[i&&(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsxs)("button",{type:"button",onClick:n,disabled:a,title:"AI 無法解決？尋求承辦人員協助",className:"group flex items-center space-x-2 px-4 py-1.5 rounded-full text-xs font-semibold border border-purple-300 text-purple-600  transition-all duration-300 ease-in-out shadow-sm  hover:bg-purple-50 hover:border-purple-400 hover:shadow-lg hover:shadow-purple-500/20 disabled:bg-gray-100 disabled:border-gray-300 disabled:text-gray-400 disabled:shadow-none focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,r.jsx)(y.A,{size:14}),(0,r.jsx)("span",{children:"AI 無法解決？尋求承辦人員協助"})]})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c.trim()&&!a&&(t(c),o(""))},className:"relative flex items-center w-full",children:[(0,r.jsx)("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 z-10",children:(0,r.jsxs)("button",{type:"button",onClick:s,disabled:a,title:"刪除對話紀錄",className:"group flex items-center space-x-1.5 rounded-full h-10 px-3 text-xs text-gray-500 transition-colors hover:bg-red-50 hover:text-red-600 disabled:opacity-50",children:[(0,r.jsx)(w.A,{size:16}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"刪除紀錄"})]})}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"詢問獎學金相關問題...",disabled:a,className:"w-full bg-white border border-gray-200 rounded-full py-4 pl-12 sm:pl-28 pr-14 text-base text-gray-800 placeholder-gray-400 transition-shadow duration-300 shadow-md focus:outline-none input-focus-glow"}),(0,r.jsx)("button",{type:"submit",disabled:a||!c.trim(),className:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 flex-shrink-0 bg-gradient-to-br from-purple-500 to-indigo-500 text-white rounded-full flex items-center justify-center transition-all duration-300 disabled:opacity-50 disabled:scale-90 hover:from-purple-600 hover:to-indigo-600 focus:outline-none focus:ring-4 focus:ring-purple-300",children:(0,r.jsx)(j.A,{size:18})})]})]})};var N=s(81497),v=s(51154),A=s(6874),S=s.n(A),_=s(54213),k=s(34869);let I=()=>{let{user:e}=(0,a.A)(),[t,s]=(0,l.useState)([]),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null),g=(0,l.useRef)(null),y=(0,l.useRef)(null),w=!d&&t.length>0,j=(0,l.useCallback)(()=>{g.current&&g.current.scrollTo({top:g.current.scrollHeight,behavior:"smooth"})},[]),A=(0,l.useCallback)(async()=>{if(!e)return void m(!1);m(!0);try{let e=await (0,n.tm)("/api/chat-history"),t=await e.json();t.success&&t.data.length>0&&s(t.data.map(e=>({role:e.role,content:e.message_content,timestamp:e.timestamp})))}catch(e){x({message:"載入歷史紀錄失敗",type:"error"})}finally{m(!1)}},[e]);(0,l.useEffect)(()=>{A()},[A]),(0,l.useEffect)(()=>{let e=setTimeout(()=>{j()},100);return()=>clearTimeout(e)},[t,d,j]);let I=async e=>{let r=e.trim();if(!r||c)return;let a={role:"user",content:r,timestamp:new Date().toISOString()};s(e=>[...e,a]),o(!0);try{let e=[...t].map(e=>({role:e.role,message_content:e.content})),a=await (0,n.tm)("/api/chat",{method:"POST",body:JSON.stringify({message:r,history:e})}),l=await a.json();if(!a.ok)throw Error(l.error||"AI 回應時發生錯誤");s(e=>[...e,{role:"model",content:l.response,timestamp:new Date().toISOString()}])}catch(e){s(e=>[...e,{role:"model",content:"抱歉，發生錯誤，請稍後再試。",timestamp:new Date().toISOString()}]),x({message:e.message,type:"error"})}finally{o(!1)}},E=async()=>{if(!c){if(0===t.length)return void alert("請先開始對話，才能尋求支援喔！");if(window.confirm("您確定要將目前的對話紀錄傳送給獎學金承辦人員嗎？")){o(!0);try{let e=await (0,n.tm)("/api/send-support-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t})}),s=await e.json();if(!e.ok)throw Error(s.error||"請求傳送失敗");x({message:s.message,type:"success"})}catch(e){x({message:"錯誤：".concat(e.message),type:"error"})}finally{o(!1)}}}},C=async()=>{if(!c&&window.confirm("您確定要清除所有對話紀錄嗎？此操作無法復原。")){o(!0);try{let e=await (0,n.tm)("/api/chat-history",{method:"DELETE"}),t=await e.json();if(!e.ok)throw Error(t.error||"清除失敗");s([]),x({message:"對話紀錄已清除",type:"success"})}catch(e){x({message:e.message,type:"error"})}finally{o(!1)}}};return(0,r.jsxs)("div",{className:"flex flex-col flex-1 bg-white overflow-hidden",children:[(0,r.jsx)("div",{ref:g,className:"flex-1 overflow-y-auto p-4 md:p-6 chat-scroll-fade",children:(0,r.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[d?(0,r.jsx)("div",{className:"flex justify-center items-center h-full pt-20",children:(0,r.jsx)(v.A,{className:"animate-spin text-indigo-500",size:32})}):0===t.length?(0,r.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,r.jsx)(()=>(0,r.jsxs)("div",{className:"flex flex-col justify-center items-center h-full text-center p-4 sm:p-8 max-w-2xl mx-auto",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl mb-5 flex items-center justify-center",children:(0,r.jsx)(N.A,{size:32,className:"text-indigo-500"})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"彰師 AI 獎學金助理"}),(0,r.jsx)("p",{className:"text-gray-500 mt-2 text-sm",children:"Powered by Gemini 2.5 Flash"}),(0,r.jsx)("div",{className:"text-left space-y-8 mt-8 text-gray-700",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800 mb-4 text-base",children:"為您精準查找獎學金資訊的智慧流程"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1 mr-4 w-8 h-8 flex items-center justify-center bg-indigo-100 rounded-full",children:(0,r.jsx)(_.A,{size:18,className:"text-indigo-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800",children:"內部知識庫優先"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"優先於校內獎學金資料庫進行語意搜尋，透過 AI 評分，提供最直接相關的公告資訊。"})]})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1 mr-4 w-8 h-8 flex items-center justify-center bg-green-100 rounded-full",children:(0,r.jsx)(k.A,{size:18,className:"text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800",children:"外部網路檢索"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"若內部資料不足或相關性低，系統將自動擴大搜尋範圍至外部網路，整合可信的公開資訊。"})]})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1 mr-4 w-8 h-8 flex items-center justify-center bg-amber-100 rounded-full",children:(0,r.jsx)(f.A,{size:18,className:"text-amber-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800",children:"AI 統整生成"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"彙整所有檢索資訊作為上下文，最終生成一段條理分明、引述來源的客觀答覆。"})]})]})]})]})}),(0,r.jsxs)("div",{className:"mt-10 text-xs text-gray-500 border-t border-gray-200 pt-6 w-full text-center",children:[(0,r.jsxs)("p",{className:"font-semibold text-red-600 flex items-center justify-center",children:[(0,r.jsx)(u.A,{size:14,className:"mr-1.5"}),"AI 生成內容免責聲明"]}),(0,r.jsxs)("p",{className:"mt-2 leading-relaxed",children:["AI 生成內容僅供參考，不構成任何形式的建議、保證或法律意見。",(0,r.jsx)("br",{className:"hidden md:block"}),(0,r.jsx)("span",{className:"inline-block mt-1 md:mt-0",children:"您有最終責任詳閱原始公告內容，並自行核實所有資訊的正確性。"}),(0,r.jsx)("br",{className:"hidden md:block"}),(0,r.jsxs)("span",{className:"inline-block mt-1 md:mt-0",children:["開始使用本服務即代表您已詳閱並同意我們的",(0,r.jsx)(S(),{href:"/terms-and-privacy",target:"_blank",className:"text-indigo-600 font-semibold hover:underline mx-1",children:"服務條款"}),"。"]})]})]})]}),{})}):t.map((t,s)=>(0,r.jsx)(p,{message:t,user:e},s)),c&&t.length>0&&"user"===t[t.length-1].role&&(0,r.jsx)(p,{isLoading:!0,message:{role:"model",content:"",timestamp:new Date().toISOString()},user:e}),(0,r.jsx)("div",{ref:y})]})}),(0,r.jsx)("div",{className:"p-4 bg-white flex-shrink-0",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,r.jsx)(b,{onSubmit:I,onClear:C,isLoading:c,onSupportRequest:E,hasStarted:w})})}),h&&(0,r.jsx)(i.A,{show:!!h,message:h.message,type:h.type,onClose:()=>x(null)})]})};var E=s(35695);function C(){let{isAuthenticated:e,loading:t}=(0,a.A)(),s=(0,E.useRouter)();return((0,l.useEffect)(()=>{t||e||s.push("/login?redirect=/ai-assistant")},[e,t,s]),t)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"載入中..."})]})}):e?(0,r.jsx)("div",{className:"flex flex-col",style:{height:"calc(100vh - var(--header-height, 80px))"},children:(0,r.jsx)(I,{})}):null}},65235:(e,t,s)=>{Promise.resolve().then(s.bind(s,62750))},77604:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(95155),a=s(12115),l=s(60760),n=s(38274),i=s(40646),c=s(1243),o=s(81284),d=s(54416);let u=e=>{let{show:t,message:s,type:u="success",onClose:m}=e;a.useEffect(()=>{if(t){let e=setTimeout(()=>m(),5e3);return()=>clearTimeout(e)}},[t,m]);let h={success:{icon:(0,r.jsx)(i.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,r.jsx)(c.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,r.jsx)(o.A,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},x=h[u]||h.info;return(0,r.jsx)(l.N,{children:t&&(0,r.jsx)(n.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,r.jsxs)("div",{className:"flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ".concat(x.style),children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:x.icon}),(0,r.jsx)("div",{className:"ml-3 flex-1",children:(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:s})}),(0,r.jsx)("button",{onClick:m,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,r.jsx)(d.A,{className:"w-5 h-5"})})]})})})}},92531:(e,t,s)=>{"use strict";s.d(t,{tm:()=>n});var r=s(45749);async function a(){try{let{data:{session:e}}=await r.N.auth.getSession();return(null==e?void 0:e.access_token)||null}catch(e){return console.error("Error getting current token:",e),null}}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await a(),s={...e.headers};return s["Content-Type"]||s["content-type"]||e.body instanceof FormData||(s["Content-Type"]="application/json"),t&&(s.Authorization="Bearer ".concat(t)),{...e,headers:s}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,await l(t))}}},e=>{e.O(0,[4677,1658,6874,595,8441,5964,7358],()=>e(e.s=65235)),_N_E=e.O()}]);