(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[908],{1909:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ev});var s=a(95155),n=a(12115),l=a(76392),r=a(35695),i=a(25215),o=a(45749),d=a(60760),c=a(38274),m=a(97811),x=a(11518),p=a.n(x),h=a(57114);let g=e=>{let{value:t,onChange:a,placeholder:l,disabled:r}=e,[i,o]=(0,n.useState)(!1),d=(0,n.useRef)(null);return((0,n.useEffect)(()=>{o(!0)},[]),i)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p(),{id:"e105e4384e573720",children:".rich-text-content table{width:100%!important;border-collapse:collapse}.rich-text-content td,.rich-text-content th{border:1px solid#ccc;padding:8px}"}),(0,s.jsx)(h.K,{apiKey:"mafnrvqz0j1ur677yypbob3rz7752nrifayzjsu9d5euqfbf",onInit:(e,t)=>d.current=t,value:t||"",onEditorChange:(e,t)=>{a(e)},disabled:r,init:{min_height:350,autoresize_bottom_margin:25,resize:"vertical",language:"zh_TW",language_url:"/langs/zh_TW.js",placeholder:l||"",plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","help","wordcount","autoresize","codesample","emoticons"],toolbar:"undo redo | styles | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | table codesample emoticons | removeformat | fullscreen preview code | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }",table_toolbar:"tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol",image_advtab:!0,image_caption:!0,image_title:!0,paste_data_images:!0,menubar:!0}})]}):(0,s.jsx)("div",{style:{minHeight:"350px",border:"1px solid #ccc",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",color:"#666"},children:"載入編輯器中..."})};var u=a(25671),b=a(77604),f=a(92531),y=a(42337),v=a(99890),j=a(62525),w=a(38164),N=a(51154),_=a(49103),k=a(54416),C=a(4229);let A={primary:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-indigo-400 bg-transparent text-indigo-600 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-indigo-100 hover:text-indigo-700 hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",secondary:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-stone-400 bg-transparent text-stone-700 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-stone-200 hover:text-stone-800 hover:border-stone-500 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-stone-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed"},S=e=>{let{inputMode:t,setInputMode:a,disabled:n}=e;return(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"選擇輸入模式"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"relative border-2 rounded-lg p-4 cursor-pointer transition-all ".concat("ai"===t?"border-indigo-500 bg-indigo-500/10":"border-gray-300 hover:border-gray-400"),onClick:()=>!n&&a("ai"),children:[(0,s.jsx)("h4",{className:"font-bold text-gray-900",children:"AI 智慧分析"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"上傳檔案或網址，由 AI 自動生成摘要"})]}),(0,s.jsxs)("div",{className:"relative border-2 rounded-lg p-4 cursor-pointer transition-all ".concat("manual"===t?"border-indigo-500 bg-indigo-500/10":"border-gray-300 hover:border-gray-400"),onClick:()=>!n&&a("manual"),children:[(0,s.jsx)("h4",{className:"font-bold text-gray-900",children:"手動輸入"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"自行填寫所有公告欄位"})]})]})]})},z=e=>{let{selectedFiles:t,setSelectedFiles:a,disabled:l,showToast:r}=e,i=(0,n.useRef)(null),o="".concat(15," MB"),d={"application/pdf":["pdf"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/webp":["webp"],"application/msword":["doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.ms-excel":["xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.ms-powerpoint":["ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.oasis.opendocument.presentation":["odp"]},c=Object.values(d).flat().map(e=>".".concat(e)).join(","),m=e=>{let s=[];for(let a of e){var n;let e=(null==(n=a.name.split(".").pop())?void 0:n.toLowerCase())||"";if(!(Object.keys(d).includes(a.type)||Object.values(d).flat().includes(e))){r("不支援的檔案類型: ".concat(a.name),"warning");continue}if(t.some(e=>e.name===a.name)){r('檔案 "'.concat(a.name,'" 已存在'),"warning");continue}if(a.size>0xf00000){r("檔案大小超過 ".concat(o," 限制: ").concat(a.name),"warning");continue}if(t.length+s.length>=8){r("最多只能選擇 ".concat(8," 個檔案"),"warning");break}a.isNewFile=!0,s.push(a)}s.length>0&&a(e=>[...e,...s])};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-300 ".concat(l?"bg-gray-100/50 cursor-not-allowed":"border-gray-300 hover:border-indigo-400 bg-transparent cursor-pointer"),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),l||m(Array.from(e.dataTransfer.files))},onClick:()=>{var e;return!l&&(null==(e=i.current)?void 0:e.click())},children:[(0,s.jsx)("input",{type:"file",ref:i,onChange:e=>{m(Array.from(e.target.files)),e.target.value=""},className:"hidden",accept:c,disabled:l,multiple:!0}),(0,s.jsx)(y.A,{className:"mx-auto h-10 w-10 text-gray-400"}),(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["拖曳檔案到此，或 ",(0,s.jsx)("span",{className:"font-medium text-indigo-600",children:"點擊上傳"})]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["已選擇 ",t.length," / ",8," 個檔案"]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-400",children:["支援文件 (Word, Excel, PPT, PDF, ODT, ODS, ODP) 及圖片格式，單一檔案大小上限為 ",o]})]}),t.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)("div",{className:"space-y-2 rounded-lg p-2 bg-transparent",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"relative flex items-center justify-between p-3 rounded-lg bg-white border",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,s.jsx)(v.A,{className:"h-6 w-6 flex-shrink-0 text-blue-500"}),(0,s.jsxs)("div",{className:"overflow-hidden",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[e.type," • ",(e=>e?e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(1)," MB"):"0 B")(e.size)]})]})]}),(0,s.jsx)("button",{onClick:()=>a(e=>e.filter((e,a)=>a!==t)),className:"p-1 rounded-full transition-colors text-red-500 hover:bg-red-100",title:"移除",children:(0,s.jsx)(j.A,{size:18})})]},e.name+t))})})]})},D=e=>{let{urls:t,setUrls:a,disabled:l,showToast:r}=e,[i,o]=(0,n.useState)(""),d=()=>{let e=i.trim();if(!e)return void r("請輸入網址","warning");try{new URL(e)}catch(e){r("請輸入有效的網址","warning");return}if(t.some(t=>t===e))return void r("此網址已經存在","warning");a(t=>[...t,e]),o("")};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"url",value:i,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),d()),placeholder:"輸入網址進行 AI 分析",className:"".concat("w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"," flex-grow"),disabled:l}),(0,s.jsx)("button",{type:"button",onClick:d,disabled:l||!i.trim(),className:A.primary,children:"添加"})]}),t.length>0&&(0,s.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto p-2",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,s.jsx)(w.A,{className:"w-5 h-5 text-indigo-500 flex-shrink-0"}),(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-indigo-600 hover:underline truncate",children:e})]}),!l&&(0,s.jsx)("button",{onClick:()=>{a(e=>e.filter((e,a)=>a!==t))},className:"p-1 rounded-full text-red-500 hover:bg-red-100 ml-2",title:"移除網址",children:(0,s.jsx)(j.A,{size:16})})]},t))})]})};function F(e){let{isOpen:t,onClose:a,refreshAnnouncements:l}=e,[r,i]=(0,n.useState)("ai"),[x,p]=(0,n.useState)(0),[h,y]=(0,n.useState)(!1),[v,F]=(0,n.useState)("處理中..."),[T,E]=(0,n.useState)([]),[O,P]=(0,n.useState)([]),[I,M]=(0,n.useState)({show:!1,message:"",type:"success"}),L=(0,n.useRef)(null),B={title:"",summary:"",category:"",application_start_date:"",application_end_date:"",target_audience:"",application_limitations:"",submission_method:"",external_urls:[{url:""}],is_active:!0},[R,J]=(0,n.useState)(B),V="w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30",H=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return M({show:!0,message:e,type:t})};(0,n.useEffect)(()=>{try{L.current=new m.ij("AIzaSyDljixz0B0zHSqplA4sX1F0RK_fX2abU3s").getGenerativeModel({model:"gemini-2.5-flash",generationConfig:{responseMimeType:"application/json"}})}catch(e){console.error("Failed to initialize Gemini AI:",e),H("AI 模型初始化失敗","error")}},[]),(0,n.useEffect)(()=>(t?(document.body.style.overflow="hidden",i("ai"),p(0),E([]),P([]),J(B)):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]);let W=(0,n.useCallback)(e=>J(t=>({...t,summary:e})),[]),Y=(0,n.useCallback)(e=>J(t=>({...t,target_audience:e})),[]),U=e=>J(t=>({...t,[e.target.name]:e.target.value})),G=""!==R.title.trim()&&""!==R.summary.replace(/<[^>]*>?/gm,"").trim(),q=async e=>({inlineData:{data:await new Promise((t,a)=>{let s=new FileReader;s.onloadend=()=>t(s.result.split(",")[1]),s.onerror=e=>a(e),s.readAsDataURL(e)}),mimeType:e.type}}),K=async()=>{if(0===T.length&&0===O.length)return void H("請至少上傳一個檔案或提供一個網址","warning");if(!L.current)return void H("AI 模型尚未初始化或初始化失敗","error");y(!0),p(1);try{let e;F("正在準備分析資料...");let t=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"],a=T.filter(e=>t.includes(e.type));a.length>0&&console.log("找到 ".concat(a.length," 個可供 AI 分析的檔案:"),a.map(e=>e.name)),a.length<T.length&&console.log("有 ".concat(T.length-a.length," 個檔案將作為一般附件，不參與 AI 分析。"));let s=[],n=[],l=[];if(O.length>0){F("正在分析 ".concat(O.length," 個網址..."));let e=O.map(async e=>{try{let t=await fetch("/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!t.ok)return console.warn("爬取網址失敗 (API 狀態碼: ".concat(t.status,"): ").concat(e)),{url:e,success:!1};let a=await t.json();if(a.error||!a.scrapedText)return console.warn("無法從網址提取內容: ".concat(e,". ").concat(a.message||"")),{url:e,success:!1};return{url:e,text:a.scrapedText,success:!0}}catch(t){return console.error("爬取網址時發生前端錯誤: ".concat(e),t),{url:e,success:!1}}});(await Promise.all(e)).forEach(e=>{let{url:t,text:a,success:s}=e;s?l.push("--- 網址內容 (".concat(t,") ---\n").concat(a)):n.push(t)})}let r='\n# 角色 (Persona)\n你是一位頂尖的「彰化師範大學獎學金公告分析專家」。你的風格是專業、精確且以學生為中心。你的任務是將一篇關於獎學金的公告，轉換成一段重點突出、視覺清晰的 HTML 公告，並提取結構化資料。你只須關注與彰師大「大學部」及「碩士班」學生相關的資訊，並嚴格遵循所有規則。\n\n# 核心任務 (Core Task)\n你的任務是根據下方提供的「公告全文」，執行以下兩項任務，並將結果合併在一個**單一的 JSON 物件**中回傳。\n\n## 任務一：提取結構化資料 (JSON Extraction)\n提取公告中的關鍵資訊，並以一個嚴格的 JSON 物件格式回傳。\n\n### 欄位規則 (Field Rules)\n- **不確定性原則**：若資訊未提及或不明確，**必須**回傳 `null`，**禁止**自行猜測。\n- **日期格式**：所有日期欄位格式必須是 `YYYY-MM-DD`。民國年 + 1911 即為西元年。\n- **欄位列表**：\n    1.  `title` (string | null): 公告的**簡短**標題，必須包含**提供單位**和**獎學金名稱**。例如：「國際崇她社『崇她獎』獎學金」。\n    2.  `category` (string | null): 根據下方的「代碼定義」從 \'A\'~\'E\' 中選擇一個。\n    3.  `application_start_date` (string | null): **申請開始日期**。\n    4.  `application_end_date` (string | null): **申請結止日期**，格式必須是 \'YYYY-MM-DD\' 。若只提及月份，以該月最後一天為準。若為區間，以**結束日期**為準，備註: 民國年 + 1911 即為西元年。\n    5.  `target_audience` (string | null): **目標對象**。**此欄位必須是 HTML 格式**，並遵循下方的「視覺化與樣式指導」為關鍵字上色。\n    6.  `application_limitations` (string | null): **兼領限制**。若明確提及**不行**兼領，回傳 \'N\'，否則一律回傳 \'Y\'。\n    7.  `submission_method` (string | null): **送件方式**。簡要說明最終的送件管道。\n    8.  `external_urls` (array of objects | []): **所有相關網址**。將所有找到的 URL 整理成一個物件陣列，格式為 `[{ "url": "https://..." }]`。若無則回傳空陣列 `[]`。\n    9.  `summary` (string | null): **公告摘要**。**此欄位必須是 HTML 格式**，並遵循下方的「視覺化與樣式指導」為關鍵字上色。\n    \n## 任務二：生成 HTML 重點摘要 (HTML Summary Generation)\n根據你分析的內容，生成一份專業、條理分明的 HTML 格式重點摘要。\n\n### 內容與結構指導\n- **摘要必須包含**：申請期限、申請資格、獎助金額、應繳文件、其他注意事項。\n- **表格優先**：當資訊具有「項目-內容」的對應關係資訊時，**優先使用 `<table>`** 以提升閱讀性。\n\n### 視覺化與樣式指導 (適用於 summary 和 target_audience)\n- **多色彩重點標記**：\n    - **金額、日期、名額等數字類關鍵字**: `<span style="color: #D6334C; font-weight: bold;">`\n    - **身份、成績等申請條件**: `<span style="color: #F79420; font-weight: bold;">`\n    - **所有小標題**: `<h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">`\n- `summary` 的內容必須放在 JSON 物件的 `summary` (string) 鍵中。\n\n# 獎助學金代碼定義 (Category Definitions)\n- **A**: 各縣市政府獎助學金\n- **B**: 縣市政府以外之各級公家機關及公營單位獎助學金\n- **C**: 宗親會及民間各項指定身分獎助學金 (指定姓名、籍貫、學系等)\n- **D**: 非公家機關或其他無法歸類的獎助學金\n- **E**: 獎學金得獎名單公告\n\n# 最終輸出規則\n- **你的回覆必須是、也只能是一個 JSON 物件**，不含任何 Markdown 標記。\n- 請嚴格模仿下方範例的 JSON 結構和 HTML 風格。\n\n# 輸出格式與範例 (Output Format & Example)\n```json\n{\n  "title": "國際蘭馨交流協會『讓夢想起飛』獎學金",\n  "category": "C",\n  "application_start_date": null,\n  "application_end_date": "2025-07-23",\n  "target_audience": "<ul><li>國內各大學日間部、進修學士班之<span style=\\"color: #F79420; font-weight: bold;\\">在學女學生</span>。</li><li>歷年學業平均成績達 <span style=\\"color: #F79420; font-weight: bold;\\">70分</span>。</li></ul>",\n  "application_limitations": "N",\n  "submission_method": "送件至生輔組或將申請資料寄送至承辦人員信箱: act5718@gmail.com",\n  "external_urls": [{ "url": "https://example.com/scholarship-info" }],\n  "summary": "<h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請期限與方式</h4><p>親送或寄送郵件至生輔組承辦人員，由學校代為辦理，截止日期為 <span style="color: #D6334C; font-weight: bold;">2025年7月23日</span>。</p><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請資格</h4><ul><li>家境清寒且就讀<span style="color: #F79420; font-weight: bold;">國立大學</span>之<span style="color: #F79420; font-weight: bold;">績優女學生</span>（不限年級）。</li><li>在校學業平均成績達 <span style="color: #F79420; font-weight: bold;">70分</span> 以上，且未受小過以上處分。</li></ul><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">獎助金額</h4><p>依申請年級不同，提供相對應的學費補助，詳情如下：</p><table style="width: 100%; border-collapse: collapse; margin-top: 0.5em;"><thead><tr style="background-color: #f2f2f2;"><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">適用對象</th><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">補助內容</th></tr></thead><tbody><tr><td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #F79420; font-weight: bold;">大一新生及大三學生</span></td><td style="padding: 8px; border: 1px solid #ddd;">通過審查後，補助<span style="color: #D6334C; font-weight: bold;">兩年</span>學雜費</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #F79420; font-weight: bold;">大二女學生</span></td><td style="padding: 8px; border: 1px solid #ddd;">通過審查後，補助<span style="color: #D6334C; font-weight: bold;">一年</span>學雜費</td></tr></tbody></table><p style="margin-top: 0.5em;">註：已受補助學生可持續獲得補助至其大四學年，但須符合每階段資格審查標準。</p><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">申請應繳文件</h4><table style="width: 100%; border-collapse: collapse; margin-top: 0.5em;"><thead><tr style="background-color: #f2f2f2;"><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">文件項目</th><th style="padding: 8px; border: 1px solid #ddd; text-align: left;">備註</th></tr></thead><tbody><tr><td style="padding: 8px; border: 1px solid #ddd;">1. 全家人口戶籍謄本</td><td style="padding: 8px; border: 1px solid #ddd;">-</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">2. 全家人口所得及財產資料</td><td style="padding: 8px; border: 1px solid #ddd;">請向國稅局申請</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">3. 最近學期成績單</td><td style="padding: 8px; border: 1px solid #ddd;">-</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">4. 大學完整學業成績單與操行紀錄</td><td style="padding: 8px; border: 1px solid #ddd;">適用於<span style="color: #F79420; font-weight: bold;">大三以上</span>學生</td></tr><tr><td style="padding: 8px; border: 1px solid #ddd;">5. 相關證明文件</td><td style="padding: 8px; border: 1px solid #ddd;">如身心障礙手冊、重大傷病卡等 (無則免附)</td></tr></tbody></table><h4 style="color: #008DD5; margin-top: 1.5em; margin-bottom: 0.75em;">其他注意事項</h4><p>申請人家庭若有以下任一情況，則<span style="color: #D6334C; font-weight: bold;">不符合</span>清寒補助資格：</p><ul><li>全戶存款本金合計超過 <span style="color: #D6334C; font-weight: bold;">10萬元</span>。</li><li>全戶土地及房屋公告現值合計超過 <span style="color: #D6334C; font-weight: bold;">100萬元</span>（自用住宅不在此限）。</li><li>其他情況如休學、畢業或家庭經濟狀況已顯著改善者。</li></ul>"\n}\n```\n\n# 公告全文 (Source Text)\n---\n請分析以下資訊：\n'.concat(l.length>0?"\n# 已爬取的網址內容:\n".concat(l.join("\n\n")):"","\n").concat(n.length>0?"\n# 以下網址無法爬取，請直接分析:\n".concat(n.join("\n")):"","\n").concat(T.length>0?"\n# 檔案資料來源":"","\n");if(s.push({text:r}),a.length>0){let e=a.map(e=>q(e)),t=await Promise.all(e);s.push(...t),H("已附加 ".concat(a.length," 個檔案進行 AI 分析"),"info")}F("AI 分析中，請稍候...");let i=(await L.current.generateContent({contents:[{parts:s}]})).response;try{e=JSON.parse(i.text())}catch(e){throw console.error("AI 回應的原始文字:",i.text()),Error("AI 回應的 JSON 格式解析失敗: ".concat(e.message))}if(!e.title||!e.summary)throw console.error("AI 回應不完整:",e),Error("AI 回應中缺少必要的 `title` 或 `summary` 欄位。");J(t=>({...t,...e,is_active:!0,external_urls:Array.isArray(e.external_urls)&&e.external_urls.length>0?e.external_urls:[{url:""}]})),p(2)}catch(e){console.error("AI 分析流程失敗:",e),H("分析失敗: ".concat(e.message),"error"),p(0)}finally{y(!1)}},Z=async()=>{if(!G)return void H("請填寫所有必填欄位","warning");y(!0),F("儲存中...");try{let e=[],t=T.filter(e=>e.isNewFile);if(t.length>0){F("正在上傳 ".concat(t.length," 個檔案..."));let a=new FormData;for(let e of t)a.append("files",e);let s=await (0,f.tm)("/api/upload-files",{method:"POST",body:a});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error("檔案上傳失敗: ".concat(e.error||s.statusText))}let n=await s.json();if(n.data.errors&&n.data.errors.length>0){let e=n.data.errors.map(e=>e.fileName).join(", ");H("部分檔案處理失敗: ".concat(e),"warning")}e=n.data.uploaded||[]}F("正在寫入資料庫...");let s=R.external_urls.filter(e=>e.url&&""!==e.url.trim()),n={title:R.title,summary:R.summary,category:R.category,application_start_date:R.application_start_date||null,application_end_date:R.application_end_date||null,target_audience:R.target_audience,application_limitations:R.application_limitations,submission_method:R.submission_method,external_urls:JSON.stringify(s),is_active:R.is_active},{data:r,error:i}=await o.N.from("announcements").insert(n).select().single();if(i)throw i;if(e.length>0){let t=e.map(e=>({announcement_id:r.id,file_name:e.originalName,stored_file_path:e.path,file_size:e.size,mime_type:e.mimeType})),{error:a}=await o.N.from("attachments").insert(t);if(a)throw a}H("公告發布成功!","success"),l&&l(),a()}catch(e){console.error("儲存失敗:",e),H("儲存失敗: ".concat(e.message),"error")}finally{y(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{show:I.show,message:I.message,type:I.type,onClose:()=>M(e=>({...e,show:!1}))}),(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 pt-16",children:(0,s.jsxs)(c.P.div,{initial:{scale:.95,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:50,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-5xl flex flex-col overflow-hidden border border-white/20",style:{height:"calc(100vh - 10rem)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"新增公告"}),(0,s.jsx)("button",{onClick:()=>{window.confirm("確認關閉公告編輯模組嗎？如尚未儲存將丟失此編輯紀錄！")&&a()},disabled:h,className:"text-gray-400 hover:text-gray-600 p-2 rounded-full",children:(0,s.jsx)(k.A,{size:20})})]}),(0,s.jsx)("div",{className:"flex-grow p-6 overflow-y-auto",children:0===x?(0,s.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,s.jsx)(S,{inputMode:r,setInputMode:i,disabled:h}),(0,s.jsx)("hr",{className:"my-6 border-gray-200"}),"ai"===r?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"上傳檔案或提供網址"}),(0,s.jsx)(z,{selectedFiles:T,setSelectedFiles:E,disabled:h,showToast:H}),(0,s.jsx)(D,{urls:O,setUrls:P,disabled:h,showToast:H})]}):(0,s.jsxs)("div",{className:"text-center text-gray-500 p-8 bg-gray-50/50 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"手動輸入模式"}),(0,s.jsx)("p",{children:"請點擊「下一步」開始手動填寫公告內容。"})]})]}):1===x?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[(0,s.jsx)(N.A,{className:"animate-spin h-12 w-12 text-indigo-600 mb-4"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:v}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"請稍候，AI 正在為您生成公告內容..."})]}):2===x?(0,s.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:["公告標題 ",(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",className:V,value:R.title,onChange:U})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"is_active",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告狀態"}),(0,s.jsxs)("select",{id:"is_active",name:"is_active",className:V,value:R.is_active,onChange:e=>J(t=>({...t,is_active:"true"===e.target.value})),children:[(0,s.jsx)("option",{value:!0,children:"上架"}),(0,s.jsx)("option",{value:!1,children:"下架"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"category",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"獎學金分類"}),(0,s.jsxs)("select",{id:"category",name:"category",className:V,value:R.category,onChange:U,children:[(0,s.jsx)("option",{value:"",children:"請選擇"}),(0,s.jsx)("option",{value:"A",children:"A：各縣市政府獎學金"}),(0,s.jsx)("option",{value:"B",children:"B：縣市政府以外之各級公家機關及公營單位獎學金"}),(0,s.jsx)("option",{value:"C",children:"C：宗教及民間各項指定身分獎學金"}),(0,s.jsx)("option",{value:"D",children:"D：非公家機關或其他無法歸類的獎助學金"}),(0,s.jsx)("option",{value:"E",children:"E：本校獲配推薦名額獎助學金"}),(0,s.jsx)("option",{value:"F",children:"F：校外獎助學金得獎公告"}),(0,s.jsx)("option",{value:"G",children:"G：校內獎助學金"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_start_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請開始日期"}),(0,s.jsx)("input",{type:"date",id:"application_start_date",name:"application_start_date",className:V,value:R.application_start_date,onChange:U})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_end_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告結束日期"}),(0,s.jsx)("input",{type:"date",id:"application_end_date",name:"application_end_date",className:V,value:R.application_end_date,onChange:U})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"submission_method",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"送件方式"}),(0,s.jsx)("input",{type:"text",id:"submission_method",name:"submission_method",className:V,value:R.submission_method,onChange:U})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_limitations",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"兼領限制"}),(0,s.jsxs)("select",{id:"application_limitations",name:"application_limitations",className:V,value:R.application_limitations,onChange:U,children:[(0,s.jsx)("option",{value:"",children:"未指定"}),(0,s.jsx)("option",{value:"Y",children:"可兼領"}),(0,s.jsx)("option",{value:"N",children:"不可兼領"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col min-h-[250px]",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:"適用對象"}),(0,s.jsx)("div",{className:"relative flex-grow",children:(0,s.jsx)(g,{value:R.target_audience,onChange:Y,disabled:h})})]}),(0,s.jsxs)("div",{className:"flex flex-col min-h-[400px]",children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:["公告摘要 ",(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("div",{className:"relative flex-grow",children:(0,s.jsx)(g,{value:R.summary,onChange:W,disabled:h})})]}),(0,s.jsxs)("div",{className:"p-4 bg-slate-500/5 rounded-lg border",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"附件與連結"}),(0,s.jsx)(z,{selectedFiles:T,setSelectedFiles:E,disabled:h,showToast:H}),(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-600 flex items-center gap-2",children:[(0,s.jsx)(w.A,{size:16}),"外部參考連結"]}),R.external_urls.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"url",className:V,value:e.url,onChange:e=>((e,t)=>{let a=[...R.external_urls];a[e].url=t,J(e=>({...e,external_urls:a}))})(t,e.target.value),placeholder:"https://example.com"}),R.external_urls.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>J(e=>({...e,external_urls:e.external_urls.filter((e,a)=>a!==t)})),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:(0,s.jsx)(j.A,{size:16})})]},t)),(0,s.jsx)(u.A,{type:"button",variant:"ghost",size:"sm",onClick:()=>J(e=>({...e,external_urls:[...e.external_urls,{url:""}]})),leftIcon:(0,s.jsx)(_.A,{size:16}),children:"新增連結"})]})]})]}):void 0}),(0,s.jsxs)("div",{className:"p-4 bg-black/5 flex justify-between items-center flex-shrink-0 border-t border-black/10",children:[(0,s.jsx)("div",{children:2===x&&(0,s.jsx)("button",{type:"button",onClick:()=>p(0),disabled:h,className:A.secondary,children:"返回上一步"})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[0===x&&(0,s.jsx)("button",{type:"button",onClick:()=>{"ai"===r?K():(J(B),p(2))},disabled:h||"ai"===r&&0===T.length&&0===O.length,className:A.primary,children:"ai"===r?"開始 AI 分析":"下一步"}),2===x&&(0,s.jsxs)("button",{type:"button",onClick:Z,disabled:h||!G,className:A.primary,children:[h?(0,s.jsx)(N.A,{size:16,className:"animate-spin"}):(0,s.jsx)(C.A,{size:16}),(0,s.jsx)("span",{children:"儲存並發布"})]})]})]})]})})})]})}var T=a(47650),E=a(93654);let O=e=>{let{file:t,onRemove:a,onUndelete:n,isMarkedForDeletion:l}=e,r=t.isExisting;return(0,s.jsxs)("div",{className:"relative flex items-center justify-between p-3 rounded-lg transition-colors duration-300 ".concat(l?"bg-red-100":"bg-white border"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 overflow-hidden",children:[(0,s.jsx)(v.A,{className:"h-6 w-6 flex-shrink-0 ".concat(r?"text-blue-500":"text-green-500")}),(0,s.jsxs)("div",{className:"overflow-hidden",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate ".concat(l?"line-through":""),children:t.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[t.type," • ",(e=>e?e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(1)," MB"):"0 B")(t.size)]})]})]}),(0,s.jsx)("button",{onClick:l?n:a,className:"p-1 rounded-full transition-colors ".concat(l?"text-yellow-600 hover:bg-yellow-200":"text-red-500 hover:bg-red-100"),title:l?"取消刪除":"標記為刪除",children:l?(0,s.jsx)(E.A,{size:18}):(0,s.jsx)(j.A,{size:18})})]})},P=e=>{let{selectedFiles:t,setSelectedFiles:a,filesToRemove:l,setFilesToRemove:r,disabled:i,showToast:o}=e,d=(0,n.useRef)(null),c="".concat(15," MB"),m={"application/pdf":["pdf"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/webp":["webp"],"application/msword":["doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.ms-excel":["xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.ms-powerpoint":["ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.oasis.opendocument.presentation":["odp"]},x=Object.values(m).flat().map(e=>".".concat(e)).join(","),p=e=>{let s=[];for(let a of e){var n;let e=(null==(n=a.name.split(".").pop())?void 0:n.toLowerCase())||"";if(!(Object.keys(m).includes(a.type)||Object.values(m).flat().includes(e))){o("不支援的檔案類型: ".concat(a.name),"warning");continue}if(t.some(e=>e.name===a.name)){o('檔案 "'.concat(a.name,'" 已存在'),"warning");continue}if(a.size>0xf00000){o("檔案大小超過 ".concat(c," 限制: ").concat(a.name),"warning");continue}if(t.length+s.length>=8){o("最多只能選擇 ".concat(8," 個檔案"),"warning");break}s.push(a)}a(e=>[...e,...s])};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-300 ".concat(i?"bg-gray-100/50 cursor-not-allowed":"border-gray-300 hover:border-indigo-400 bg-transparent cursor-pointer"),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),i||p(Array.from(e.dataTransfer.files))},onClick:()=>{var e;return!i&&(null==(e=d.current)?void 0:e.click())},children:[(0,s.jsx)("input",{type:"file",ref:d,onChange:e=>{p(Array.from(e.target.files)),e.target.value=""},className:"hidden",accept:x,disabled:i,multiple:!0}),(0,s.jsx)(y.A,{className:"mx-auto h-10 w-10 text-gray-400"}),(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["拖曳檔案到此，或 ",(0,s.jsx)("span",{className:"font-medium text-indigo-600",children:"點擊上傳"})]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["已選擇 ",t.length," / ",8," 個檔案"]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-400",children:["支援文件 (Word, Excel, PPT, PDF, ODT, ODS, ODP) 及圖片格式，單一檔案大小上限為 ",c]})]}),t.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)("div",{className:"space-y-2 rounded-lg p-2 bg-transparent",children:t.map((e,n)=>(0,s.jsx)(O,{file:e,onRemove:()=>(e=>{let s=t[e];s.isExisting?r(e=>[...e,s]):a(t=>t.filter((t,a)=>a!==e))})(n),onUndelete:()=>{r(t=>t.filter(t=>t.id!==e.id))},isMarkedForDeletion:l.some(t=>t.id===e.id)},e.id||"new-".concat(n)))})})]})};function I(e){let{isOpen:t,onClose:a,announcement:l,refreshAnnouncements:r}=e,[i,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)([]),[h,y]=(0,n.useState)([]),[v,A]=(0,n.useState)({show:!1,message:"",type:"success"}),[S,z]=(0,n.useState)({title:"",summary:"",is_active:!1,category:"",application_start_date:"",application_end_date:"",target_audience:"",application_limitations:"",submission_method:"",external_urls:[{url:""}]}),D="w-full px-3 py-2 bg-white/70 border border-gray-300 rounded-md shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30";(0,n.useEffect)(()=>{if(t&&l){document.body.style.overflow="hidden";let e=[{url:""}];try{let t=JSON.parse(l.external_urls);Array.isArray(t)&&t.length>0&&(e=t)}catch(t){"string"==typeof l.external_urls&&l.external_urls.startsWith("http")&&(e=[{url:l.external_urls}])}z({title:l.title||"",summary:l.summary||"",is_active:l.is_active,category:l.category||"",application_start_date:l.application_start_date||"",application_end_date:l.application_end_date||"",target_audience:l.target_audience||"",application_limitations:l.application_limitations||"",submission_method:l.submission_method||"",external_urls:e}),F(l.id),y([])}else document.body.style.overflow="unset";return()=>{document.body.style.overflow="unset"}},[t,l]);let F=async e=>{if(!e)return p([]);try{let{data:t,error:a}=await o.N.from("attachments").select("*").eq("announcement_id",e);if(a)throw a;let s=(t||[]).map(e=>({id:e.id,name:e.file_name,size:e.file_size,type:e.mime_type,path:e.stored_file_path,isExisting:!0}));p(s)}catch(e){O("載入附件失敗","error")}},E=()=>A(e=>({...e,show:!1})),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";A({show:!0,message:e,type:t}),setTimeout(()=>{E()},3e3)},I=e=>z(t=>({...t,[e.target.name]:e.target.value})),M=(0,n.useCallback)(e=>z(t=>({...t,summary:e})),[]),L=(0,n.useCallback)(e=>z(t=>({...t,target_audience:e})),[]),B=async()=>{if(!S.title.trim()||!S.summary.replace(/<[^>]*>?/gm,"").trim())return void O("請填寫所有必填欄位","warning");m(!0);try{let e=S.external_urls.filter(e=>""!==e.url.trim()),{data:t,error:s}=await o.N.from("announcements").update({title:S.title,summary:S.summary,is_active:S.is_active,category:S.category,application_start_date:S.application_start_date||null,application_end_date:S.application_end_date||null,target_audience:S.target_audience,application_limitations:S.application_limitations,submission_method:S.submission_method,external_urls:JSON.stringify(e),updated_at:new Date().toISOString()}).eq("id",l.id).select().single();if(s)throw s;if(h.length>0){let e=h.map(e=>e.path),t=h.map(e=>e.id);await (0,f.tm)("/api/delete-files",{method:"POST",body:JSON.stringify({filePaths:e})});let{error:a}=await o.N.from("attachments").delete().in("id",t);if(a)throw a}let n=x.filter(e=>!e.isExisting);if(n.length>0){let e=new FormData;n.forEach(t=>{e.append("files",t)});let a=await (0,f.tm)("/api/upload-files",{method:"POST",body:e});if(!a.ok){let e=await a.json().catch(()=>null),t=(null==e?void 0:e.error)||"檔案上傳請求失敗";throw Error(t)}let s=await a.json();if(s.data.errors&&s.data.errors.length>0){let e=s.data.errors.map(e=>"".concat(e.fileName,": ").concat(e.error)).join(", ");throw Error("部分檔案上傳失敗: ".concat(e))}let l=s.data.uploaded;if(l&&l.length>0){let e=l.map(e=>({announcement_id:t.id,file_name:e.originalName,stored_file_path:e.path,file_size:e.size,mime_type:e.mimeType})),{error:a}=await o.N.from("attachments").insert(e);if(a)throw a}else if(n.length>0&&(!s.data.errors||0===s.data.errors.length))throw Error("上傳成功，但伺服器未回傳任何檔案資料")}r&&r(),a(),O("公告已成功更新","success")}catch(e){O("更新失敗: ".concat(e.message),"error")}finally{m(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,T.createPortal)((0,s.jsx)(b.A,{show:v.show,message:v.message,type:v.type,onClose:E}),document.body),(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 pt-16",children:(0,s.jsxs)(c.P.div,{initial:{scale:.95,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:50,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-4xl flex flex-col overflow-hidden border border-white/20",style:{height:"calc(100vh - 10rem)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"編輯公告"}),(0,s.jsx)("button",{onClick:()=>{window.confirm("確認關閉公告編輯模組嗎？如尚未儲存將丟失此編輯紀錄！")&&a()},disabled:i,className:"text-gray-400 hover:text-gray-600 p-2 rounded-full",children:(0,s.jsx)(k.A,{size:20})})]}),(0,s.jsx)("div",{className:"flex-grow p-6 overflow-y-auto",children:(0,s.jsxs)("div",{className:"space-y-6",children:[i&&(0,s.jsxs)("div",{className:"absolute inset-0 bg-white/70 z-20 flex flex-col items-center justify-center rounded-lg",children:[(0,s.jsx)(N.A,{className:"animate-spin h-8 w-8 text-indigo-600"}),(0,s.jsx)("p",{className:"mt-4 text-indigo-700 font-semibold",children:"儲存中..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:["公告標題 ",(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",className:D,value:S.title,onChange:I})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"is_active",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"公告狀態"}),(0,s.jsxs)("select",{id:"is_active",name:"is_active",className:D,value:S.is_active,onChange:e=>z(t=>({...t,is_active:"true"===e.target.value})),children:[(0,s.jsx)("option",{value:!1,children:"下架"}),(0,s.jsx)("option",{value:!0,children:"上架"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"category",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"獎學金分類"}),(0,s.jsxs)("select",{id:"category",name:"category",className:D,value:S.category,onChange:I,children:[(0,s.jsx)("option",{value:"",children:"請選擇"}),(0,s.jsx)("option",{value:"A",children:"A：各縣市政府獎學金"}),(0,s.jsx)("option",{value:"B",children:"B：縣市政府以外之各級公家機關及公營單位獎學金"}),(0,s.jsx)("option",{value:"C",children:"C：宗教及民間各項指定身分獎學金"}),(0,s.jsx)("option",{value:"D",children:"D：非公家機關或其他無法歸類的獎學金"}),(0,s.jsx)("option",{value:"E",children:"E：本校獲配推薦名額獎助學金"}),(0,s.jsx)("option",{value:"F",children:"F：校外獎助學金得獎公告"}),(0,s.jsx)("option",{value:"G",children:"G：校內獎助學金"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_start_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請開始日期"}),(0,s.jsx)("input",{type:"date",id:"application_start_date",name:"application_start_date",className:D,value:S.application_start_date,onChange:I})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_end_date",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請截止日期"}),(0,s.jsx)("input",{type:"date",id:"application_end_date",name:"application_end_date",className:D,value:S.application_end_date,onChange:I})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"submission_method",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"送件方式"}),(0,s.jsx)("input",{type:"text",id:"submission_method",name:"submission_method",className:D,value:S.submission_method,onChange:I})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"application_limitations",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"申請限制"}),(0,s.jsxs)("select",{id:"application_limitations",name:"application_limitations",className:D,value:S.application_limitations,onChange:I,children:[(0,s.jsx)("option",{value:"",children:"未指定"}),(0,s.jsx)("option",{value:"Y",children:"可兼領"}),(0,s.jsx)("option",{value:"N",children:"不可兼領"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col min-h-[250px]",children:[(0,s.jsx)("label",{htmlFor:"target_audience",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"適用對象"}),(0,s.jsx)("div",{className:"relative flex-grow",children:(0,s.jsx)(g,{value:S.target_audience,onChange:L,disabled:i})})]}),(0,s.jsxs)("div",{className:"flex flex-col min-h-[400px]",children:[(0,s.jsxs)("label",{htmlFor:"summary",className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:["公告摘要 ",(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("div",{className:"relative flex-grow",children:(0,s.jsx)(g,{value:S.summary,onChange:M,disabled:i})})]}),(0,s.jsxs)("div",{className:"p-4 bg-slate-500/5 rounded-lg border",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"附件與連結"}),(0,s.jsx)(P,{selectedFiles:x,setSelectedFiles:p,filesToRemove:h,setFilesToRemove:y,disabled:i,showToast:O}),(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-600 flex items-center gap-2",children:[(0,s.jsx)(w.A,{size:16}),"外部參考連結"]}),S.external_urls.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"url",className:D,value:e.url,onChange:e=>((e,t)=>{let a=[...S.external_urls];a[e].url=t,z(e=>({...e,external_urls:a}))})(t,e.target.value),placeholder:"https://example.com"}),S.external_urls.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>z(e=>({...e,external_urls:e.external_urls.filter((e,a)=>a!==t)})),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:(0,s.jsx)(j.A,{size:16})})]},t)),(0,s.jsx)(u.A,{type:"button",variant:"ghost",size:"sm",onClick:()=>z(e=>({...e,external_urls:[...e.external_urls,{url:""}]})),leftIcon:(0,s.jsx)(_.A,{size:16}),children:"新增連結"})]})]})]})}),(0,s.jsx)("div",{className:"p-4 bg-black/5 flex justify-end space-x-3 flex-shrink-0",children:(0,s.jsxs)("button",{type:"button",onClick:B,disabled:i,className:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-indigo-400 bg-transparent text-indigo-600 transition-all duration-300 ease-in-out transform hover:bg-indigo-100 hover:text-indigo-700 hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none",children:[i?(0,s.jsx)(N.A,{size:16,className:"animate-spin"}):(0,s.jsx)(C.A,{size:16}),(0,s.jsx)("span",{children:"儲存變更"})]})})]})})})]})}var M=a(1243);function L(e){let{isOpen:t,onClose:a,announcementId:l,refreshAnnouncements:r}=e,[i,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)({show:!1,message:"",type:"success"});(0,n.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]);let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return p({show:!0,message:e,type:t})},g=async()=>{if(!l)return void h("無效的公告 ID","error");m(!0);try{let{data:e,error:t}=await o.N.from("attachments").select("stored_file_path").eq("announcement_id",l);if(t&&console.error("無法查詢關聯附件:",t),e&&e.length>0){let t=e.map(e=>e.stored_file_path),a=await (0,f.tm)("/api/delete-files",{method:"POST",body:JSON.stringify({filePaths:t})});if(!a.ok){let e=await a.json();h("部分附件檔案刪除失敗: ".concat(e.error||""),"warning"),console.error("刪除本地檔案失敗:",e)}}let{error:s}=await o.N.from("announcements").delete().eq("id",l);if(s)throw s;h("公告及其所有附件已成功刪除","success"),r&&r(),a()}catch(e){console.error("刪除公告時發生錯誤:",e),h("刪除失敗: ".concat(e.message),"error")}finally{m(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{show:x.show,message:x.message,type:x.type,onClose:()=>p(e=>({...e,show:!1}))}),(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4",onClick:a,children:(0,s.jsxs)(c.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"relative bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-md flex flex-col overflow-hidden border border-white/20",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:(0,s.jsx)("button",{type:"button",className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200/50 transition-colors",onClick:a,disabled:i,children:(0,s.jsx)(k.A,{className:"h-6 w-6"})})}),(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"mx-auto flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(M.A,{className:"w-6 h-6 text-red-600"})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"刪除公告"}),(0,s.jsxs)("p",{className:"text-base text-gray-500 mt-2",children:["您確定要永久刪除這則公告及其所有附件嗎？",(0,s.jsx)("br",{}),"此操作將無法復原。"]})]})]}),(0,s.jsx)("div",{className:"p-4 bg-black/5 flex justify-center",children:(0,s.jsx)("button",{type:"button",onClick:g,disabled:i,className:"flex items-center justify-center gap-1.5 rounded-lg border transition-all duration-300 ease-in-out transform px-3 py-2 text-sm font-semibold border-rose-400 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{size:16,className:"animate-spin"}),(0,s.jsx)("span",{children:"刪除中..."})]}):"確認刪除"})})]})})})]})}var B=a(12486);let R=e=>{let{announcement:t}=e,a=t.application_deadline?new Date(t.application_deadline).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"未指定",n="".concat("https://scholarship.ncuesa.org.tw","/?announcement_id=").concat(t.id),l=new Date().getFullYear(),r=(e=>{if(!e)return[];try{let t=JSON.parse(e);if(Array.isArray(t))return t.filter(e=>e.url&&"string"==typeof e.url)}catch(t){if("string"==typeof e&&e.startsWith("http"))return[{url:e}]}return[]})(t.external_urls),i='\n    <!DOCTYPE html>\n    <html lang="zh-Hant">\n    <head>\n        <meta charset="utf-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>彰師生輔組校外獎助學金資訊平台</title>\n        <style>\n            @import url(\'https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap\');\n            body { margin: 0; padding: 0; background-color: #f4f4f7; font-family: \'Noto Sans TC\', \'Microsoft JhengHei\', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }\n            table { border-collapse: collapse; }\n            .wrapper { background-color: transparent; width: 100%; }\n            .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; }\n            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; text-align: center; }\n            .header h1 { margin: 0; font-size: 26px; font-weight: 700; }\n            .content { padding: 32px 40px; color: #374151; }\n            .content h2 { color: #1f2937; margin-top: 0; margin-bottom: 24px; font-size: 22px; font-weight: 700; text-align: left; }\n            .details-table { width: 100%; margin-bottom: 24px; border-collapse: collapse; }\n            .details-table td { padding: 8px 0; vertical-align: top; font-size: 15px; }\n            .details-table td.label { color: #6b7280; font-weight: 500; width: 80px; padding-right: 16px; }\n            .details-table td.value { color: #1f2937; }\n            .deadline { color: #9333ea; font-weight: 700; }\n            .divider { border: 0; border-top: 1px solid #e5e7eb; margin: 24px 0; }\n            .rich-text-content { font-size: 16px; line-height: 1.7; color: #374151; }\n            .rich-text-content p { margin: 0 0 16px; }\n            .rich-text-content h1, .rich-text-content h2, .rich-text-h3 { font-weight: 700; color: #1f2937; margin-top: 24px; margin-bottom: 12px; }\n            .rich-text-content h1 { font-size: 22px; }\n            .rich-text-content h2 { font-size: 20px; }\n            .rich-text-h3 { font-size: 18px; }\n            .rich-text-content ul, .rich-text-content ol { padding-left: 24px; margin-bottom: 16px; }\n            .rich-text-content li { margin-bottom: 8px; }\n            .rich-text-content table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; border: 1px solid #dee2e6; }\n            .rich-text-content th, .rich-text-content td { border: 1px solid #dee2e6; padding: 12px 15px; text-align: left; vertical-align: top; }\n            .rich-text-content th { background-color: #f8f9fa; font-weight: 600; color: #495057; }\n            .rich-text-content tr:nth-of-type(even) { background-color: #f8f9fa; }\n            .cta-button { display: inline-block; background-color: #7c3aed; color: #ffffff !important; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: 500; }\n            .footer { padding: 24px 40px; font-size: 12px; text-align: center; color: #9ca3af; background-color: #f9fafb; }\n            .footer a { color: #6b7280; text-decoration: none; }\n        </style>\n    </head>\n    <body>\n        <table class="wrapper" border="0" cellpadding="0" cellspacing="0" width="100%">\n            <tr>\n                <td align="center" style="padding: 24px;">\n                    <table class="container" border="0" cellpadding="0" cellspacing="0" width="100%">\n                        <tr><td class="header"><h1>生輔組校外獎助學金資訊平台</h1></td></tr>\n                        <tr>\n                            <td class="content">\n                                <h2>'.concat(t.title,'</h2>\n                                <table class="details-table">\n                                    ').concat(t.category?'<tr><td class="label">類 別</td><td class="value">'.concat(t.category,"</td></tr>"):"","\n                                    ").concat(t.application_deadline?'<tr><td class="label">申請截止</td><td class="value"><span class="deadline">'.concat(a,"</span></td></tr>"):"","\n                                    ").concat(t.target_audience?'<tr><td class="label">適用對象</td><td class="value">'.concat(t.target_audience,"</td></tr>"):"","\n                                    ").concat(t.submission_method?'<tr><td class="label">送件方式</td><td class="value">'.concat(t.submission_method,"</td></tr>"):"",'\n                                </table>\n                                <hr class="divider" />\n                                <div class="rich-text-content">\n                                    <h3>公告摘要</h3>\n                                    ').concat(t.summary||"<p>請至平台查看詳細內容。</p>","\n                                </div>\n                                ").concat((()=>{if(0===r.length)return"";let e=r.map(e=>'<li style="margin-bottom: 8px;">\n                <a href="'.concat(e.url,'" target="_blank" style="color: #7c3aed; text-decoration: none; word-break: break-all;">').concat(e.url,"</a>\n            </li>")).join("");return'\n            <hr class="divider" />\n            <div>\n                <h3 class="rich-text-h3">相關連結</h3>\n                <ul style="list-style-type: none; padding-left: 0; margin-top: 8px;">\n                    '.concat(e,"\n                </ul>\n            </div>\n        ")})(),'\n                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 32px;">\n                                    <tr><td align="center"><a href="').concat(n,'" target="_blank" class="cta-button">前往平台查看完整資訊</a></td></tr>\n                                </table>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="footer">\n                                <p style="margin: 0 0 12px;"><a href="').concat("https://scholarship.ncuesa.org.tw",'" target="_blank">生輔組獎助學金資訊平台</a> • <a href="https://stuaffweb.ncue.edu.tw/" target="_blank">生輔組首頁</a></p>\n                                <p style="margin: 0 0 5px;">\xa9 ').concat(l,' 彰師生輔組校外獎助學金資訊平台. All Rights Reserved.</p>\n                                <p style="margin: 0;">此為系統自動發送之信件，請勿直接回覆。</p>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n        </table>\n    </body>\n    </html>');return(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})},J=e=>{let{announcement:t}=e;if(!t)return(0,s.jsx)("div",{className:"flex justify-center items-center h-full p-4",children:(0,s.jsx)("div",{className:"text-gray-500",children:"無法載入公告內容"})});let a=t.application_start_date?new Date(t.application_start_date).toLocaleDateString("en-CA"):null,n=t.application_end_date?new Date(t.application_end_date).toLocaleDateString("en-CA"):"無期限",l=a?"".concat(a," ~ ").concat(n):n,r="\uD83C\uDF93【分類 ".concat(t.category||"未分類","】 ").concat(t.title||"無標題"),i="\n\n\uD83D\uDCE6 送件方式：\n".concat(t.submission_method||"未指定"),o="\n\n\uD83C\uDFAF 適用對象：\n".concat((e=>e?e.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<li.*?>/gi,"\n✅ ").replace(/<[^>]*>?/gm,"").replace(/[ \t]+/g," ").replace(/\n\s*\n/g,"\n").trim():"")(t.target_audience)||"所有學生"),d="".concat("https://scholarship.ncuesa.org.tw","/?announcement_id=").concat(t.id),c=[r,"\n\n⚠️ 申請期間：\n".concat(l),i,o,"\n\n\uD83D\uDD17 查看詳情：\n".concat(d)].join("");return(0,s.jsx)("div",{className:"flex justify-center items-center h-full w-full p-4 font-sans",children:(0,s.jsx)("div",{className:"bg-white/70 backdrop-blur-lg rounded-xl w-full max-w-sm overflow-hidden shadow-2xl border border-white/30",children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("p",{className:"whitespace-pre-wrap text-sm text-gray-800 break-words",children:c})})})})},V={send:"flex items-center justify-center gap-1.5 rounded-lg border px-3 py-2 text-sm font-semibold transition-all duration-300 ease-in-out transform border-sky-400 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:border-sky-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",line:"flex items-center justify-center gap-1.5 rounded-lg border px-3 py-2 text-sm font-semibold transition-all duration-300 ease-in-out transform border-green-400 bg-transparent text-green-600 hover:bg-green-100 hover:text-green-700 hover:border-green-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-green-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed"};function H(e){let{isOpen:t,type:a,announcement:l,onConfirm:r,onClose:i}=e,[o,m]=(0,n.useState)(!1),x=async()=>{m(!0),await r(),m(!1)};return l?(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-start p-4 pt-16 sm:pt-20 overflow-y-auto",onClick:i,children:(0,s.jsxs)(c.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-4xl flex flex-col max-h-[calc(100vh-120px)] overflow-hidden border border-white/20",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"email"===a?"Email 通知預覽":"LINE 通知預覽"}),(0,s.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 p-2 rounded-full transition-colors",children:(0,s.jsx)(k.A,{size:20})})]}),(0,s.jsxs)("div",{className:"p-6 bg-transparent flex-grow overflow-y-auto",children:["email"===a&&(0,s.jsx)(R,{announcement:l}),"line"===a&&(0,s.jsx)(J,{announcement:l})]}),(0,s.jsx)("div",{className:"p-4 bg-white/60 border-t border-black/10 flex justify-end items-center rounded-b-2xl flex-shrink-0",children:(0,s.jsxs)("button",{type:"button",onClick:x,disabled:o,className:"email"===a?V.send:V.line,children:[o?(0,s.jsx)(N.A,{className:"animate-spin h-4 w-4"}):(0,s.jsx)(B.A,{size:16}),(0,s.jsx)("span",{children:o?"發送中...":"確認並發送 ".concat("email"===a?"Email":"LINE")})]})})]})})}):null}var W=a(10081),Y=a(39881),U=a(58832),G=a(47924),q=a(84616),K=a(66474),Z=a(52278),X=a(42355),Q=a(13052),$=a(12767),ee=a(81640);let et=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,s.jsx)("path",{fill:"#00c300",d:"M12.5,42h23c3.59,0,6.5-2.91,6.5-6.5v-23C42,8.91,39.09,6,35.5,6h-23C8.91,6,6,8.91,6,12.5v23C6,39.09,8.91,42,12.5,42z"}),(0,s.jsx)("path",{fill:"#fff",d:"M37.113,22.417c0-5.865-5.88-10.637-13.107-10.637s-13.108,4.772-13.108,10.637c0,5.258,4.663,9.662,10.962,10.495c0.427,0.092,1.008,0.282,1.155,0.646c0.132,0.331,0.086,0.85,0.042,1.185c0,0-0.153,0.925-0.187,1.122c-0.057,0.331-0.263,1.296,1.135,0.707c1.399-0.589,7.548-4.445,10.298-7.611h-0.001C36.203,26.879,37.113,24.764,37.113,22.417z M18.875,25.907h-2.604c-0.379,0-0.687-0.308-0.687-0.688V20.01c0-0.379,0.308-0.687,0.687-0.687c0.379,0,0.687,0.308,0.687,0.687v4.521h1.917c0.379,0,0.687,0.308,0.687,0.687C19.562,25.598,19.254,25.907,18.875,25.907z M21.568,25.219c0,0.379-0.308,0.688-0.687,0.688s-0.687-0.308-0.687-0.688V20.01c0-0.379,0.308-0.687,0.687-0.687s0.687,0.308,0.687,0.687V25.219z M27.838,25.219c0,0.297-0.188,0.559-0.47,0.652c-0.071,0.024-0.145,0.036-0.218,0.036c-0.215,0-0.42-0.103-0.549-0.275l-2.669-3.635v3.222c0,0.379-0.308,0.688-0.688,0.688c-0.379,0-0.688-0.308-0.688-0.688V20.01c0-0.296,0.189-0.558,0.47-0.652c0.071-0.024,0.144-0.035,0.218-0.035c0.214,0,0.42,0.103,0.549,0.275l2.67,3.635V20.01c0-0.379,0.309-0.687,0.688-0.687c0.379,0,0.687,0.308,0.687,0.687V25.219z M32.052,21.927c0.379,0,0.688,0.308,0.688,0.688c0,0.379-0.308,0.687-0.688,0.687h-1.917v1.23h1.917c0.379,0,0.688,0.308,0.688,0.687c0,0.379-0.309,0.688-0.688,0.688h-2.604c-0.378,0-0.687-0.308-0.687-0.688v-2.603c0-0.001,0-0.001,0-0.001c0,0,0-0.001,0-0.001v-2.601c0-0.001,0-0.001,0-0.002c0-0.379,0.308-0.687,0.687-0.687h2.604c0.379,0,0.688,0.308,0.688,0.687s-0.308,0.687-0.688,0.687h-1.917v1.23H32.052z"})]}),ea=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,s.jsx)("path",{fill:"#4caf50",d:"M45,16.2l-5,2.75l-5,4.75L35,40h7c1.657,0,3-1.343,3-3V16.2z"}),(0,s.jsx)("path",{fill:"#1e88e5",d:"M3,16.2l3.614,1.71L13,23.7V40H6c-1.657,0-3-1.343-3-3V16.2z"}),(0,s.jsx)("polygon",{fill:"#e53935",points:"35,11.2 24,19.45 13,11.2 12,17 13,23.7 24,31.95 35,23.7 36,17"}),(0,s.jsx)("path",{fill:"#c62828",d:"M3,12.298V16.2l10,7.5V11.2L9.876,8.859C9.132,8.301,8.228,8,7.298,8h0C4.924,8,3,9.924,3,12.298z"}),(0,s.jsx)("path",{fill:"#fbc02d",d:"M45,12.298V16.2l-10,7.5V11.2l3.124-2.341C38.868,8.301,39.772,8,40.702,8h0 C43.076,8,45,9.924,45,12.298z"})]}),es=async(e,t)=>{try{t("正在透過 mail 發送公告...","info");let a=await (0,f.tm)("/api/send-announcement",{method:"POST",body:JSON.stringify({announcementId:e})}),s=await a.json();if(!a.ok)throw Error(s.error||"mail 寄送失敗");t(s.message||"公告已成功透過 mail 寄送！","success")}catch(e){t(e.message||"mail 寄送失敗，請稍後再試","error")}},en=async(e,t)=>{try{t("正在透過 LINE 發送公告...","info");let a=await (0,f.tm)("/api/broadcast-line-announcement",{method:"POST",body:JSON.stringify({announcementId:e})}),s=await a.json();if(!a.ok)throw Error(s.error||"LINE 發送失敗");t(s.message||"公告已成功透過 LINE 發送！","success")}catch(e){t(e.message||"LINE 發送失敗，請稍後再試","error")}};var el=a(17580),er=a(75525),ei=a(55670);function eo(e){let{isOpen:t,onClose:a,user:l,onConfirm:r,isSending:i}=e,[o,m]=(0,n.useState)({subject:"",body:""});(0,n.useEffect)(()=>{t&&l&&m({subject:"[重要通知] 主旨",body:"<p>親愛的 ".concat(l.name||"User"," 同學，您好：</p><p>...</p><p>若有任何疑問，歡迎隨時與我們聯繫。<br>彰師大 學務處生輔組 敬上</p>")})},[t,l]);let x=(0,n.useCallback)(e=>{m(t=>({...t,body:e}))},[]),p=new Date().getFullYear(),h='\n    <!DOCTYPE html>\n    <html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>彰師校外獎助學金資訊平台</title>\n    <style>\n        @import url(\'https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap\');\n        body { margin: 0; padding: 0; background-color: transparent; font-family: \'Noto Sans TC\', \'Microsoft JhengHei\', sans-serif; -webkit-font-smoothing: antialiased; }\n        table { border-collapse: collapse; width: 100%; }\n        .container { background-color: #ffffff; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; text-align: center; }\n        .header h1 { margin: 0; font-size: 26px; font-weight: 700; }\n        .content { padding: 32px 40px; color: #374151; }\n        .content h2 { color: #1f2937; margin-top: 0; margin-bottom: 24px; font-size: 22px; font-weight: 700; text-align: left; }\n        .html-body { font-size: 16px; line-height: 1.7; color: #374151; word-break: break-word; }\n        .html-body * { max-width: 100%; }\n        .footer { padding: 24px 40px; font-size: 12px; text-align: center; color: #9ca3af; background-color: #f9fafb; border-top: 1px solid #e5e7eb; }\n        .footer a { color: #6b7280; text-decoration: none; }\n    </style></head><body>\n    <table class="wrapper" border="0" cellpadding="0" cellspacing="0"><tr><td>\n    <table class="container" border="0" cellpadding="0" cellspacing="0">\n        <tr><td class="header"><h1>生輔組校外獎助學金資訊平台</h1></td></tr>\n        <tr><td class="content">\n            <h2>'.concat(o.subject||"(預覽標題)",'</h2>\n            <div class="html-body">').concat(o.body||"(預覽內文)",'</div>\n        </td></tr>\n        <tr><td class="footer">\n            <p style="margin: 0 0 12px;"><a href="').concat("https://scholarship.ncuesa.org.tw",'" target="_blank">生輔組獎助學金資訊平台</a> • <a href="https://stuaffweb.ncue.edu.tw/" target="_blank">生輔組首頁</a></p>\n            <p style="margin: 0 0 5px;">\xa9 ').concat(p,' 彰師生輔組校外獎助學金資訊平台. All Rights Reserved.</p>\n            <p style="margin: 0;">此為系統自動發送之信件，請勿直接回覆。</p>\n        </td></tr>\n    </table></td></tr></table></body></html>');return(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4 pt-16",children:(0,s.jsxs)(c.P.div,{initial:{scale:.95,y:-20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"bg-white/85 backdrop-blur-lg rounded-2xl shadow-2xl w-full max-w-6xl flex flex-col h-[85vh] max-h-[800px] overflow-hidden border border-white/20",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-5 border-b border-black/10 flex justify-between items-center flex-shrink-0",children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-gray-800",children:["寄送通知給 ",null==l?void 0:l.name," ",(0,s.jsxs)("span",{className:"text-gray-500 font-normal text-base",children:["(",null==l?void 0:l.email,")"]})]}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 p-2 rounded-full transition-colors",children:(0,s.jsx)(k.A,{size:20})})]}),(0,s.jsxs)("div",{className:"p-6 flex flex-col gap-6 flex-1 overflow-y-auto min-h-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"subject",className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"標題"}),(0,s.jsx)("input",{id:"subject",type:"text",name:"subject",value:o.subject,onChange:e=>{let{name:t,value:a}=e.target;m(e=>({...e,[t]:a}))},className:"w-full px-4 py-2 bg-white/70 border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 flex-1 min-h-0",children:[(0,s.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,s.jsx)("label",{htmlFor:"body",className:"block text-sm font-semibold text-gray-700 mb-1.5 flex-shrink-0",children:"郵件內文"}),(0,s.jsx)("div",{className:"relative flex-grow h-full",children:(0,s.jsx)(g,{value:o.body,onChange:x,disabled:i,init:{height:"100%",menubar:!0,plugins:"lists link image table code help wordcount",toolbar:"undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image | code"}})})]}),(0,s.jsx)("div",{className:"rounded-lg overflow-y-auto h-full",children:(0,s.jsx)("iframe",{srcDoc:h,className:"w-full h-full border-0 rounded-md",title:"Email Preview"})})]})]}),(0,s.jsx)("div",{className:"p-4 bg-black/5 flex justify-end space-x-3 rounded-b-2xl flex-shrink-0",children:(0,s.jsxs)("button",{type:"button",onClick:()=>{r({subject:o.subject,htmlContent:o.body})},disabled:i,className:"flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg border border-sky-400 bg-transparent text-sky-600 transition-all duration-300 ease-in-out transform whitespace-nowrap hover:bg-sky-100 hover:text-sky-700 hover:border-sky-400 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20 disabled:bg-slate-100 disabled:text-slate-500 disabled:border-slate-200 disabled:transform-none disabled:shadow-none disabled:cursor-not-allowed",children:[i?(0,s.jsx)(N.A,{size:16,className:"animate-spin"}):(0,s.jsx)(B.A,{size:16}),(0,s.jsx)("span",{children:i?"寄送中...":"確認並發送 Email"})]})})]})})})}let ed=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"16",height:"16",viewBox:"0 0 50 50",className:"inline-block",children:[(0,s.jsx)("path",{fill:"#4caf50",d:"M45,16.2l-5,2.75l-5,4.75L35,40h7c1.657,0,3-1.343,3-3V16.2z"}),(0,s.jsx)("path",{fill:"#1e88e5",d:"M3,16.2l3.614,1.71L13,23.7V40H6c-1.657,0-3-1.343-3-3V16.2z"}),(0,s.jsx)("polygon",{fill:"#e53935",points:"35,11.2 24,19.45 13,11.2 12,17 13,23.7 24,31.95 35,23.7 36,17"}),(0,s.jsx)("path",{fill:"#c62828",d:"M3,12.298V16.2l10,7.5V11.2L9.876,8.859C9.132,8.301,8.228,8,7.298,8h0C4.924,8,3,9.924,3,12.298z"}),(0,s.jsx)("path",{fill:"#fbc02d",d:"M45,12.298V16.2l-10,7.5V11.2l3.124-2.341C38.868,8.301,39.772,8,40.702,8h0 C43.076,8,45,9.924,45,12.298z"})]});var ec=a(92138),em=a(85604),ex=a(57434),ep=a(5040);let eh=e=>{let{type:t="link",href:a,copyText:l,icon:r,title:i,children:o,color:d="indigo"}=e,[c,m]=n.useState(!1),x={indigo:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(165,180,252,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(251,146,180,0.4),_transparent_60%)]",iconBg:"bg-indigo-100",iconText:"text-indigo-600",linkText:"text-indigo-600"},rose:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(251,113,133,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(252,211,77,0.4),_transparent_60%)]",iconBg:"bg-rose-100",iconText:"text-rose-600",linkText:"text-rose-600"},teal:{gradientStart:"bg-[radial-gradient(circle_at_center,_rgba(134,239,172,0.4),_transparent_60%)]",gradientEnd:"bg-[radial-gradient(circle_at_center,_rgba(110,231,183,0.4),_transparent_60%)]",iconBg:"bg-teal-100",iconText:"text-teal-600",buttonBg:"bg-teal-600",buttonHoverBg:"hover:bg-teal-700"}},p=x[d]||x.indigo,h=e=>{e.preventDefault();let t=document.createElement("textarea");t.value=l,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("無法複製內容: ",e)}document.body.removeChild(t)},g=()=>(0,s.jsxs)("div",{className:"relative h-full overflow-hidden rounded-xl border border-gray-200/80 bg-white p-6 shadow-lg transition-all duration-300 ease-in-out hover:shadow-2xl hover:-translate-y-1.5",children:[(0,s.jsx)("div",{className:"absolute -top-24 -left-24 h-72 w-72 rounded-full ".concat(p.gradientStart," opacity-0 transition-all duration-700 ease-in-out group-hover:top-[-4rem] group-hover:left-[-4rem] group-hover:opacity-100 blur-2xl")}),(0,s.jsx)("div",{className:"absolute -bottom-24 -right-24 h-72 w-72 rounded-full ".concat(p.gradientEnd," opacity-0 transition-all duration-700 ease-in-out group-hover:bottom-[-4rem] group-hover:right-[-4rem] group-hover:opacity-100 blur-2xl")}),(0,s.jsxs)("div",{className:"relative z-10 flex h-full flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 rounded-lg p-3 ".concat(p.iconBg),children:(0,s.jsx)(r,{className:"h-6 w-6 ".concat(p.iconText)})}),(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:i})]}),(0,s.jsx)("p",{className:"mt-4 flex-grow text-sm text-gray-500",children:o}),"link"===t&&(0,s.jsxs)("div",{className:"mt-6 flex items-center justify-end text-sm font-semibold ".concat(p.linkText),children:[(0,s.jsx)("span",{children:"前往連結"}),(0,s.jsx)(ec.A,{className:"ml-2 h-4 w-4 transition-transform duration-300 ease-in-out group-hover:translate-x-1"})]}),"copy"===t&&(0,s.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,s.jsxs)("button",{onClick:h,className:"flex items-center justify-center rounded-md px-4 py-2 text-sm font-semibold transition-colors duration-200 ".concat(c?"bg-green-500 text-white":"".concat(p.buttonBg," text-white ").concat(p.buttonHoverBg)),children:[(0,s.jsx)(em.A,{className:"h-4 w-4 mr-2"}),c?"已複製！":"複製模板"]})})]})]});return"link"===t?(0,s.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group block",children:(0,s.jsx)(g,{})}):(0,s.jsx)("div",{className:"group block",children:(0,s.jsx)(g,{})})};var eg=a(381),eu=a(3096);let eb=[{id:"announcements",label:"公告管理",icon:ex.A,component:(0,s.jsx)(function(){let[e,t]=(0,n.useState)(null),[a,l]=(0,n.useState)([]),[r,i]=(0,n.useState)(!0),[m,x]=(0,n.useState)(!1),[p,h]=(0,n.useState)(null),[g,u]=(0,n.useState)(null),[f,y]=(0,n.useState)({show:!1,message:"",type:"success"}),[v,j]=(0,n.useState)({open:!1,type:"",html:"",text:"",id:null}),[w,N]=(0,n.useState)(""),[_,k]=(0,n.useState)({column:"application_end_date",direction:"desc"}),[C,A]=(0,n.useState)(1),[S,z]=(0,n.useState)(10),D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return y({show:!0,message:e,type:t})},T=(0,n.useCallback)(async()=>{i(!0);try{let{data:e,error:t}=await o.N.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;l(e||[])}catch(e){D("無法載入公告列表，請稍後再試","error")}finally{i(!1)}},[]);(0,n.useEffect)(()=>{T()},[T]);let E=(0,n.useMemo)(()=>{let e=[...a];if(w){let t=w.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t)||e.category&&e.category.toLowerCase().includes(t))}return _.column&&e.sort((e,t)=>{let a=e[_.column],s=t[_.column];return a<s?"asc"===_.direction?-1:1:a>s?"asc"===_.direction?1:-1:0}),e},[a,w,_]),O=(0,n.useMemo)(()=>{let e=(C-1)*S;return E.slice(e,e+S)},[E,C,S]),P=Math.ceil(E.length/S),M=e=>{k(t=>({column:e,direction:t.column===e&&"desc"===t.direction?"asc":"desc"})),A(1)},B=e=>_.column!==e?(0,s.jsx)(W.A,{className:"h-4 w-4 ml-1 text-gray-400"}):"asc"===_.direction?(0,s.jsx)(Y.A,{className:"h-4 w-4 ml-1 text-indigo-600"}):(0,s.jsx)(U.A,{className:"h-4 w-4 ml-1 text-indigo-600"}),R=(e,t)=>{j({open:!0,type:e,announcement:t,id:t.id})},J=async()=>{"email"===v.type?await es(v.id,D):"line"===v.type&&await en(v.id,D),j(e=>({...e,open:!1}))},V=async e=>{let t="".concat("https://scholarship.ncuesa.org.tw","/?announcement_id=").concat(e);try{await navigator.clipboard.writeText(t),D("公告連結已成功複製！","success")}catch(e){D("複製連結失敗","error")}},el="flex items-center justify-center gap-1.5 rounded-lg border transition-all duration-300 ease-in-out transform disabled:transform-none disabled:shadow-none",er={add:"".concat(el," px-4 py-2 text-sm font-semibold border-indigo-200 text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/40"),edit:"".concat(el," px-3 py-1.5 text-xs font-semibold border-indigo-200 bg-transparent text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20"),delete:"".concat(el," px-3 py-1.5 text-xs font-semibold border-rose-200 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20"),send:"".concat(el," px-3 py-1.5 text-xs font-semibold border-sky-200 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20"),line:"".concat(el," px-3 py-1.5 text-xs font-semibold border-green-200 bg-transparent text-green-600 hover:bg-green-100 hover:text-green-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-green-500/20"),link:"".concat(el," px-3 py-1.5 text-xs font-semibold border-amber-200 bg-transparent text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-amber-500/20"),download:"".concat(el," px-3 py-1.5 text-xs font-semibold border-stone-300 bg-transparent text-stone-700 hover:bg-stone-200 hover:text-stone-800 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-stone-500/20")};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative w-full flex-grow",children:[(0,s.jsx)(G.A,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"搜尋標題、分類...",value:w,onChange:e=>{N(e.target.value),A(1)},className:"w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,s.jsxs)("button",{onClick:()=>x(!0),className:"".concat(er.add," w-full sm:w-auto whitespace-nowrap"),children:[(0,s.jsx)(q.A,{size:16})," 新增公告"]})]}),(0,s.jsxs)("div",{className:"rounded-xl w-full bg-white shadow-lg overflow-hidden border border-gray-200/80",children:[(0,s.jsx)("div",{className:"hidden md:block",children:(0,s.jsxs)("table",{className:"w-full text-sm table-layout-fixed",children:[(0,s.jsx)("thead",{className:"bg-gray-50/70 text-left",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"標題"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 w-24",children:"分類"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 cursor-pointer w-36",onClick:()=>M("application_end_date"),children:(0,s.jsxs)("div",{className:"flex items-center",children:["申請截止日 ",B("application_end_date")]})}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 w-28",children:"狀態"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 cursor-pointer w-36",onClick:()=>M("updated_at"),children:(0,s.jsxs)("div",{className:"flex items-center",children:["最後更新 ",B("updated_at")]})}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 text-center w-48",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-100",children:r?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"6",className:"text-center p-12 text-gray-500",children:"載入中..."})}):0===O.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"6",className:"text-center p-12 text-gray-500",children:"找不到符合條件的公告。"})}):O.map(e=>(0,s.jsxs)("tr",{className:"transform transition-all duration-300 hover:bg-violet-100/50 hover:shadow-xl z-0 hover:z-10 hover:scale-[1.02]",children:[(0,s.jsx)("td",{className:"p-4 px-6 font-medium text-gray-800 break-words",children:e.title}),(0,s.jsx)("td",{className:"p-4 px-6 text-gray-600",children:e.category}),(0,s.jsx)("td",{className:"p-4 px-6 text-gray-600 font-medium",children:e.application_end_date?new Date(e.application_end_date).toLocaleDateString("en-CA"):"無期限"}),(0,s.jsx)("td",{className:"p-4 px-6",children:(0,s.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_active?"上架":"下架"})}),(0,s.jsx)("td",{className:"p-4 px-6 text-gray-600",children:new Date(e.updated_at).toLocaleDateString()}),(0,s.jsx)("td",{className:"p-4 px-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,s.jsx)("button",{onClick:()=>h(e),className:"".concat(er.edit," whitespace-nowrap"),children:"編輯"}),(0,s.jsx)("button",{onClick:()=>u(e.id),className:"".concat(er.delete," whitespace-nowrap"),children:"刪除"}),(0,s.jsx)("button",{onClick:()=>V(e.id),className:"".concat(er.link," whitespace-nowrap"),children:"連結"}),(0,s.jsx)(ee.A,{announcement:e,className:er.download}),(0,s.jsx)("button",{onClick:()=>R("line",e),className:er.line,children:(0,s.jsx)(et,{})}),(0,s.jsx)("button",{onClick:()=>R("email",e),className:er.send,children:(0,s.jsx)(ea,{})})]})})]},e.id))})]})}),(0,s.jsx)("div",{className:"md:hidden px-2 py-4 flex flex-col gap-3",children:r?(0,s.jsx)("div",{className:"text-center p-8 text-gray-500",children:"載入中..."}):0===O.length?(0,s.jsx)("div",{className:"text-center p-8 text-gray-500",children:"找不到符合條件的公告。"}):O.map(a=>{let n=e===a.id;return(0,s.jsxs)("div",{className:"bg-white rounded-lg transition-all duration-300\n                                        ".concat(n?"shadow-lg ring-2 ring-indigo-500 ring-offset-2":"shadow-md border border-gray-200/80","\n                                    "),children:[(0,s.jsxs)("button",{onClick:()=>t(n?null:a.id),className:"w-full flex items-center justify-between text-left p-4",children:[(0,s.jsx)("div",{className:"flex-1 pr-4",children:(0,s.jsx)("h3",{className:"font-bold text-base text-gray-900",children:a.title})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-3 flex-shrink-0",children:[(0,s.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full ".concat(a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.is_active?"上架":"下架"}),(0,s.jsx)(K.A,{className:"h-5 w-5 text-gray-400 transition-transform duration-300 ".concat(n?"rotate-180":"")})]})]}),(0,s.jsx)(d.N,{children:n&&(0,s.jsx)(c.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,s.jsxs)("div",{className:"border-t border-gray-200 p-4 pt-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-[auto_1fr] gap-x-4 gap-y-2 text-sm mb-4",children:[(0,s.jsx)("div",{className:"font-semibold text-gray-500",children:"分類"}),(0,s.jsx)("div",{className:"text-gray-700",children:a.category||"-"}),(0,s.jsx)("div",{className:"font-semibold text-gray-500",children:"申請截止"}),(0,s.jsx)("div",{className:"text-gray-700",children:a.application_end_date?new Date(a.application_end_date).toLocaleDateString("en-CA"):"無期限"}),(0,s.jsx)("div",{className:"font-semibold text-gray-500",children:"最後更新"}),(0,s.jsx)("div",{className:"text-gray-700",children:new Date(a.updated_at).toLocaleDateString()})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-2 border-t border-gray-200",children:[(0,s.jsx)("button",{onClick:()=>h(a),className:"".concat(er.edit," whitespace-nowrap"),children:"編輯"}),(0,s.jsx)("button",{onClick:()=>u(a.id),className:"".concat(er.delete," whitespace-nowrap"),children:"刪除"}),(0,s.jsx)("button",{onClick:()=>V(a.id),className:"".concat(er.link," whitespace-nowrap"),children:"連結"}),(0,s.jsx)(ee.A,{announcement:a,className:er.download}),(0,s.jsx)("button",{onClick:()=>R("line",a),className:er.line,children:(0,s.jsx)(et,{})}),(0,s.jsx)("button",{onClick:()=>R("email",a),className:er.send,children:(0,s.jsx)(ea,{})})]})]})},"content")})]},a.id)})})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",E.length," 筆資料，第 ",C," / ",P||1," 頁"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("select",{value:S,onChange:e=>{z(Number(e.target.value)),A(1)},className:"appearance-none w-full bg-white border border-gray-300 rounded-lg py-2 pl-4 pr-10 text-sm shadow-sm transition-all duration-300 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/30",children:[10,25,50].map(e=>(0,s.jsxs)("option",{value:e,children:[e," 筆 / 頁"]},e))}),(0,s.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400",children:(0,s.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,s.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[(0,s.jsx)("button",{onClick:()=>A(1),disabled:1===C,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(Z.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>A(e=>e-1),disabled:1===C,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(X.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>A(e=>e+1),disabled:C===P||0===P,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(Q.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>A(P),disabled:C===P||0===P,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)($.A,{className:"h-5 w-5"})})]})]})]}),(0,s.jsx)(F,{isOpen:m,onClose:()=>x(!1),refreshAnnouncements:T}),(0,s.jsx)(I,{isOpen:!!p,onClose:()=>h(null),announcement:p,refreshAnnouncements:T}),(0,s.jsx)(L,{isOpen:!!g,onClose:()=>u(null),announcementId:g,refreshAnnouncements:T}),(0,s.jsx)(H,{isOpen:v.open,type:v.type,announcement:v.announcement,onConfirm:J,onClose:()=>j(e=>({...e,open:!1}))}),(0,s.jsx)(b.A,{show:f.show,message:f.message,type:f.type,onClose:()=>y(e=>({...e,show:!1}))})]})},{})},{id:"users",label:"使用者管理",icon:el.A,component:(0,s.jsx)(function(){let{user:e}=(0,i.A)(),[t,a]=(0,n.useState)([]),[l,r]=(0,n.useState)(!0),[o,d]=(0,n.useState)({show:!1,message:"",type:"success"}),[c,m]=(0,n.useState)(""),[x,p]=(0,n.useState)(1),[h,g]=(0,n.useState)(10),[u,y]=(0,n.useState)(!1),[v,j]=(0,n.useState)(null),[w,_]=(0,n.useState)(!1),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return d({show:!0,message:e,type:t})},C=(0,n.useCallback)(async()=>{r(!0);try{let e=await (0,f.tm)("/api/users"),t=await e.json();e.ok?a(Array.isArray(t.users)?t.users:[]):(k(t.error||"獲取用戶資料失敗","error"),a([]))}catch(e){k("獲取用戶資料時發生錯誤","error"),a([])}finally{r(!1)}},[]);(0,n.useEffect)(()=>{C()},[C]);let A=async t=>{if(e&&t.id===e.id)return void k("無法變更自己的權限","error");let a="admin"===t.role?"user":"admin";if(confirm("確定要將使用者 ".concat(t.name," 的權限變更為「").concat(a,"」嗎？")))try{let e=await (0,f.tm)("/api/users/".concat(t.id),{method:"PUT",body:JSON.stringify({role:a})}),s=await e.json();e.ok?(k("使用者權限更新成功","success"),C()):k(s.error||"更新失敗","error")}catch(e){k("更新時發生錯誤","error")}},S=e=>{j(e),y(!0)},z=async e=>{let{subject:t,htmlContent:a}=e;if(!t||!a)return void k("標題和內文為必填欄位","error");if(!v)return void k("未指定收件人","error");_(!0);try{let e={email:v.emailFull,subject:t,body:a},s=await (0,f.tm)("/api/send-custom-email",{method:"POST",body:JSON.stringify(e)}),n=await s.json();s.ok?(k(n.message||"通知已成功寄送！","success"),y(!1)):k(n.error||"寄送失敗，請稍後再試","error")}catch(e){console.error("Error sending custom email:",e),k("寄送時發生網路或未知錯誤","error")}finally{_(!1)}},D=(0,n.useMemo)(()=>{if(!Array.isArray(t))return[];let e=[...t];if(c){let t=c.toLowerCase();e=e.filter(e=>{var a,s,n;return((null==(a=e.name)?void 0:a.toLowerCase())||"").includes(t)||((null==(s=e.studentId)?void 0:s.toLowerCase())||"").includes(t)||((null==(n=e.email)?void 0:n.toLowerCase())||"").includes(t)})}return e},[t,c]),F=(0,n.useMemo)(()=>D.slice((x-1)*h,x*h),[D,x,h]),T=Math.ceil(D.length/h),E=(0,n.useMemo)(()=>({total:t.length,admins:t.filter(e=>"admin"===e.role).length,users:t.filter(e=>"user"===e.role).length}),[t]),O="flex items-center justify-center gap-1.5 px-3 py-1.5 text-xs font-semibold rounded-lg border transition-all duration-300 ease-in-out transform disabled:transform-none disabled:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",P={demote:"".concat(O," border-indigo-200 bg-transparent text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/20 whitespace-nowrap"),promote:"".concat(O," border-rose-200 bg-transparent text-rose-600 hover:bg-rose-100 hover:text-rose-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-rose-500/20 whitespace-nowrap"),notify:"".concat(O," p-2 border-sky-200 bg-transparent text-sky-600 hover:bg-sky-100 hover:text-sky-700 hover:-translate-y-0.5 hover:scale-105 hover:shadow-lg hover:shadow-sky-500/20")};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 lg:items-center",children:[(0,s.jsxs)("div",{className:"lg:col-span-3 relative",children:[(0,s.jsx)(G.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"搜尋姓名、學號、信箱...",value:c,onChange:e=>{m(e.target.value),p(1)},className:"w-full pl-11 pr-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm transition-all duration-300 focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/30"})]}),(0,s.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-3 gap-4 text-center bg-white p-3 rounded-xl border border-gray-200/80",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,s.jsx)(el.A,{size:14}),"總用戶數"]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:E.total})]}),(0,s.jsxs)("div",{className:"border-l border-gray-200",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,s.jsx)(er.A,{size:14}),"管理員"]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:E.admins})]}),(0,s.jsxs)("div",{className:"border-l border-gray-200",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-500 flex items-center justify-center gap-1.5",children:[(0,s.jsx)(ei.A,{size:14}),"使用者"]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-600 mt-1",children:E.users})]})]})]}),(0,s.jsxs)("div",{className:"rounded-xl w-full bg-white shadow-lg overflow-hidden border border-gray-200/80",children:[(0,s.jsx)("div",{className:"hidden md:block",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50/70 text-left",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"學號"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"姓名"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"電子信箱"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500",children:"權限"}),(0,s.jsx)("th",{className:"p-4 px-6 font-semibold text-gray-500 text-center",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-100",children:l?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"5",className:"text-center p-12",children:(0,s.jsx)(N.A,{className:"h-6 w-6 animate-spin mx-auto"})})}):0===F.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"5",className:"text-center p-12 text-gray-500",children:"找不到符合條件的使用者。"})}):F.map(t=>(0,s.jsxs)("tr",{className:"transform transition-all duration-300 hover:bg-violet-100/50 hover:shadow-xl z-0 hover:z-10 hover:scale-[1.02]",children:[(0,s.jsx)("td",{className:"p-4 px-6 font-mono",children:t.studentId||"-"}),(0,s.jsx)("td",{className:"p-4 px-6 font-medium text-gray-800",children:t.name||"-"}),(0,s.jsx)("td",{className:"p-4 px-6 text-gray-600",title:t.emailFull,children:t.email}),(0,s.jsx)("td",{className:"p-4 px-6",children:(0,s.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full ".concat("admin"===t.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:"admin"===t.role?"管理員":"使用者"})}),(0,s.jsx)("td",{className:"p-4 px-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>A(t),className:"admin"===t.role?P.demote:P.promote,disabled:(null==e?void 0:e.id)===t.id,children:"admin"===t.role?"設為使用者":"設為管理員"}),(0,s.jsx)("button",{onClick:()=>S(t),className:P.notify,title:"寄送通知",children:(0,s.jsx)(ed,{})})]})})]},t.id))})]})}),(0,s.jsx)("div",{className:"md:hidden divide-y divide-gray-100",children:l?(0,s.jsx)("div",{className:"text-center p-8",children:(0,s.jsx)(N.A,{className:"h-6 w-6 animate-spin mx-auto"})}):0===F.length?(0,s.jsx)("div",{className:"text-center p-8 text-gray-500",children:"找不到符合條件的使用者。"}):F.map(t=>(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h3",{className:"font-bold text-base text-gray-900 flex-1 pr-4",children:t.name||"-"}),(0,s.jsx)("span",{className:"px-2.5 py-1 text-xs font-semibold rounded-full flex-shrink-0 ".concat("admin"===t.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:"admin"===t.role?"管理員":"使用者"})]}),(0,s.jsxs)("div",{className:"text-sm space-y-2 text-gray-600 border-t pt-3",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"font-semibold text-gray-800",children:"學號: "}),t.studentId||"-"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"font-semibold text-gray-800",children:"信箱: "}),t.email]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end border-t pt-3 gap-2",children:[(0,s.jsx)("button",{onClick:()=>A(t),className:"admin"===t.role?P.demote:P.promote,disabled:(null==e?void 0:e.id)===t.id,children:"admin"===t.role?"設為使用者":"設為管理員"}),(0,s.jsx)("button",{onClick:()=>S(t),className:P.notify,title:"寄送通知",children:(0,s.jsx)(ed,{})})]})]},t.id))})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",D.length," 筆資料，第 ",x," / ",T||1," 頁"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("select",{value:h,onChange:e=>{g(Number(e.target.value)),p(1)},className:"appearance-none w-full bg-white border border-gray-300 rounded-lg py-2 pl-4 pr-10 text-sm shadow-sm transition-all duration-300 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/30",children:[(0,s.jsx)("option",{value:10,children:"10 筆 / 頁"}),(0,s.jsx)("option",{value:25,children:"25 筆 / 頁"}),(0,s.jsx)("option",{value:50,children:"50 筆 / 頁"})]}),(0,s.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400",children:(0,s.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,s.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm",children:[(0,s.jsx)("button",{onClick:()=>p(1),disabled:1===x,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(Z.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>p(e=>e-1),disabled:1===x,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(X.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>p(e=>e+1),disabled:x===T||0===T,className:"relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)(Q.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>p(T),disabled:x===T||0===T,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 disabled:opacity-50",children:(0,s.jsx)($.A,{className:"h-5 w-5"})})]})]})]}),(0,s.jsx)(eo,{isOpen:u,onClose:()=>y(!1),user:v,onConfirm:z,isSending:w}),(0,s.jsx)(b.A,{show:o.show,message:o.message,type:o.type,onClose:()=>d(e=>({...e,show:!1}))})]})},{})},{id:"usage",label:"相關連結",icon:eg.A,component:(0,s.jsx)(function(){let e=[{type:"link",href:"https://docs.google.com/spreadsheets/d/1XMRRNO1e_fSk-LU84K68EGiOAidaRDVp8yBlmL0G_D8/edit?resourcekey=&gid=204496218#gid=204496218",icon:ex.A,title:"校外獎助學金送件紀錄 資料表",color:"indigo",children:"承辦人員、工讀生可透過此連結進入<strong>已連結回應表單之 Google Sheet</strong>。"},{type:"link",href:"https://docs.google.com/document/d/1ZI_vUtdQ2ushBS0C9viS1yZWzSkFEgvZ79NEJCmvptU/edit?usp=sharing",icon:ep.A,title:"平台使用說明",color:"rose",children:"關於本平台的相關注意事項，內容包含<strong>開發人員</strong>、<strong>管理員</strong>、<strong>一般使用者</strong> 三種身分的使用說明。"},{type:"copy",icon:em.A,title:"請求提供正確個資信件模板",copyText:'<p>親愛的 xxx[請自行修改] 同學，您好：</p>\n<p>為了 <strong><span style="color: #3598db;">平台身分識別</span></strong> 及 <strong><span style="color: #3598db;">訊息推播用途</span></strong><span style="color: #000000;">，請透過 <span style="color: #843fa1;"><a style="color: #843fa1;" href="profile" target="_blank" rel="noopener">連結</a></span>&nbsp;進入平台，將帳號改為 <strong>真實姓名</strong> 及 <strong>真實學號 </strong>方可繼續使用此平台，否則該帳號將於 <span style="color: #e03e2d;"><strong>2025/08/24 00:00:00[請自行修改，設為一週後]</strong></span> 進入封禁狀態，並不再允許註冊。</span></p>\n<p><span style="color: #000000;">請放心，您的個資接存放於後端加密資料庫，外界無法存取，詳見 <a href="terms-and-privacy" target="_blank" rel="noopener"><span style="color: #843fa1;">服務條款</span></a>&nbsp;或 <span style="color: #843fa1;"><a style="color: #843fa1;" href="https://docs.google.com/document/d/1ZI_vUtdQ2ushBS0C9viS1yZWzSkFEgvZ79NEJCmvptU/edit?usp=sharing">使用說明</a></span> 。</span></p>\n<hr>\n<p>若有任何疑問，歡迎隨時<span style="color: #843fa1;"><a style="color: #843fa1;" href="mailto:3526ming@gmail.com" target="_blank" rel="noopener">與我聯繫</a></span></p>\n<p>生輔組獎學金資訊系統開發 &amp; 維護者</p>\n<p>陳泰銘 敬上</p>',color:"teal",children:"請到使用者管理>寄送郵件>進入Tiny MCE 編輯框>點選工具>點選原始程式碼，貼上並編輯，即可寄出。"}];return(0,s.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center p-4 sm:p-6 lg:p-8",children:(0,s.jsx)("div",{className:"w-full max-w-6xl",children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3",children:e.map((e,t)=>(0,s.jsx)(eh,{...e,children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.children}})},t))})})})},{})}],ef=e=>{let{activeTab:t,onTabClick:a,isOverDark:l=!1}=e,r=(0,n.useRef)([]),i=r.current[eb.findIndex(e=>e.id===t)];return(0,s.jsxs)("nav",{className:"relative grid grid-cols-3 items-center p-1 gap-1 rounded-full shadow-inner transition-colors duration-300 backdrop-blur-xl overflow-hidden\n            ".concat(l?"bg-white/15":"bg-black/[0.04]","\n        "),children:[(0,s.jsx)(c.P.span,{className:"absolute top-1 bottom-1 rounded-full bg-purple-300/20",layoutId:"bubble",initial:!1,animate:{x:null==i?void 0:i.offsetLeft,width:null==i?void 0:i.offsetWidth},transition:{type:"spring",bounce:.2,duration:.6}}),eb.map((e,n)=>(0,s.jsxs)("button",{ref:e=>r.current[n]=e,onClick:()=>a(e.id),className:"\n                        relative z-10 flex items-center justify-center gap-2 whitespace-nowrap\n                        h-10 py-2.5 px-3 sm:px-4\n                        font-medium text-sm transition-colors duration-300 rounded-full\n                        focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-500\n                        ".concat(t===e.id?l?"text-purple-300 font-semibold":"text-purple-700 font-semibold":l?"text-white hover:text-gray-200":"text-gray-800 hover:text-black","\n                    "),children:[(0,s.jsx)(e.icon,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:e.label})]},e.id))]})};function ey(){var e,t;let{isAuthenticated:a,isAdmin:o,loading:d}=(0,i.A)(),m=(0,r.useRouter)(),x=(0,r.useSearchParams)(),[p,h]=(0,n.useState)(x.get("tab")||"announcements"),{ref:g,inView:u}=(0,eu.Wx)({threshold:.5}),b=(0,n.useContext)(l.B),f=null==(t=null==b?void 0:b.isHeaderVisible)||t,[y,v]=(0,n.useState)(!1),j=(0,n.useRef)(null),w=(0,n.useCallback)(()=>{if(!j.current||u)return;let e=j.current.getBoundingClientRect(),t=[{x:e.left+1,y:e.top+1},{x:e.left+e.width/2,y:e.top+e.height/2},{x:e.right-1,y:e.bottom-1}],a=0;for(let e of t)for(let t of document.elementsFromPoint(e.x,e.y))if(!j.current.contains(t)){(function(e){if(!e||"transparent"===e||e.startsWith("rgba(")&&e.endsWith(", 0)"))return!1;let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return!!t&&(.299*t[1]+.587*t[2]+.114*t[3])/255<.5})(window.getComputedStyle(t).backgroundColor)&&a++;break}v(a>=2)},[u]);(0,n.useEffect)(()=>{let e,t=function(){for(var t=arguments.length,a=Array(t),s=0;s<t;s++)a[s]=arguments[s];e||(w.apply(this,a),e=!0,setTimeout(()=>e=!1,100))};return t(),window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[w]);let _=e=>{h(e),m.push("/manage?tab=".concat(e),{scroll:!1})};if(d||!a||!o)return(0,s.jsx)("div",{className:"w-full flex items-center justify-center py-24",children:(0,s.jsx)(N.A,{className:"h-12 w-12 text-indigo-600 animate-spin"})});let k=(null==(e=eb.find(e=>e.id===p))?void 0:e.component)||null;return(0,s.jsxs)("div",{className:"w-full bg-white min-h-screen",children:[(0,s.jsx)(c.P.div,{ref:j,className:"fixed top-0 left-0 w-full z-40 px-4 pointer-events-none",initial:{y:"-150%",opacity:0},animate:{y:u?"-150%":f?"88px":"20px",opacity:+!u},transition:{type:"spring",stiffness:300,damping:30},children:(0,s.jsx)("div",{className:"max-w-sm sm:max-w-md mx-auto pointer-events-auto",children:(0,s.jsx)(ef,{activeTab:p,onTabClick:_,isOverDark:y})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("header",{className:"py-12 text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold tracking-tight text-gray-900",children:"管理後台"}),(0,s.jsx)("p",{className:"mt-3 text-lg text-gray-500",children:"在這裡你可以針對 彰師生輔組 —— 校外獎助學金資訊平台的所有公告、使用者進行相關操作。"})]}),(0,s.jsx)("div",{ref:g,className:"flex justify-center mb-10 w-full max-w-md mx-auto sm:max-w-none",children:(0,s.jsx)(ef,{activeTab:p,onTabClick:_,isOverDark:!1})}),(0,s.jsx)("main",{className:"pb-12",children:k})]})]})}function ev(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"w-full flex items-center justify-center py-24",children:(0,s.jsx)(N.A,{className:"h-12 w-12 text-indigo-600 animate-spin"})}),children:(0,s.jsx)(ey,{})})}},10271:(e,t,a)=>{Promise.resolve().then(a.bind(a,1909))},77604:(e,t,a)=>{"use strict";a.d(t,{A:()=>m});var s=a(95155),n=a(12115),l=a(60760),r=a(38274),i=a(40646),o=a(1243),d=a(81284),c=a(54416);let m=e=>{let{show:t,message:a,type:m="success",onClose:x}=e;n.useEffect(()=>{if(t){let e=setTimeout(()=>x(),5e3);return()=>clearTimeout(e)}},[t,x]);let p={success:{icon:(0,s.jsx)(i.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,s.jsx)(o.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,s.jsx)(d.A,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},h=p[m]||p.info;return(0,s.jsx)(l.N,{children:t&&(0,s.jsx)(r.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,s.jsxs)("div",{className:"flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ".concat(h.style),children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:h.icon}),(0,s.jsx)("div",{className:"ml-3 flex-1",children:(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:a})}),(0,s.jsx)("button",{onClick:x,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,s.jsx)(c.A,{className:"w-5 h-5"})})]})})})}},92531:(e,t,a)=>{"use strict";a.d(t,{tm:()=>r});var s=a(45749);async function n(){try{let{data:{session:e}}=await s.N.auth.getSession();return(null==e?void 0:e.access_token)||null}catch(e){return console.error("Error getting current token:",e),null}}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await n(),a={...e.headers};return a["Content-Type"]||a["content-type"]||e.body instanceof FormData||(a["Content-Type"]="application/json"),t&&(a.Authorization="Bearer ".concat(t)),{...e,headers:a}}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,await l(t))}}},e=>{e.O(0,[4792,8247,9788,1746,4436,4677,1658,6874,6766,3093,1452,6392,2514,8441,5964,7358],()=>e(e.s=10271)),_N_E=e.O()}]);