(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{1243:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},25215:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=s(51030).A},28883:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},32919:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},40646:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},45749:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var r=s(55647);let a="https://scholarship-api.ncuesa.org.tw",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU0NDA5NjAwLCJleHAiOjE5MTIxNzYwMDB9.jqoKh3OJbr8hsKd1CTuz6UcEPGuzO_gZEL9HT67q_GY";if(!a||!l)throw console.error("Supabase configuration:",{url:a,hasAnonKey:!!l}),Error("Missing Supabase environment variables. Please check your .env.local file.");console.log("[SUPABASE-CLIENT] Configured with URL:",a);let i=(0,r.UU)(a,l)},51030:(e,t,s)=>{"use strict";s.d(t,{O:()=>c,A:()=>o});var r=s(95155),a=s(12115),l=s(45749);let i={async signUp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let{data:r,error:a}=await l.N.auth.signUp({email:e,password:t,options:{data:{name:s.name,student_id:s.student_id,department:s.department,year:s.year},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)throw a;return{success:!0,data:r}}catch(e){return console.error("Sign-up failed:",e),{success:!1,error:e.message}}},async signIn(e,t){try{let{data:s,error:r}=await l.N.auth.signInWithPassword({email:e,password:t});if(r)throw r;return{success:!0,data:s}}catch(e){return{success:!1,error:e.message}}},async signOut(){try{let{error:e}=await l.N.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async getCurrentUser(){try{let{data:{user:e},error:t}=await l.N.auth.getUser();if(t)throw t;if(e){let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e.id).single();return s&&"PGRST116"!==s.code&&console.error("Error fetching profile:",s),{success:!0,user:{...e,profile:t||null,role:(null==t?void 0:t.role)||"user"}}}return{success:!0,user:null}}catch(e){return{success:!1,error:e.message}}},async getUserProfile(e){try{let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e).single();if(s)throw s;return{success:!0,data:t}}catch(e){return{success:!1,error:e.message}}},async resetPassword(e){try{let{error:t}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updatePassword(e){try{let{error:t}=await l.N.auth.updateUser({password:e});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updateProfile(e){let{name:t,student_id:s,department:r,year:a}=e;try{let{data:e,error:i}=await l.N.auth.updateUser({data:{name:t,student_id:s,department:r,year:a}});if(i)throw i;let n=e.user.id,{error:o}=await l.N.from("profiles").update({username:t,student_id:s,department:r,year:a}).eq("id",n);if(o)throw o;return{success:!0,user:e.user}}catch(e){return console.error("更新個人資料失敗:",e),{success:!1,error:e.message}}},async verifyOtp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";try{let{data:r,error:a}=await l.N.auth.verifyOtp({email:e,token:t,type:s});if(a)throw a;return{success:!0,data:r}}catch(e){return{success:!1,error:e.message}}},async resendOtp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";try{let{error:s}=await l.N.auth.resend({type:t,email:e});if(s)throw s;return{success:!0}}catch(e){return{success:!1,error:e.message}}},onAuthStateChange:e=>l.N.auth.onAuthStateChange((t,s)=>{e(t,s)})},n=(0,a.createContext)({}),o=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e,[s,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=async()=>{let e=await i.getCurrentUser();e.success&&e.user&&o(e.user),d(!1)};e();let{data:{subscription:t}}=i.onAuthStateChange(async(t,s)=>{if("SIGNED_IN"===t&&(null==s?void 0:s.user)){var r;let t=s.user,{data:a}=await l.N.from("profiles").select("id").eq("id",t.id).single();!a&&(null==(r=t.raw_user_meta_data)?void 0:r.name)&&(await l.N.from("profiles").insert({id:t.id,username:t.raw_user_meta_data.name,student_id:t.raw_user_meta_data.student_id,role:"user"}),await l.N.auth.updateUser({data:{display_name:t.raw_user_meta_data.name}})),await e(),m(null)}else"SIGNED_OUT"===t&&(o(null),m(null));d(!1)});return()=>{null==t||t.unsubscribe()}},[]);let h={user:s,loading:c,error:u,signUp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};m(null);let r=await i.signUp(e,t,s);return r.success||m(r.error),r},signIn:async(e,t)=>{m(null);let s=await i.signIn(e,t);return s.success||m(s.error),s},signOut:async()=>{m(null);let e=await i.signOut();return e.success?o(null):m(e.error),e},resetPassword:async e=>{m(null);let t=await i.resetPassword(e);return t.success||m(t.error),t},updatePassword:async e=>{m(null);let t=await i.updatePassword(e);return t.success||m(t.error),t},updateProfile:async e=>{m(null);let{name:t,student_id:s}=e,r=await i.updateProfile({name:t,student_id:s});if(r.success){let e=await i.getCurrentUser();e.success&&o(e.user)}else m(r.error);return r},verifyOtp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";m(null);let r=await i.verifyOtp(e,t,s);return r.success||m(r.error),r},resendOtp:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";m(null);let s=await i.resendOtp(e,t);return s.success||m(s.error),s},isAuthenticated:!!s,isAdmin:(null==s?void 0:s.role)==="admin"};return(0,r.jsx)(n.Provider,{value:h,children:t})}},51154:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},54416:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},67957:(e,t,s)=>{Promise.resolve().then(s.bind(s,91326))},77604:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(95155),a=s(12115),l=s(60760),i=s(38274),n=s(40646),o=s(1243),c=s(81284),d=s(54416);let u=e=>{let{show:t,message:s,type:u="success",onClose:m}=e;a.useEffect(()=>{if(t){let e=setTimeout(()=>m(),5e3);return()=>clearTimeout(e)}},[t,m]);let h={success:{icon:(0,r.jsx)(n.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,r.jsx)(o.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,r.jsx)(c.A,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},g=h[u]||h.info;return(0,r.jsx)(l.N,{children:t&&(0,r.jsx)(i.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,r.jsxs)("div",{className:"flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ".concat(g.style),children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:g.icon}),(0,r.jsx)("div",{className:"ml-3 flex-1",children:(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:s})}),(0,r.jsx)("button",{onClick:m,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,r.jsx)(d.A,{className:"w-5 h-5"})})]})})})}},78749:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},81284:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},91326:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(95155),a=s(12115),l=s(35695),i=s(6874),n=s.n(i),o=s(25215),c=s(28883),d=s(32919),u=s(78749),m=s(92657),h=s(51154),g=s(77604);let x={set:(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Error saving to localStorage:",e)}},get:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let s=localStorage.getItem(e);return s?JSON.parse(s):t}catch(e){return console.error("Error reading from localStorage:",e),t}},remove:e=>{try{localStorage.removeItem(e)}catch(e){console.error("Error removing from localStorage:",e)}}};function f(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),{signIn:s,isAuthenticated:i,loading:f}=(0,o.A)(),[p,y]=(0,a.useState)({email:"",password:""}),[w,b]=(0,a.useState)(!1),[v,N]=(0,a.useState)({}),[j,k]=(0,a.useState)(!1),[A,S]=(0,a.useState)(!1),[E,M]=(0,a.useState)(!1),[_,I]=(0,a.useState)({show:!1,message:"",type:"success"}),C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return I({show:!0,message:e,type:t})};(0,a.useEffect)(()=>{M(!0)},[]);let U=(0,a.useMemo)(()=>{if(!E)return[];let e=["bg-blue-700","bg-teal-500","bg-cyan-400"];return[...Array(12)].map((t,s)=>({id:s,size:Math.floor(121*Math.random()+100),color:e[Math.floor(Math.random()*e.length)],top:"".concat(100*Math.random(),"%"),left:"".concat(100*Math.random(),"%"),animationDuration:"".concat(25+20*Math.random(),"s"),xStart:"".concat(20*Math.random()-10,"vw"),yStart:"".concat(20*Math.random()-10,"vh"),xEnd:"".concat(40*Math.random()-20,"vw"),yEnd:"".concat(40*Math.random()-20,"vh"),xEnd2:"".concat(40*Math.random()-20,"vw"),yEnd2:"".concat(40*Math.random()-20,"vh")}))},[E]);(0,a.useEffect)(()=>{let e=x.get("rememberedEmail"),t=x.get("shouldRememberUser");e&&t&&(y(t=>({...t,email:e})),b(!0))},[]),(0,a.useEffect)(()=>{if(!f&&i){let s=t.get("redirect")||"/profile";e.push(s)}},[i,f,e,t]);let O=e=>{let{name:t,value:s}=e.target;y(e=>({...e,[t]:s})),v[t]&&N(e=>({...e,[t]:""}))},P=async r=>{r.preventDefault();let a=(()=>{let e={};return p.email.trim()?/\S+@\S+\.\S+/.test(p.email)||(e.email="請輸入有效的電子郵件格式"):e.email="請輸入電子郵件地址",p.password||(e.password="請輸入密碼"),e})();if(Object.keys(a).length>0)return void N(a);S(!0),N({});try{let r=await s(p.email,p.password);if(r.success){w?(x.set("rememberedEmail",p.email),x.set("shouldRememberUser",!0)):(x.remove("rememberedEmail"),x.remove("shouldRememberUser")),C("登入成功！正在將您導向頁面...","success");let s=t.get("redirect")||"/";e.push(s)}else{let e=r.error||"電子郵件或密碼不正確。";C(e,"error")}}catch(e){C("發生無法預期的錯誤，請稍後再試。","error")}finally{S(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{show:_.show,message:_.message,type:_.type,onClose:()=>I(e=>({...e,show:!1}))}),(0,r.jsxs)("div",{className:"flex w-full max-w-5xl my-16 sm:my-24 mx-auto overflow-hidden rounded-2xl shadow-2xl bg-white/70 backdrop-blur-xl border border-gray-200/50",children:[(0,r.jsxs)("div",{className:"relative hidden w-0 flex-1 lg:block bg-slate-900",children:[(0,r.jsx)("div",{className:"absolute inset-0 h-full w-full overflow-hidden",children:U.map(e=>(0,r.jsx)("div",{className:"absolute rounded-full filter blur-3xl opacity-30 ".concat(e.color),style:{width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),top:e.top,left:e.left,animation:"move-particle ".concat(e.animationDuration," ease-in-out infinite"),"--x-start":e.xStart,"--y-start":e.yStart,"--x-end":e.xEnd,"--y-end":e.yEnd,"--x-end-2":e.xEnd2,"--y-end-2":e.yEnd2}},e.id))}),(0,r.jsx)("div",{className:"relative flex h-full flex-col justify-center p-16 text-left text-white z-10",children:(0,r.jsxs)("div",{className:"max-w-lg",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold leading-tight tracking-tight",children:"Empowering Your Journey"}),(0,r.jsx)("p",{className:"mt-6 text-lg text-slate-200",children:"立即登入，與 AI 獎學金助理開始對話。我們整合全網資訊與所有校內公告，為您提供最精準的解答 !"})]})})]}),(0,r.jsx)("div",{className:"flex flex-1 flex-col justify-center px-6 py-12 sm:px-10 lg:px-16",children:(0,r.jsxs)("div",{className:"mx-auto w-full max-w-md",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold leading-9 tracking-tight text-gray-900",children:"登入您的帳號"}),(0,r.jsxs)("p",{className:"mt-2 text-sm leading-6 text-gray-500",children:["還沒有帳號嗎？"," ",(0,r.jsx)(n(),{href:"/register",className:"font-semibold text-indigo-600 login-link-hover",children:"立即註冊"})]})]}),(0,r.jsx)("div",{className:"mt-10",children:(0,r.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900",children:"電子郵件"}),(0,r.jsxs)("div",{className:"mt-2 relative",children:[(0,r.jsx)(c.A,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,placeholder:"example@mail.com",value:p.email,onChange:O,className:"block w-full rounded-md border-0 py-2.5 pl-10 pr-3 text-gray-900 ring-1 ring-inset ".concat(v.email?"ring-red-500":"ring-gray-300"," placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:shadow-lg focus:shadow-indigo-500/50 sm:text-sm sm:leading-6 transition-all")})]}),v.email&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-600",children:v.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900",children:"密碼"}),(0,r.jsxs)("div",{className:"mt-2 relative",children:[(0,r.jsx)(d.A,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,r.jsx)("input",{id:"password",name:"password",required:!0,type:j?"text":"password",autoComplete:"current-password",placeholder:"請輸入您的密碼",value:p.password,onChange:O,className:"block w-full rounded-md border-0 py-2.5 pl-10 pr-10 text-gray-900 ring-1 ring-inset ".concat(v.password?"ring-red-500":"ring-gray-300"," placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:shadow-lg focus:shadow-indigo-500/50 sm:text-sm sm:leading-6 transition-all")}),(0,r.jsx)("button",{type:"button",onClick:()=>k(!j),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600",children:j?(0,r.jsx)(u.A,{className:"h-5 w-5"}):(0,r.jsx)(m.A,{className:"h-5 w-5"})})]}),v.password&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-600",children:v.password})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",checked:w,onChange:e=>b(e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,r.jsx)("label",{htmlFor:"remember-me",className:"ml-3 block text-sm leading-6 text-gray-900",children:"紀錄登入狀態"})]}),(0,r.jsx)("div",{className:"text-sm",children:(0,r.jsx)(n(),{href:"/forgot-password",className:"font-semibold text-indigo-600 login-link-hover",children:"忘記密碼？"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:A||f,className:"\n											flex w-full justify-center rounded-md px-3 py-2.5 text-sm font-semibold leading-6\n											border border-indigo-600 bg-transparent text-indigo-600\n											transition-all duration-300 ease-in-out\n											hover:bg-indigo-600 hover:text-white hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/40\n											focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\n											disabled:bg-slate-100 disabled:text-slate-400 disabled:border-slate-200 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none\n										",children:A||f?(0,r.jsx)(h.A,{className:"animate-spin"}):"登入"})})]})})]})})]})]})}function p(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"w-full flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(h.A,{className:"h-12 w-12 text-indigo-600 animate-spin mx-auto"}),(0,r.jsx)("p",{className:"text-gray-600 mt-4",children:"正在載入登入頁面..."})]})}),children:(0,r.jsx)(f,{})})}},92657:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])}},e=>{e.O(0,[4677,1658,6874,8441,5964,7358],()=>e(e.s=67957)),_N_E=e.O()}]);