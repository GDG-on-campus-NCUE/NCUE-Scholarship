(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5890],{1243:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},11167:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(95155),r=s(12115),l=s(35695),n=s(6874),i=s.n(n),c=s(25215),o=s(28883),d=s(1243),u=s(51154);let h=(0,s(19946).A)("mail-check",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);var m=s(12486),x=s(77604);function f(){let e=(0,l.useRouter)(),{resetPassword:t,isAuthenticated:s}=(0,c.A)(),[n,f]=(0,r.useState)(""),[g,p]=(0,r.useState)(""),[y,w]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[N,j]=(0,r.useState)(0),[A,k]=(0,r.useState)(!1),[S,E]=(0,r.useState)(!1),[_,M]=(0,r.useState)({show:!1,message:"",type:"success"}),C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return M({show:!0,message:e,type:t})};(0,r.useEffect)(()=>{E(!0)},[]);let I=(0,r.useMemo)(()=>{if(!S)return[];let e=["bg-purple-700","bg-rose-500","bg-orange-400"];return[...Array(12)].map((t,s)=>({id:s,size:Math.floor(121*Math.random()+100),color:e[Math.floor(Math.random()*e.length)],top:"".concat(100*Math.random(),"%"),left:"".concat(100*Math.random(),"%"),animationDuration:"".concat(25+20*Math.random(),"s"),xStart:"".concat(20*Math.random()-10,"vw"),yStart:"".concat(20*Math.random()-10,"vh"),xEnd:"".concat(40*Math.random()-20,"vw"),yEnd:"".concat(40*Math.random()-20,"vh"),xEnd2:"".concat(40*Math.random()-20,"vw"),yEnd2:"".concat(40*Math.random()-20,"vh")}))},[S]);(0,r.useEffect)(()=>{s&&e.push("/profile")},[s,e]),(0,r.useEffect)(()=>{if(N>0){let e=setTimeout(()=>j(N-1),1e3);return()=>clearTimeout(e)}},[N]);let P=async()=>{if(!n||!/\S+@\S+\.\S+/.test(n))return p("請輸入有效的電子郵件格式"),!1;p("");let e=await t(n);return!!e.success||(C(e.error||"發送失敗，請確認此電子郵件是否已註冊。","error"),!1)},O=async e=>{e.preventDefault(),w(!0),await P()&&(v(!0),j(120)),w(!1)},U=async()=>{N>0||A||(k(!0),await P()&&(C("新的重設郵件已成功發送！","success"),j(120)),k(!1))},z="\n		flex w-full justify-center items-center gap-2 rounded-md px-3 py-2.5 text-sm font-semibold leading-6\n		border border-indigo-600 bg-transparent text-indigo-600\n		transition-all duration-300 ease-in-out\n		hover:bg-indigo-600 hover:text-white hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/40\n		focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\n		disabled:bg-slate-100 disabled:text-slate-400 disabled:border-slate-200 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none\n	";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.A,{show:_.show,message:_.message,type:_.type,onClose:()=>M(e=>({...e,show:!1}))}),(0,a.jsxs)("div",{className:"flex w-full max-w-5xl my-16 sm:my-24 mx-auto overflow-hidden rounded-2xl shadow-2xl bg-white/70 backdrop-blur-xl border border-gray-200/50",children:[(0,a.jsxs)("div",{className:"relative hidden w-0 flex-1 lg:block bg-slate-900",children:[(0,a.jsx)("div",{className:"absolute inset-0 h-full w-full overflow-hidden",children:I.map(e=>(0,a.jsx)("div",{className:"absolute rounded-full filter blur-3xl opacity-30 ".concat(e.color),style:{width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),top:e.top,left:e.left,animation:"move-particle ".concat(e.animationDuration," ease-in-out infinite"),"--x-start":e.xStart,"--y-start":e.yStart,"--x-end":e.xEnd,"--y-end":e.yEnd,"--x-end-2":e.xEnd2,"--y-end-2":e.yEnd2}},e.id))}),(0,a.jsxs)("div",{className:"relative flex h-full flex-col justify-center p-16 text-left text-white z-10",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold leading-tight tracking-tight",children:"Forgot Your Password?"}),(0,a.jsx)("p",{className:"mt-6 text-lg text-slate-200",children:"請在右方欄位輸入您的註冊信箱，我們將立即寄送 OTP 至您的信箱，協助您重新登入。"})]})]}),(0,a.jsx)("div",{className:"flex flex-1 flex-col justify-center px-6 py-12 sm:px-10 lg:px-16",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[b?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block p-3 bg-green-100 rounded-full mb-4",children:(0,a.jsx)(h,{className:"h-8 w-8 text-green-600"})}),(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"郵件已成功發送"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["我們已將密碼重設連結發送到 ",(0,a.jsx)("strong",{className:"text-gray-700",children:n}),"。請檢查您的收件匣（包含垃圾郵件）。"]}),(0,a.jsxs)("button",{onClick:U,disabled:N>0||A,className:"mt-8 ".concat(z),children:[A?(0,a.jsx)(u.A,{className:"animate-spin"}):(0,a.jsx)(m.A,{size:16}),(0,a.jsx)("span",{className:"ml-2",children:N>0?"在 ".concat(N," 秒後重新發送"):"重新發送郵件"})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"重設您的密碼"})}),(0,a.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900",children:"電子郵件"}),(0,a.jsxs)("div",{className:"mt-2 relative",children:[(0,a.jsx)(o.A,{className:"pointer-events-none absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,placeholder:"example@mail.com",value:n,onChange:e=>{f(e.target.value),g&&p("")},className:"block w-full rounded-md border-0 py-2.5 pl-11 pr-4 text-gray-900 ring-1 ring-inset ".concat(g?"ring-red-500":"ring-gray-300"," placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:shadow-lg focus:shadow-indigo-500/50 sm:text-sm sm:leading-6 transition-all")})]}),g&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[(0,a.jsx)(d.A,{size:14}),g]})]}),(0,a.jsx)("button",{type:"submit",disabled:y,className:z,children:y?(0,a.jsx)(u.A,{className:"animate-spin"}):"發送重設郵件"})]})]}),(0,a.jsx)("div",{className:"mt-8 text-center text-sm",children:(0,a.jsx)(i(),{href:"/login",className:"font-semibold text-indigo-600 login-link-hover",children:"返回登入"})})]})})]})]})}function g(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"w-full flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(u.A,{className:"h-12 w-12 text-indigo-600 animate-spin mx-auto"})})}),children:(0,a.jsx)(f,{})})}},12486:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},25215:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=s(51030).A},28883:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},40646:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},45749:(e,t,s)=>{"use strict";s.d(t,{N:()=>n});var a=s(55647);let r="https://scholarship-api.ncuesa.org.tw",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU0NDA5NjAwLCJleHAiOjE5MTIxNzYwMDB9.jqoKh3OJbr8hsKd1CTuz6UcEPGuzO_gZEL9HT67q_GY";if(!r||!l)throw console.error("Supabase configuration:",{url:r,hasAnonKey:!!l}),Error("Missing Supabase environment variables. Please check your .env.local file.");console.log("[SUPABASE-CLIENT] Configured with URL:",r);let n=(0,a.UU)(r,l)},51030:(e,t,s)=>{"use strict";s.d(t,{O:()=>o,A:()=>c});var a=s(95155),r=s(12115),l=s(45749);let n={async signUp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let{data:a,error:r}=await l.N.auth.signUp({email:e,password:t,options:{data:{name:s.name,student_id:s.student_id,department:s.department,year:s.year},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r;return{success:!0,data:a}}catch(e){return console.error("Sign-up failed:",e),{success:!1,error:e.message}}},async signIn(e,t){try{let{data:s,error:a}=await l.N.auth.signInWithPassword({email:e,password:t});if(a)throw a;return{success:!0,data:s}}catch(e){return{success:!1,error:e.message}}},async signOut(){try{let{error:e}=await l.N.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async getCurrentUser(){try{let{data:{user:e},error:t}=await l.N.auth.getUser();if(t)throw t;if(e){let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e.id).single();return s&&"PGRST116"!==s.code&&console.error("Error fetching profile:",s),{success:!0,user:{...e,profile:t||null,role:(null==t?void 0:t.role)||"user"}}}return{success:!0,user:null}}catch(e){return{success:!1,error:e.message}}},async getUserProfile(e){try{let{data:t,error:s}=await l.N.from("profiles").select("*").eq("id",e).single();if(s)throw s;return{success:!0,data:t}}catch(e){return{success:!1,error:e.message}}},async resetPassword(e){try{let{error:t}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updatePassword(e){try{let{error:t}=await l.N.auth.updateUser({password:e});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updateProfile(e){let{name:t,student_id:s,department:a,year:r}=e;try{let{data:e,error:n}=await l.N.auth.updateUser({data:{name:t,student_id:s,department:a,year:r}});if(n)throw n;let i=e.user.id,{error:c}=await l.N.from("profiles").update({username:t,student_id:s,department:a,year:r}).eq("id",i);if(c)throw c;return{success:!0,user:e.user}}catch(e){return console.error("更新個人資料失敗:",e),{success:!1,error:e.message}}},async verifyOtp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";try{let{data:a,error:r}=await l.N.auth.verifyOtp({email:e,token:t,type:s});if(r)throw r;return{success:!0,data:a}}catch(e){return{success:!1,error:e.message}}},async resendOtp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";try{let{error:s}=await l.N.auth.resend({type:t,email:e});if(s)throw s;return{success:!0}}catch(e){return{success:!1,error:e.message}}},onAuthStateChange:e=>l.N.auth.onAuthStateChange((t,s)=>{e(t,s)})},i=(0,r.createContext)({}),c=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,[s,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=async()=>{let e=await n.getCurrentUser();e.success&&e.user&&c(e.user),d(!1)};e();let{data:{subscription:t}}=n.onAuthStateChange(async(t,s)=>{if("SIGNED_IN"===t&&(null==s?void 0:s.user)){var a;let t=s.user,{data:r}=await l.N.from("profiles").select("id").eq("id",t.id).single();!r&&(null==(a=t.raw_user_meta_data)?void 0:a.name)&&(await l.N.from("profiles").insert({id:t.id,username:t.raw_user_meta_data.name,student_id:t.raw_user_meta_data.student_id,role:"user"}),await l.N.auth.updateUser({data:{display_name:t.raw_user_meta_data.name}})),await e(),h(null)}else"SIGNED_OUT"===t&&(c(null),h(null));d(!1)});return()=>{null==t||t.unsubscribe()}},[]);let m={user:s,loading:o,error:u,signUp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};h(null);let a=await n.signUp(e,t,s);return a.success||h(a.error),a},signIn:async(e,t)=>{h(null);let s=await n.signIn(e,t);return s.success||h(s.error),s},signOut:async()=>{h(null);let e=await n.signOut();return e.success?c(null):h(e.error),e},resetPassword:async e=>{h(null);let t=await n.resetPassword(e);return t.success||h(t.error),t},updatePassword:async e=>{h(null);let t=await n.updatePassword(e);return t.success||h(t.error),t},updateProfile:async e=>{h(null);let{name:t,student_id:s}=e,a=await n.updateProfile({name:t,student_id:s});if(a.success){let e=await n.getCurrentUser();e.success&&c(e.user)}else h(a.error);return a},verifyOtp:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";h(null);let a=await n.verifyOtp(e,t,s);return a.success||h(a.error),a},resendOtp:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";h(null);let s=await n.resendOtp(e,t);return s.success||h(s.error),s},isAuthenticated:!!s,isAdmin:(null==s?void 0:s.role)==="admin"};return(0,a.jsx)(i.Provider,{value:m,children:t})}},51154:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},54416:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},77604:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var a=s(95155),r=s(12115),l=s(60760),n=s(38274),i=s(40646),c=s(1243),o=s(81284),d=s(54416);let u=e=>{let{show:t,message:s,type:u="success",onClose:h}=e;r.useEffect(()=>{if(t){let e=setTimeout(()=>h(),5e3);return()=>clearTimeout(e)}},[t,h]);let m={success:{icon:(0,a.jsx)(i.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,a.jsx)(c.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,a.jsx)(o.A,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},x=m[u]||m.info;return(0,a.jsx)(l.N,{children:t&&(0,a.jsx)(n.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,a.jsxs)("div",{className:"flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ".concat(x.style),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:x.icon}),(0,a.jsx)("div",{className:"ml-3 flex-1",children:(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:s})}),(0,a.jsx)("button",{onClick:h,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,a.jsx)(d.A,{className:"w-5 h-5"})})]})})})}},81284:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},90935:(e,t,s)=>{Promise.resolve().then(s.bind(s,11167))}},e=>{e.O(0,[4677,1658,6874,8441,5964,7358],()=>e(e.s=90935)),_N_E=e.O()}]);