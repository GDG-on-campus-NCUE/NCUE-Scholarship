(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5963],{27827:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>C});var r=t(95155),a=t(12115),l=t(35695),n=t(51030),i=t(23572),o=t(32919),c=t(78749),d=t(92657),u=t(51154),m=t(71007),x=t(38196),h=t(81801),g=t(69074),f=t(14186),p=t(34835),w=t(57434),y=t(4229),N=t(44940),b=t(90232),j=t(77604);i.u2.setOptions({dictionary:{userInputs:["ncue","scholarship","changhua","student"]}});let v=e=>{let{id:s,name:t,placeholder:l,value:n,onChange:u,error:m,isConfirmField:x=!1}=e,[h,g]=(0,a.useState)(!1),f=(0,a.useMemo)(()=>!x&&n?(0,i.K1)(n):null,[n,x]),p=f?[{text:"非常弱",lightColor:"bg-red-200",color:"bg-red-500",textColor:"text-red-700"},{text:"弱",lightColor:"bg-orange-200",color:"bg-orange-500",textColor:"text-orange-700"},{text:"中等",lightColor:"bg-yellow-200",color:"bg-yellow-500",textColor:"text-yellow-700"},{text:"強",lightColor:"bg-green-200",color:"bg-green-500",textColor:"text-green-700"},{text:"非常強",lightColor:"bg-emerald-200",color:"bg-emerald-500",textColor:"text-emerald-700"}][f.score]:null;return(0,r.jsxs)("div",{className:"w-full space-y-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.A,{className:"pointer-events-none absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,r.jsx)("input",{id:s,name:t,type:h?"text":"password",placeholder:l,value:n,onChange:u,required:!0,className:"block w-full rounded-md border-0 py-2.5 pl-10 pr-10 text-gray-900 ring-1 ring-inset ".concat(m?"ring-red-500":"ring-gray-300"," placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 transition-all")}),(0,r.jsx)("button",{type:"button",onClick:()=>g(!h),className:"absolute inset-y-0 right-0 flex items-center pr-3.5 text-gray-400 hover:text-gray-600",children:h?(0,r.jsx)(c.A,{className:"h-5 w-5"}):(0,r.jsx)(d.A,{className:"h-5 w-5"})})]}),!x&&p&&(0,r.jsxs)("div",{className:"flex items-center gap-2 px-1",children:[(0,r.jsx)("div",{className:"h-1.5 flex-grow rounded-full ".concat(p.lightColor),children:(0,r.jsx)("div",{className:"h-full rounded-full ".concat(p.color," transition-all duration-300"),style:{width:"".concat((f.score+1)*20,"%")}})}),(0,r.jsx)("p",{className:"text-xs font-medium ".concat(p.textColor),children:p.text})]}),m&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600 px-1",children:m})]})},_=(e,s,t,a,l)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:s,className:"block text-sm font-semibold text-gray-700 mb-1.5",children:e}),(0,r.jsx)("input",{type:"text",id:s,name:s,value:t,onChange:l,placeholder:a,className:"block w-full rounded-md border-0 py-2.5 px-4 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 transition-all"})]});function C(){var e;let s=(0,l.useRouter)(),{user:t,isAuthenticated:c,loading:d,signOut:C,updateProfile:A,updatePassword:S}=(0,n.A)(),[P,k]=(0,a.useState)(!1),[I,O]=(0,a.useState)({name:"",student_id:""}),[U,E]=(0,a.useState)({password:"",confirmPassword:""}),[z,T]=(0,a.useState)({}),[D,q]=(0,a.useState)(!1),[G,F]=(0,a.useState)(!1),[J,L]=(0,a.useState)({show:!1,message:"",type:"success"}),K=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return L({show:!0,message:e,type:s})};(0,a.useEffect)(()=>{d||c||s.push("/login")},[c,d,s]),(0,a.useEffect)(()=>{(null==t?void 0:t.user_metadata)&&O({name:t.user_metadata.name||"",student_id:t.user_metadata.student_id||""})},[t]);let R=e=>O(s=>({...s,[e.target.name]:e.target.value})),W=e=>{E(s=>({...s,[e.target.name]:e.target.value})),(z[e.target.name]||z.passwordSubmit)&&T({})},M=async e=>{e.preventDefault(),q(!0),T({});let s=await A(I);s.success?(K("個人資料已成功更新","success"),k(!1)):K(s.error||"更新失敗，請稍後再試","error"),q(!1)},Y=async e=>{e.preventDefault();let s={};if((0,i.K1)(U.password).score<2&&(s.password="密碼強度不足，請嘗試更複雜的組合"),U.password!==U.confirmPassword&&(s.confirmPassword="兩次輸入的密碼不一致"),Object.keys(s).length>0)return void T(s);F(!0),T({});let t=await S(U.password);if(t.success)K("密碼已成功更新","success"),E({password:"",confirmPassword:""});else{let e=t.error||"更新失敗，請稍後再試";T({passwordSubmit:e}),K(e,"error")}F(!1)};if(d||!c)return(0,r.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,r.jsx)(u.A,{className:"h-12 w-12 text-indigo-600 animate-spin"})});let B="flex items-center justify-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg border transition-all duration-300 ease-in-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:transform-none disabled:shadow-none",H="".concat(B," border-indigo-600 bg-transparent text-indigo-600 hover:bg-indigo-600 hover:text-white hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/40 disabled:bg-slate-100 disabled:text-slate-400 disabled:border-slate-200");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.A,{show:J.show,message:J.message,type:J.type,onClose:()=>L(e=>({...e,show:!1}))}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 my-16 sm:my-24",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 lg:gap-8",children:[(0,r.jsx)("aside",{className:"lg:col-span-1 flex flex-col",children:(0,r.jsxs)("div",{className:"w-full flex flex-col flex-grow bg-white rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1",children:[(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"h-16 w-16 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(m.A,{className:"h-8 w-8 text-indigo-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 truncate",children:(null==(e=t.user_metadata)?void 0:e.name)||"使用者"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 truncate",children:t.email})]})]})}),(0,r.jsxs)("div",{className:"p-6 border-t border-gray-100",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-3",children:[(0,r.jsx)(x.A,{className:"h-5 w-5 text-indigo-600"}),"帳號狀態"]}),(0,r.jsxs)("dl",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center gap-2",children:[(0,r.jsx)(h.A,{size:16}),"用戶ID"]}),(0,r.jsx)("dd",{className:"text-sm text-gray-900 break-all mt-1",children:t.id})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center gap-2",children:[(0,r.jsx)(g.A,{size:16}),"註冊時間"]}),(0,r.jsx)("dd",{className:"text-sm text-gray-900 mt-1",children:new Date(t.created_at).toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric"})})]}),t.last_sign_in_at&&(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center gap-2",children:[(0,r.jsx)(f.A,{size:16}),"最後登入時間"]}),(0,r.jsx)("dd",{className:"text-sm text-gray-900 mt-1",children:new Date(t.last_sign_in_at).toLocaleString("zh-TW",{dateStyle:"medium",timeStyle:"short"})})]})]})]}),(0,r.jsx)("div",{className:"mt-auto p-6 border-t border-gray-100",children:(0,r.jsxs)("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold text-red-600 bg-red-50 rounded-lg hover:bg-red-100 hover:text-red-700 transition-colors",children:[(0,r.jsx)(p.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"登出"})]})})]})}),(0,r.jsxs)("main",{className:"lg:col-span-2 flex flex-col gap-8 mt-8 lg:mt-0",children:[(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1",children:(0,r.jsxs)("form",{onSubmit:M,children:[(0,r.jsx)("div",{className:"p-8",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[(0,r.jsx)(w.A,{className:"h-6 w-6 text-indigo-600"}),"個人資料"]}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"請確保您提供的是正確的個人資料。"})]})}),(0,r.jsxs)("div",{className:"px-8 pb-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[P?_("姓名","name",I.name,"請輸入您的姓名",R):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"姓名"}),(0,r.jsx)("dd",{className:"text-base text-gray-900 mt-1",children:I.name||"未設定"})]}),P?_("學號","student_id",I.student_id,"請輸入您的學號",R):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"學號"}),(0,r.jsx)("dd",{className:"text-base text-gray-900 mt-1",children:I.student_id||"未設定"})]})]}),(0,r.jsx)("div",{className:"bg-gray-50 px-8 py-4 rounded-b-xl flex justify-end",children:P?(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>k(!1),className:"".concat(B," border-gray-300 bg-transparent text-gray-700 hover:bg-gray-100"),children:"取消"}),(0,r.jsxs)("button",{type:"submit",disabled:D,className:H,children:[D?(0,r.jsx)(u.A,{className:"animate-spin h-4 w-4"}):(0,r.jsx)(y.A,{className:"h-4 w-4"}),"儲存"]})]}):(0,r.jsxs)("button",{type:"button",onClick:()=>k(!0),className:H,children:[(0,r.jsx)(N.A,{className:"h-4 w-4"}),"編輯"]})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl hover:-translate-y-1",children:(0,r.jsxs)("form",{onSubmit:Y,children:[(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[(0,r.jsx)(o.A,{className:"h-6 w-6 text-indigo-600"}),"帳號安全"]}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"建議您定期更換密碼以維持帳號安全。"}),(0,r.jsxs)("div",{className:"mt-6 border-t border-gray-100 pt-6 space-y-6",children:[(0,r.jsx)(v,{id:"password",name:"password",placeholder:"設定新密碼",value:U.password,onChange:W,error:z.password}),(0,r.jsx)(v,{id:"confirmPassword",name:"confirmPassword",placeholder:"再次輸入新密碼",value:U.confirmPassword,onChange:W,error:z.confirmPassword,isConfirmField:!0}),z.passwordSubmit&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:z.passwordSubmit})]})]}),(0,r.jsx)("div",{className:"bg-gray-50 px-8 py-4 rounded-b-xl flex justify-end",children:(0,r.jsxs)("button",{type:"submit",disabled:G,className:H,children:[G?(0,r.jsx)(u.A,{className:"animate-spin h-5 w-5"}):(0,r.jsx)(b.A,{className:"h-5 w-5"}),"更新密碼"]})})]})})]})]})})]})}},45749:(e,s,t)=>{"use strict";t.d(s,{N:()=>n});var r=t(55647);let a="https://scholarship-api.ncuesa.org.tw",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU0NDA5NjAwLCJleHAiOjE5MTIxNzYwMDB9.jqoKh3OJbr8hsKd1CTuz6UcEPGuzO_gZEL9HT67q_GY";if(!a||!l)throw console.error("Supabase configuration:",{url:a,hasAnonKey:!!l}),Error("Missing Supabase environment variables. Please check your .env.local file.");console.log("[SUPABASE-CLIENT] Configured with URL:",a);let n=(0,r.UU)(a,l)},51030:(e,s,t)=>{"use strict";t.d(s,{O:()=>c,A:()=>o});var r=t(95155),a=t(12115),l=t(45749);let n={async signUp(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let{data:r,error:a}=await l.N.auth.signUp({email:e,password:s,options:{data:{name:t.name,student_id:t.student_id,department:t.department,year:t.year},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)throw a;return{success:!0,data:r}}catch(e){return console.error("Sign-up failed:",e),{success:!1,error:e.message}}},async signIn(e,s){try{let{data:t,error:r}=await l.N.auth.signInWithPassword({email:e,password:s});if(r)throw r;return{success:!0,data:t}}catch(e){return{success:!1,error:e.message}}},async signOut(){try{let{error:e}=await l.N.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async getCurrentUser(){try{let{data:{user:e},error:s}=await l.N.auth.getUser();if(s)throw s;if(e){let{data:s,error:t}=await l.N.from("profiles").select("*").eq("id",e.id).single();return t&&"PGRST116"!==t.code&&console.error("Error fetching profile:",t),{success:!0,user:{...e,profile:s||null,role:(null==s?void 0:s.role)||"user"}}}return{success:!0,user:null}}catch(e){return{success:!1,error:e.message}}},async getUserProfile(e){try{let{data:s,error:t}=await l.N.from("profiles").select("*").eq("id",e).single();if(t)throw t;return{success:!0,data:s}}catch(e){return{success:!1,error:e.message}}},async resetPassword(e){try{let{error:s}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(s)throw s;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updatePassword(e){try{let{error:s}=await l.N.auth.updateUser({password:e});if(s)throw s;return{success:!0}}catch(e){return{success:!1,error:e.message}}},async updateProfile(e){let{name:s,student_id:t,department:r,year:a}=e;try{let{data:e,error:n}=await l.N.auth.updateUser({data:{name:s,student_id:t,department:r,year:a}});if(n)throw n;let i=e.user.id,{error:o}=await l.N.from("profiles").update({username:s,student_id:t,department:r,year:a}).eq("id",i);if(o)throw o;return{success:!0,user:e.user}}catch(e){return console.error("更新個人資料失敗:",e),{success:!1,error:e.message}}},async verifyOtp(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";try{let{data:r,error:a}=await l.N.auth.verifyOtp({email:e,token:s,type:t});if(a)throw a;return{success:!0,data:r}}catch(e){return{success:!1,error:e.message}}},async resendOtp(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";try{let{error:t}=await l.N.auth.resend({type:s,email:e});if(t)throw t;return{success:!0}}catch(e){return{success:!1,error:e.message}}},onAuthStateChange:e=>l.N.auth.onAuthStateChange((s,t)=>{e(s,t)})},i=(0,a.createContext)({}),o=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:s}=e,[t,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=async()=>{let e=await n.getCurrentUser();e.success&&e.user&&o(e.user),d(!1)};e();let{data:{subscription:s}}=n.onAuthStateChange(async(s,t)=>{if("SIGNED_IN"===s&&(null==t?void 0:t.user)){var r;let s=t.user,{data:a}=await l.N.from("profiles").select("id").eq("id",s.id).single();!a&&(null==(r=s.raw_user_meta_data)?void 0:r.name)&&(await l.N.from("profiles").insert({id:s.id,username:s.raw_user_meta_data.name,student_id:s.raw_user_meta_data.student_id,role:"user"}),await l.N.auth.updateUser({data:{display_name:s.raw_user_meta_data.name}})),await e(),m(null)}else"SIGNED_OUT"===s&&(o(null),m(null));d(!1)});return()=>{null==s||s.unsubscribe()}},[]);let x={user:t,loading:c,error:u,signUp:async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};m(null);let r=await n.signUp(e,s,t);return r.success||m(r.error),r},signIn:async(e,s)=>{m(null);let t=await n.signIn(e,s);return t.success||m(t.error),t},signOut:async()=>{m(null);let e=await n.signOut();return e.success?o(null):m(e.error),e},resetPassword:async e=>{m(null);let s=await n.resetPassword(e);return s.success||m(s.error),s},updatePassword:async e=>{m(null);let s=await n.updatePassword(e);return s.success||m(s.error),s},updateProfile:async e=>{m(null);let{name:s,student_id:t}=e,r=await n.updateProfile({name:s,student_id:t});if(r.success){let e=await n.getCurrentUser();e.success&&o(e.user)}else m(r.error);return r},verifyOtp:async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"email";m(null);let r=await n.verifyOtp(e,s,t);return r.success||m(r.error),r},resendOtp:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signup";m(null);let t=await n.resendOtp(e,s);return t.success||m(t.error),t},isAuthenticated:!!t,isAdmin:(null==t?void 0:t.role)==="admin"};return(0,r.jsx)(i.Provider,{value:x,children:s})}},77604:(e,s,t)=>{"use strict";t.d(s,{A:()=>u});var r=t(95155),a=t(12115),l=t(60760),n=t(38274),i=t(40646),o=t(1243),c=t(81284),d=t(54416);let u=e=>{let{show:s,message:t,type:u="success",onClose:m}=e;a.useEffect(()=>{if(s){let e=setTimeout(()=>m(),5e3);return()=>clearTimeout(e)}},[s,m]);let x={success:{icon:(0,r.jsx)(i.A,{className:"w-6 h-6 text-emerald-500"}),style:"bg-emerald-50/70 border-emerald-200"},error:{icon:(0,r.jsx)(o.A,{className:"w-6 h-6 text-rose-500"}),style:"bg-rose-50/70 border-rose-200"},info:{icon:(0,r.jsx)(c.A,{className:"w-6 h-6 text-sky-500"}),style:"bg-sky-50/70 border-sky-200"}},h=x[u]||x.info;return(0,r.jsx)(l.N,{children:s&&(0,r.jsx)(n.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:50,scale:.95},transition:{type:"spring",stiffness:400,damping:25},className:"fixed top-24 right-4 sm:right-6 z-[9999] w-[calc(100%-2rem)] sm:w-auto max-w-md",children:(0,r.jsxs)("div",{className:"flex items-center p-4 rounded-xl border backdrop-blur-lg shadow-lg ".concat(h.style),children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:h.icon}),(0,r.jsx)("div",{className:"ml-3 flex-1",children:(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:t})}),(0,r.jsx)("button",{onClick:m,className:"ml-4 p-1.5 text-gray-500 hover:text-gray-800 rounded-full hover:bg-black/10 transition-colors","aria-label":"Close",children:(0,r.jsx)(d.A,{className:"w-5 h-5"})})]})})})}},94344:(e,s,t)=>{Promise.resolve().then(t.bind(t,27827))}},e=>{e.O(0,[4677,1658,6034,8441,5964,7358],()=>e(e.s=94344)),_N_E=e.O()}]);